/*! For license information please see sdk.webp.js.LICENSE.txt */
(()=>{var e={33:(e,t,i)=>{var n,r,o=i(814),a=i(471),s=0,c=0;e.exports=function(e,t,i){var l=t&&i||0,u=t||[],d=(e=e||{}).node||n,E=(i=void 0!==e.clockseq?e.clockseq:r,null!=d&&null!=i||(E=o(),null==d&&(d=n=[1|E[0],E[1],E[2],E[3],E[4],E[5]]),null==i&&(i=r=16383&(E[6]<<8|E[7]))),void 0!==e.msecs?e.msecs:(new Date).getTime()),g=void 0!==e.nsecs?e.nsecs:c+1,h=E-s+(g-c)/1e4;if(h<0&&void 0===e.clockseq&&(i=i+1&16383),1e4<=(g=(h<0||s<E)&&void 0===e.nsecs?0:g))throw new Error("uuid.v1(): Can't create more than 10M uuids/sec");s=E,r=i,h=(1e4*(268435455&(E+=122192928e5))+(c=g))%4294967296,u[l++]=h>>>24&255,u[l++]=h>>>16&255,u[l++]=h>>>8&255,u[l++]=255&h,u[l++]=(e=E/4294967296*1e4&268435455)>>>8&255,u[l++]=255&e,u[l++]=e>>>24&15|16,u[l++]=e>>>16&255,u[l++]=i>>>8|128,u[l++]=255&i;for(var p=0;p<6;++p)u[l+p]=d[p];return t||a(u)}},372:(e,t,i)=>{e.exports=function(e,t,i){if("number"!=typeof t)throw new Error("second argument must be a Number");let r,o,a,s,c,l,u=!0;function d(e){function t(){i&&i(e,r),i=null}u?n(t):t()}function E(t,i,n){if(r[t]=n,i&&(c=!0),0==--a||i)d(i);else if(!c&&l<o){let t;s?(t=s[l],l+=1,e[t](function(e,i){E(t,e,i)})):(t=l,l+=1,e[t](function(e,i){E(t,e,i)}))}}a=o=(Array.isArray(e)?(r=[],e):(s=Object.keys(e),r={},s)).length,l=t,a?s?s.some(function(i,n){return e[i](function(e,t){E(i,e,t)}),n===t-1}):e.some(function(e,i){return e(function(e,t){E(i,e,t)}),i===t-1}):d(null),u=!1};let n=i(596)},414:(e,t,i)=>{var n=i(33),r=i=i(550);r.v1=n,r.v4=i,e.exports=r},471:e=>{for(var t=[],i=0;i<256;++i)t[i]=(i+256).toString(16).substr(1);e.exports=function(e,i){i=i||0;var n=t;return[n[e[i++]],n[e[i++]],n[e[i++]],n[e[i++]],"-",n[e[i++]],n[e[i++]],"-",n[e[i++]],n[e[i++]],"-",n[e[i++]],n[e[i++]],"-",n[e[i++]],n[e[i++]],n[e[i++]],n[e[i++]],n[e[i++]],n[e[+i]]].join("")}},550:(e,t,i)=>{var n=i(814),r=i(471);e.exports=function(e,t,i){var o=t&&i||0,a=("string"==typeof e&&(t="binary"===e?new Array(16):null,e=null),(e=e||{}).random||(e.rng||n)());if(a[6]=15&a[6]|64,a[8]=63&a[8]|128,t)for(var s=0;s<16;++s)t[o+s]=a[s];return t||r(a)}},596:(e,t,i)=>{let n;e.exports="function"==typeof queueMicrotask?queueMicrotask.bind("undefined"!=typeof window?window:i.g):e=>(n=n||Promise.resolve()).then(e).catch(e=>setTimeout(()=>{throw e},0))},790:(e,t,i)=>{e.exports=function e(t,i,n){function r(a,s){if(!i[a]){if(!t[a]){if(o)return o(a,!0);var c=new Error("Cannot find module '"+a+"'");throw c.code="MODULE_NOT_FOUND",c}c=i[a]={exports:{}},t[a][0].call(c.exports,function(e){return r(t[a][1][e]||e)},c,c.exports,e,t,i,n)}return i[a].exports}for(var o=void 0,a=0;a<n.length;a++)r(n[a]);return r}({1:[function(e,t,n){(function(e){var i,n,r,o,a=e.MutationObserver||e.WebKitMutationObserver,s=a?(i=0,a=new a(l),n=e.document.createTextNode(""),a.observe(n,{characterData:!0}),function(){n.data=i=++i%2}):e.setImmediate||void 0===e.MessageChannel?"document"in e&&"onreadystatechange"in e.document.createElement("script")?function(){var t=e.document.createElement("script");t.onreadystatechange=function(){l(),t.onreadystatechange=null,t.parentNode.removeChild(t),t=null},e.document.documentElement.appendChild(t)}:function(){setTimeout(l,0)}:((r=new e.MessageChannel).port1.onmessage=l,function(){r.port2.postMessage(0)}),c=[];function l(){o=!0;for(var e,t,i=c.length;i;){for(t=c,c=[],e=-1;++e<i;)t[e]();i=c.length}o=!1}t.exports=function(e){1!==c.push(e)||o||s()}}).call(this,void 0!==i.g?i.g:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{}],2:[function(e,t,i){var n=e(1);function r(){}var o={},a=["REJECTED"],s=["FULFILLED"],c=["PENDING"];function l(e){if("function"!=typeof e)throw new TypeError("resolver must be a function");this.state=c,this.queue=[],this.outcome=void 0,e!==r&&g(this,e)}function u(e,t,i){this.promise=e,"function"==typeof t&&(this.onFulfilled=t,this.callFulfilled=this.otherCallFulfilled),"function"==typeof i&&(this.onRejected=i,this.callRejected=this.otherCallRejected)}function d(e,t,i){n(function(){var n;try{n=t(i)}catch(n){return o.reject(e,n)}n===e?o.reject(e,new TypeError("Cannot resolve promise with itself")):o.resolve(e,n)})}function E(e){var t=e&&e.then;if(e&&("object"==typeof e||"function"==typeof e)&&"function"==typeof t)return function(){t.apply(e,arguments)}}function g(e,t){var i=!1;function n(t){i||(i=!0,o.reject(e,t))}function r(t){i||(i=!0,o.resolve(e,t))}var a=h(function(){t(r,n)});"error"===a.status&&n(a.value)}function h(e,t){var i={};try{i.value=e(t),i.status="success"}catch(e){i.status="error",i.value=e}return i}(t.exports=l).prototype.catch=function(e){return this.then(null,e)},l.prototype.then=function(e,t){var i;return"function"!=typeof e&&this.state===s||"function"!=typeof t&&this.state===a?this:(i=new this.constructor(r),this.state!==c?d(i,this.state===s?e:t,this.outcome):this.queue.push(new u(i,e,t)),i)},u.prototype.callFulfilled=function(e){o.resolve(this.promise,e)},u.prototype.otherCallFulfilled=function(e){d(this.promise,this.onFulfilled,e)},u.prototype.callRejected=function(e){o.reject(this.promise,e)},u.prototype.otherCallRejected=function(e){d(this.promise,this.onRejected,e)},o.resolve=function(e,t){var i=h(E,t);if("error"===i.status)return o.reject(e,i.value);if(i=i.value)g(e,i);else{e.state=s,e.outcome=t;for(var n=-1,r=e.queue.length;++n<r;)e.queue[n].callFulfilled(t)}return e},o.reject=function(e,t){e.state=a,e.outcome=t;for(var i=-1,n=e.queue.length;++i<n;)e.queue[i].callRejected(t);return e},l.resolve=function(e){return e instanceof this?e:o.resolve(new this(r),e)},l.reject=function(e){var t=new this(r);return o.reject(t,e)},l.all=function(e){var t=this;if("[object Array]"!==Object.prototype.toString.call(e))return this.reject(new TypeError("must be an array"));var i=e.length,n=!1;if(!i)return this.resolve([]);for(var a=new Array(i),s=0,c=-1,l=new this(r);++c<i;)((e,r)=>{t.resolve(e).then(function(e){a[r]=e,++s!==i||n||(n=!0,o.resolve(l,a))},function(e){n||(n=!0,o.reject(l,e))})})(e[c],c);return l},l.race=function(e){var t=this;if("[object Array]"!==Object.prototype.toString.call(e))return this.reject(new TypeError("must be an array"));var i=e.length,n=!1;if(!i)return this.resolve([]);for(var a=-1,s=new this(r);++a<i;)(e=>{t.resolve(e).then(function(e){n||(n=!0,o.resolve(s,e))},function(e){n||(n=!0,o.reject(s,e))})})(e[a]);return s}},{1:1}],3:[function(e,t,n){(function(t){"function"!=typeof t.Promise&&(t.Promise=e(2))}).call(this,void 0!==i.g?i.g:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{2:2}],4:[function(e,t,i){var n="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},r=(()=>{try{return"undefined"!=typeof indexedDB?indexedDB:"undefined"!=typeof webkitIndexedDB?webkitIndexedDB:"undefined"!=typeof mozIndexedDB?mozIndexedDB:"undefined"!=typeof OIndexedDB?OIndexedDB:"undefined"!=typeof msIndexedDB?msIndexedDB:void 0}catch(e){}})();function o(e,t){e=e||[],t=t||{};try{return new Blob(e,t)}catch(r){if("TypeError"!==r.name)throw r;for(var i=new("undefined"!=typeof BlobBuilder?BlobBuilder:"undefined"!=typeof MSBlobBuilder?MSBlobBuilder:"undefined"!=typeof MozBlobBuilder?MozBlobBuilder:WebKitBlobBuilder),n=0;n<e.length;n+=1)i.append(e[n]);return i.getBlob(t.type)}}"undefined"==typeof Promise&&e(3);var a=Promise;function s(e,t){t&&e.then(function(e){t(null,e)},function(e){t(e)})}function c(e,t,i){"function"==typeof t&&e.then(t),"function"==typeof i&&e.catch(i)}function l(e){return"string"!=typeof e&&(console.warn(e+" used as a key, but it is not a string."),e=String(e)),e}function u(){if(arguments.length&&"function"==typeof arguments[arguments.length-1])return arguments[arguments.length-1]}var d="local-forage-detect-blob-support",E=void 0,g={},h=Object.prototype.toString,p="readonly",v="readwrite";function _(e){return"boolean"==typeof E?a.resolve(E):(t=e,new a(function(e){var i=t.transaction(d,v),n=o([""]);i.objectStore(d).put(n,"key"),i.onabort=function(t){t.preventDefault(),t.stopPropagation(),e(!1)},i.oncomplete=function(){var t=navigator.userAgent.match(/Chrome\/(\d+)/),i=navigator.userAgent.match(/Edge\//);e(i||!t||43<=parseInt(t[1],10))}}).catch(function(){return!1}).then(function(e){return E=e}));var t}function f(e){e=g[e.name];var t={};t.promise=new a(function(e,i){t.resolve=e,t.reject=i}),e.deferredOperations.push(t),e.dbReady?e.dbReady=e.dbReady.then(function(){return t.promise}):e.dbReady=t.promise}function m(e){(e=g[e.name].deferredOperations.pop())&&(e.resolve(),e.promise)}function S(e,t){if(e=g[e.name].deferredOperations.pop())return e.reject(t),e.promise}function T(e,t){return new a(function(i,n){if(g[e.name]=g[e.name]||{forages:[],db:null,dbReady:null,deferredOperations:[]},e.db){if(!t)return i(e.db);f(e),e.db.close()}var o=[e.name],a=(t&&o.push(e.version),r.open.apply(r,o));t&&(a.onupgradeneeded=function(t){var i=a.result;try{i.createObjectStore(e.storeName),t.oldVersion<=1&&i.createObjectStore(d)}catch(i){if("ConstraintError"!==i.name)throw i;console.warn('The database "'+e.name+'" has been upgraded from version '+t.oldVersion+" to version "+t.newVersion+', but the storage "'+e.storeName+'" already exists.')}}),a.onerror=function(e){e.preventDefault(),n(a.error)},a.onsuccess=function(){var t=a.result;t.onversionchange=function(e){e.target.close()},i(t),m(e)}})}function I(e){return T(e,!1)}function b(e){return T(e,!0)}function A(e,t){var i,n,r;return!e.db||(i=!e.db.objectStoreNames.contains(e.storeName),r=e.version<e.db.version,n=e.version>e.db.version,r&&(e.version!==t&&console.warn('The database "'+e.name+"\" can't be downgraded from version "+e.db.version+" to version "+e.version+"."),e.version=e.db.version),(n||i)&&(i&&(r=e.db.version+1,e.version<r)&&(e.version=r),1))}function y(e){return o([(e=>{for(var t=e.length,i=new ArrayBuffer(t),n=new Uint8Array(i),r=0;r<t;r++)n[r]=e.charCodeAt(r);return i})(atob(e.data))],{type:e.type})}function O(e){return e&&e.__local_forage_encoded_blob}function D(e){var t=this,i=t._initReady().then(function(){var e=g[t._dbInfo.name];if(e&&e.dbReady)return e.dbReady});return c(i,e,e),i}function N(e,t,i,n){void 0===n&&(n=1);try{var r=e.db.transaction(e.storeName,t);i(null,r)}catch(r){if(0<n&&(!e.db||"InvalidStateError"===r.name||"NotFoundError"===r.name))return a.resolve().then(function(){if(!e.db||"NotFoundError"===r.name&&!e.db.objectStoreNames.contains(e.storeName)&&e.version<=e.db.version)return e.db&&(e.version=e.db.version+1),b(e)}).then(function(){return(e=>{f(e);for(var t=g[e.name],i=t.forages,n=0;n<i.length;n++){var r=i[n];r._dbInfo.db&&(r._dbInfo.db.close(),r._dbInfo.db=null)}return e.db=null,I(e).then(function(t){return e.db=t,A(e)?b(e):t}).then(function(n){e.db=t.db=n;for(var r=0;r<i.length;r++)i[r]._dbInfo.db=n}).catch(function(t){throw S(e,t),t})})(e).then(function(){N(e,t,i,n-1)})}).catch(i);i(r)}}e={_driver:"asyncStorage",_initStorage:function(e){var t=this,i={db:null};if(e)for(var n in e)i[n]=e[n];var r=g[i.name],o=(r||(r={forages:[],db:null,dbReady:null,deferredOperations:[]},g[i.name]=r),r.forages.push(t),t._initReady||(t._initReady=t.ready,t.ready=D),[]);function s(){return a.resolve()}for(var c=0;c<r.forages.length;c++){var l=r.forages[c];l!==t&&o.push(l._initReady().catch(s))}var u=r.forages.slice(0);return a.all(o).then(function(){return i.db=r.db,I(i)}).then(function(e){return i.db=e,A(i,t._defaultConfig.version)?b(i):e}).then(function(e){i.db=r.db=e,t._dbInfo=i;for(var n=0;n<u.length;n++){var o=u[n];o!==t&&(o._dbInfo.db=i.db,o._dbInfo.version=i.version)}})},_support:(()=>{try{var e,t;return!(!r||!r.open)&&(e="undefined"!=typeof openDatabase&&/(Safari|iPhone|iPad|iPod)/.test(navigator.userAgent)&&!/Chrome/.test(navigator.userAgent)&&!/BlackBerry/.test(navigator.platform),t="function"==typeof fetch&&-1!==fetch.toString().indexOf("[native code"),(!e||t)&&"undefined"!=typeof indexedDB&&"undefined"!=typeof IDBKeyRange)}catch(e){return!1}})(),iterate:function(e,t){var i=this,n=new a(function(t,n){i.ready().then(function(){N(i._dbInfo,p,function(r,o){if(r)return n(r);try{var a=o.objectStore(i._dbInfo.storeName).openCursor(),s=1;a.onsuccess=function(){var i,n=a.result;n?(O(i=n.value)&&(i=y(i)),void 0!==(i=e(i,n.key,s++))?t(i):n.continue()):t()},a.onerror=function(){n(a.error)}}catch(r){n(r)}})}).catch(n)});return s(n,t),n},getItem:function(e,t){var i=this,n=(e=l(e),new a(function(t,n){i.ready().then(function(){N(i._dbInfo,p,function(r,o){if(r)return n(r);try{var a=o.objectStore(i._dbInfo.storeName).get(e);a.onsuccess=function(){var e=a.result;O(e=void 0===e?null:e)&&(e=y(e)),t(e)},a.onerror=function(){n(a.error)}}catch(r){n(r)}})}).catch(n)}));return s(n,t),n},setItem:function(e,t,i){var n=this,r=(e=l(e),new a(function(i,r){var o;n.ready().then(function(){return o=n._dbInfo,"[object Blob]"===h.call(t)?_(o.db).then(function(e){return e?t:(i=t,new a(function(e,t){var n=new FileReader;n.onerror=t,n.onloadend=function(t){t=btoa(t.target.result||""),e({__local_forage_encoded_blob:!0,data:t,type:i.type})},n.readAsBinaryString(i)}));var i}):t}).then(function(t){N(n._dbInfo,v,function(o,a){if(o)return r(o);try{var s=a.objectStore(n._dbInfo.storeName),c=(null===t&&(t=void 0),s.put(t,e));a.oncomplete=function(){i(t=void 0===t?null:t)},a.onabort=a.onerror=function(){var e=c.error||c.transaction.error;r(e)}}catch(o){r(o)}})}).catch(r)}));return s(r,i),r},removeItem:function(e,t){var i=this,n=(e=l(e),new a(function(t,n){i.ready().then(function(){N(i._dbInfo,v,function(r,o){if(r)return n(r);try{var a=o.objectStore(i._dbInfo.storeName).delete(e);o.oncomplete=function(){t()},o.onerror=function(){n(a.error)},o.onabort=function(){var e=a.error||a.transaction.error;n(e)}}catch(r){n(r)}})}).catch(n)}));return s(n,t),n},clear:function(e){var t=this,i=new a(function(e,i){t.ready().then(function(){N(t._dbInfo,v,function(n,r){if(n)return i(n);try{var o=r.objectStore(t._dbInfo.storeName).clear();r.oncomplete=function(){e()},r.onabort=r.onerror=function(){var e=o.error||o.transaction.error;i(e)}}catch(n){i(n)}})}).catch(i)});return s(i,e),i},length:function(e){var t=this,i=new a(function(e,i){t.ready().then(function(){N(t._dbInfo,p,function(n,r){if(n)return i(n);try{var o=r.objectStore(t._dbInfo.storeName).count();o.onsuccess=function(){e(o.result)},o.onerror=function(){i(o.error)}}catch(n){i(n)}})}).catch(i)});return s(i,e),i},key:function(e,t){var i=this,n=new a(function(t,n){e<0?t(null):i.ready().then(function(){N(i._dbInfo,p,function(r,o){if(r)return n(r);try{var a=o.objectStore(i._dbInfo.storeName),s=!1,c=a.openKeyCursor();c.onsuccess=function(){var i=c.result;i?0===e||s?t(i.key):(s=!0,i.advance(e)):t(null)},c.onerror=function(){n(c.error)}}catch(r){n(r)}})}).catch(n)});return s(n,t),n},keys:function(e){var t=this,i=new a(function(e,i){t.ready().then(function(){N(t._dbInfo,p,function(n,r){if(n)return i(n);try{var o=r.objectStore(t._dbInfo.storeName).openKeyCursor(),a=[];o.onsuccess=function(){var t=o.result;t?(a.push(t.key),t.continue()):e(a)},o.onerror=function(){i(o.error)}}catch(n){i(n)}})}).catch(i)});return s(i,e),i},dropInstance:function(e,t){t=u.apply(this,arguments);var i=this.config();return(e="function"!=typeof e&&e||{}).name||(e.name=e.name||i.name,e.storeName=e.storeName||i.storeName),s(i=e.name?(i=e.name===i.name&&this._dbInfo.db?a.resolve(this._dbInfo.db):I(e).then(function(t){var i=g[e.name],n=i.forages;i.db=t;for(var r=0;r<n.length;r++)n[r]._dbInfo.db=t;return t}),e.storeName?i.then(function(t){if(t.objectStoreNames.contains(e.storeName)){var i=t.version+1,n=(f(e),g[e.name]),o=n.forages;t.close();for(var s=0;s<o.length;s++){var c=o[s];c._dbInfo.db=null,c._dbInfo.version=i}return new a(function(t,n){var o=r.open(e.name,i);o.onerror=function(e){o.result.close(),n(e)},o.onupgradeneeded=function(){o.result.deleteObjectStore(e.storeName)},o.onsuccess=function(){var e=o.result;e.close(),t(e)}}).then(function(e){n.db=e;for(var t=0;t<o.length;t++){var i=o[t];i._dbInfo.db=e,m(i._dbInfo)}}).catch(function(t){throw(S(e,t)||a.resolve()).catch(function(){}),t})}}):i.then(function(t){f(e);var i=g[e.name],n=i.forages;t.close();for(var o=0;o<n.length;o++)n[o]._dbInfo.db=null;return new a(function(t,i){var n=r.deleteDatabase(e.name);n.onerror=function(){var e=n.result;e&&e.close(),i(n.error)},n.onblocked=function(){console.warn('dropInstance blocked for database "'+e.name+'" until all open connections are closed')},n.onsuccess=function(){var e=n.result;e&&e.close(),t(e)}}).then(function(e){i.db=e;for(var t=0;t<n.length;t++)m(n[t]._dbInfo)}).catch(function(t){throw(S(e,t)||a.resolve()).catch(function(){}),t})})):a.reject("Invalid arguments"),t),i}};var R="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",L=/^~~local_forage_type~([^~]+)~/,w="__lfsc__:",C="arbf",P="blob",M=Object.prototype.toString;function k(e){for(var t,i,n,r,o=.75*e.length,a=e.length,s=0,c=("="===e[e.length-1]&&(o--,"="===e[e.length-2])&&o--,o=new ArrayBuffer(o),new Uint8Array(o)),l=0;l<a;l+=4)t=R.indexOf(e[l]),i=R.indexOf(e[l+1]),n=R.indexOf(e[l+2]),r=R.indexOf(e[l+3]),c[s++]=t<<2|i>>4,c[s++]=(15&i)<<4|n>>2,c[s++]=(3&n)<<6|63&r;return o}function B(e){for(var t=new Uint8Array(e),i="",n=0;n<t.length;n+=3)i=(i=(i=(i+=R[t[n]>>2])+R[(3&t[n])<<4|t[n+1]>>4])+R[(15&t[n+1])<<2|t[n+2]>>6])+R[63&t[n+2]];return t.length%3==2?i=i.substring(0,i.length-1)+"=":t.length%3==1&&(i=i.substring(0,i.length-2)+"=="),i}var x={serialize:function(e,t){var i="";if(e&&(i=M.call(e)),e&&("[object ArrayBuffer]"===i||e.buffer&&"[object ArrayBuffer]"===M.call(e.buffer))){var n,r=w;e instanceof ArrayBuffer?(n=e,r+=C):(n=e.buffer,"[object Int8Array]"===i?r+="si08":"[object Uint8Array]"===i?r+="ui08":"[object Uint8ClampedArray]"===i?r+="uic8":"[object Int16Array]"===i?r+="si16":"[object Uint16Array]"===i?r+="ur16":"[object Int32Array]"===i?r+="si32":"[object Uint32Array]"===i?r+="ui32":"[object Float32Array]"===i?r+="fl32":"[object Float64Array]"===i?r+="fl64":t(new Error("Failed to get type for BinaryArray"))),t(r+B(n))}else if("[object Blob]"===i)(r=new FileReader).onload=function(){var i="~~local_forage_type~"+e.type+"~"+B(this.result);t(w+P+i)},r.readAsArrayBuffer(e);else try{t(JSON.stringify(e))}catch(i){console.error("Couldn't convert value into a JSON string: ",e),t(null,i)}},deserialize:function(e){if(e.substring(0,9)!==w)return JSON.parse(e);var t,i=e.substring(13),n=e.substring(9,13),r=(n===P&&L.test(i)&&(t=(e=i.match(L))[1],i=i.substring(e[0].length)),k(i));switch(n){case C:return r;case P:return o([r],{type:t});case"si08":return new Int8Array(r);case"ui08":return new Uint8Array(r);case"uic8":return new Uint8ClampedArray(r);case"si16":return new Int16Array(r);case"ur16":return new Uint16Array(r);case"si32":return new Int32Array(r);case"ui32":return new Uint32Array(r);case"fl32":return new Float32Array(r);case"fl64":return new Float64Array(r);default:throw new Error("Unkown type: "+n)}},stringToBuffer:k,bufferToString:B};function U(e,t,i,n){e.executeSql("CREATE TABLE IF NOT EXISTS "+t.storeName+" (id INTEGER PRIMARY KEY, key unique, value)",[],i,n)}function W(e,t,i,n,r,o){e.executeSql(i,n,r,function(e,a){a.code===a.SYNTAX_ERR?e.executeSql("SELECT name FROM sqlite_master WHERE type='table' AND name = ?",[t.storeName],function(e,s){s.rows.length?o(e,a):U(e,t,function(){e.executeSql(i,n,r,o)},o)},o):o(e,a)},o)}function F(e,t,i,n){var r=this,o=(e=l(e),new a(function(o,a){r.ready().then(function(){var s=t=void 0===t?null:t,c=r._dbInfo;c.serializer.serialize(t,function(t,l){l?a(l):c.db.transaction(function(i){W(i,c,"INSERT OR REPLACE INTO "+c.storeName+" (key, value) VALUES (?, ?)",[e,t],function(){o(s)},function(e,t){a(t)})},function(t){t.code===t.QUOTA_ERR&&(0<n?o(F.apply(r,[e,s,i,n-1])):a(t))})})}).catch(a)}));return s(o,i),o}var K={_driver:"webSQLStorage",_initStorage:function(e){var t=this,i={db:null};if(e)for(var n in e)i[n]="string"!=typeof e[n]?e[n].toString():e[n];var r=new a(function(e,n){try{i.db=openDatabase(i.name,String(i.version),i.description,i.size)}catch(e){return n(e)}i.db.transaction(function(r){U(r,i,function(){t._dbInfo=i,e()},function(e,t){n(t)})},n)});return i.serializer=x,r},_support:"function"==typeof openDatabase,iterate:function(e,t){var i=this,n=new a(function(t,n){i.ready().then(function(){var r=i._dbInfo;r.db.transaction(function(i){W(i,r,"SELECT * FROM "+r.storeName,[],function(i,n){for(var o=n.rows,a=o.length,s=0;s<a;s++){var c=o.item(s),l=(l=c.value)&&r.serializer.deserialize(l);if(void 0!==(l=e(l,c.key,s+1)))return void t(l)}t()},function(e,t){n(t)})})}).catch(n)});return s(n,t),n},getItem:function(e,t){var i=this,n=(e=l(e),new a(function(t,n){i.ready().then(function(){var r=i._dbInfo;r.db.transaction(function(i){W(i,r,"SELECT * FROM "+r.storeName+" WHERE key = ? LIMIT 1",[e],function(e,i){i=(i=i.rows.length?i.rows.item(0).value:null)&&r.serializer.deserialize(i),t(i)},function(e,t){n(t)})})}).catch(n)}));return s(n,t),n},setItem:function(e,t,i){return F.apply(this,[e,t,i,1])},removeItem:function(e,t){var i=this,n=(e=l(e),new a(function(t,n){i.ready().then(function(){var r=i._dbInfo;r.db.transaction(function(i){W(i,r,"DELETE FROM "+r.storeName+" WHERE key = ?",[e],function(){t()},function(e,t){n(t)})})}).catch(n)}));return s(n,t),n},clear:function(e){var t=this,i=new a(function(e,i){t.ready().then(function(){var n=t._dbInfo;n.db.transaction(function(t){W(t,n,"DELETE FROM "+n.storeName,[],function(){e()},function(e,t){i(t)})})}).catch(i)});return s(i,e),i},length:function(e){var t=this,i=new a(function(e,i){t.ready().then(function(){var n=t._dbInfo;n.db.transaction(function(t){W(t,n,"SELECT COUNT(key) as c FROM "+n.storeName,[],function(t,i){i=i.rows.item(0).c,e(i)},function(e,t){i(t)})})}).catch(i)});return s(i,e),i},key:function(e,t){var i=this,n=new a(function(t,n){i.ready().then(function(){var r=i._dbInfo;r.db.transaction(function(i){W(i,r,"SELECT key FROM "+r.storeName+" WHERE id = ? LIMIT 1",[e+1],function(e,i){i=i.rows.length?i.rows.item(0).key:null,t(i)},function(e,t){n(t)})})}).catch(n)});return s(n,t),n},keys:function(e){var t=this,i=new a(function(e,i){t.ready().then(function(){var n=t._dbInfo;n.db.transaction(function(t){W(t,n,"SELECT key FROM "+n.storeName,[],function(t,i){for(var n=[],r=0;r<i.rows.length;r++)n.push(i.rows.item(r).key);e(n)},function(e,t){i(t)})})}).catch(i)});return s(i,e),i},dropInstance:function(e,t){t=u.apply(this,arguments);var i=this.config(),n=((e="function"!=typeof e&&e||{}).name||(e.name=e.name||i.name,e.storeName=e.storeName||i.storeName),this),r=e.name?new a(function(t){var r,o=e.name===i.name?n._dbInfo.db:openDatabase(e.name,"","",0);e.storeName?t({db:o,storeNames:[e.storeName]}):t((r=o,new a(function(e,t){r.transaction(function(i){i.executeSql("SELECT name FROM sqlite_master WHERE type='table' AND name <> '__WebKitDatabaseInfoTable__'",[],function(t,i){for(var n=[],o=0;o<i.rows.length;o++)n.push(i.rows.item(o).name);e({db:r,storeNames:n})},function(e,i){t(i)})},function(e){t(e)})})))}).then(function(e){return new a(function(t,i){e.db.transaction(function(n){for(var r=[],o=0,s=e.storeNames.length;o<s;o++)r.push((e=>new a(function(t,i){n.executeSql("DROP TABLE IF EXISTS "+e,[],function(){t()},function(e,t){i(t)})}))(e.storeNames[o]));a.all(r).then(function(){t()}).catch(function(e){i(e)})},function(e){i(e)})})}):a.reject("Invalid arguments");return s(r,t),r}};function j(e,t){var i=e.name+"/";return e.storeName!==t.storeName&&(i+=e.storeName+"/"),i}function H(e,t){for(var i,n,r=e.length,o=0;o<r;){if((i=e[o])===(n=t)||"number"==typeof i&&"number"==typeof n&&isNaN(i)&&isNaN(n))return 1;o++}}var G={_driver:"localStorageWrapper",_initStorage:function(e){var t={};if(e)for(var i in e)t[i]=e[i];return t.keyPrefix=j(e,this._defaultConfig),!(()=>{var e="_localforage_support_test";try{localStorage.setItem(e,!0),localStorage.removeItem(e)}catch(e){return 1}})()||0<localStorage.length?((this._dbInfo=t).serializer=x,a.resolve()):a.reject()},_support:(()=>{try{return"undefined"!=typeof localStorage&&"setItem"in localStorage&&!!localStorage.setItem}catch(e){return!1}})(),iterate:function(e,t){var i=this,n=i.ready().then(function(){for(var t=i._dbInfo,n=t.keyPrefix,r=n.length,o=localStorage.length,a=1,s=0;s<o;s++){var c=localStorage.key(s);if(0===c.indexOf(n)){var l=(l=localStorage.getItem(c))&&t.serializer.deserialize(l);if(void 0!==(l=e(l,c.substring(r),a++)))return l}}});return s(n,t),n},getItem:function(e,t){var i=this,n=(e=l(e),i.ready().then(function(){var t=i._dbInfo,n=localStorage.getItem(t.keyPrefix+e);return n&&t.serializer.deserialize(n)}));return s(n,t),n},setItem:function(e,t,i){var n=this,r=(e=l(e),n.ready().then(function(){var i=t=void 0===t?null:t;return new a(function(r,o){var a=n._dbInfo;a.serializer.serialize(t,function(t,n){if(n)o(n);else try{localStorage.setItem(a.keyPrefix+e,t),r(i)}catch(t){"QuotaExceededError"!==t.name&&"NS_ERROR_DOM_QUOTA_REACHED"!==t.name||o(t),o(t)}})})}));return s(r,i),r},removeItem:function(e,t){var i=this,n=(e=l(e),i.ready().then(function(){var t=i._dbInfo;localStorage.removeItem(t.keyPrefix+e)}));return s(n,t),n},clear:function(e){var t=this,i=t.ready().then(function(){for(var e=t._dbInfo.keyPrefix,i=localStorage.length-1;0<=i;i--){var n=localStorage.key(i);0===n.indexOf(e)&&localStorage.removeItem(n)}});return s(i,e),i},length:function(e){var t=this.keys().then(function(e){return e.length});return s(t,e),t},key:function(e,t){var i=this,n=i.ready().then(function(){var t,n=i._dbInfo;try{t=localStorage.key(e)}catch(n){t=null}return t&&t.substring(n.keyPrefix.length)});return s(n,t),n},keys:function(e){var t=this,i=t.ready().then(function(){for(var e=t._dbInfo,i=localStorage.length,n=[],r=0;r<i;r++){var o=localStorage.key(r);0===o.indexOf(e.keyPrefix)&&n.push(o.substring(e.keyPrefix.length))}return n});return s(i,e),i},dropInstance:function(e,t){t=u.apply(this,arguments),(e="function"!=typeof e&&e||{}).name||(n=this.config(),e.name=e.name||n.name,e.storeName=e.storeName||n.storeName);var i=this,n=e.name?new a(function(t){e.storeName?t(j(e,i._defaultConfig)):t(e.name+"/")}).then(function(e){for(var t=localStorage.length-1;0<=t;t--){var i=localStorage.key(t);0===i.indexOf(e)&&localStorage.removeItem(i)}}):a.reject("Invalid arguments");return s(n,t),n}},V=Array.isArray||function(e){return"[object Array]"===Object.prototype.toString.call(e)},Y={},q={},z={INDEXEDDB:e,WEBSQL:K,LOCALSTORAGE:G},X=(e=[z.INDEXEDDB._driver,z.WEBSQL._driver,z.LOCALSTORAGE._driver],["dropInstance"]),Q=["clear","getItem","iterate","key","keys","length","removeItem","setItem"].concat(X),J={description:"",driver:e.slice(),name:"localforage",size:4980736,storeName:"keyvaluepairs",version:1};function $(e){for(var t=1;t<arguments.length;t++){var i=arguments[t];if(i)for(var n in i)i.hasOwnProperty(n)&&(V(i[n])?e[n]=i[n].slice():e[n]=i[n])}return e}function Z(e){var t,i,n;if(!(this instanceof Z))throw new TypeError("Cannot call a class as a function");for(t in z)z.hasOwnProperty(t)&&(n=(i=z[t])._driver,this[t]=n,Y[n]||this.defineDriver(i));this._defaultConfig=$({},J),this._config=$({},this._defaultConfig,e),this._driverSet=null,this._initDriver=null,this._ready=!1,this._dbInfo=null,this._wrapLibraryMethodsWithReady(),this.setDriver(this._config.driver).catch(function(){})}Z.prototype.config=function(e){if("object"!==(void 0===e?"undefined":n(e)))return"string"==typeof e?this._config[e]:this._config;if(this._ready)return new Error("Can't call config() after localforage has been used.");for(var t in e){if("storeName"===t&&(e[t]=e[t].replace(/\W/g,"_")),"version"===t&&"number"!=typeof e[t])return new Error("Database version must be a number.");this._config[t]=e[t]}return!("driver"in e&&e.driver)||this.setDriver(this._config.driver)},Z.prototype.defineDriver=function(e,t,i){var n=new a(function(t,i){try{var n=e._driver,r=new Error("Custom driver not compliant; see https://mozilla.github.io/localForage/#definedriver");if(e._driver){for(var o=Q.concat("_initStorage"),c=0,l=o.length;c<l;c++){var u=o[c];if((!H(X,u)||e[u])&&"function"!=typeof e[u])return void i(r)}for(var d=0,E=X.length;d<E;d++){var g=X[d];e[g]||(e[g]=(e=>function(){var t=new Error("Method "+e+" is not implemented by the current driver");return s(t=a.reject(t),arguments[arguments.length-1]),t})(g))}var h=function(i){Y[n]&&console.info("Redefining LocalForage driver: "+n),Y[n]=e,q[n]=i,t()};"_support"in e?e._support&&"function"==typeof e._support?e._support().then(h,i):h(!!e._support):h(!0)}else i(r)}catch(r){i(r)}});return c(n,t,i),n},Z.prototype.driver=function(){return this._driver||null},Z.prototype.getDriver=function(e,t,i){return c(e=Y[e]?a.resolve(Y[e]):a.reject(new Error("Driver not found.")),t,i),e},Z.prototype.getSerializer=function(e){var t=a.resolve(x);return c(t,e),t},Z.prototype.ready=function(e){var t=this,i=t._driverSet.then(function(){return null===t._ready&&(t._ready=t._initDriver()),t._ready});return c(i,e,e),i},Z.prototype.setDriver=function(e,t,i){var n=this,r=(V(e)||(e=[e]),this._getSupportedDrivers(e));function o(){n._config.driver=n.driver()}function s(e){return n._extend(e),o(),n._ready=n._initStorage(n._config),n._ready}return e=null!==this._driverSet?this._driverSet.catch(function(){return a.resolve()}):a.resolve(),this._driverSet=e.then(function(){var e=r[0];return n._dbInfo=null,n._ready=null,n.getDriver(e).then(function(e){n._driver=e._driver,o(),n._wrapLibraryMethodsWithReady(),n._initDriver=function(e){return function(){var t=0;return function i(){for(;t<e.length;){var r=e[t];return t++,n._dbInfo=null,n._ready=null,n.getDriver(r).then(s).catch(i)}o();var c=new Error("No available storage method found.");return n._driverSet=a.reject(c),n._driverSet}()}}(r)})}).catch(function(){o();var e=new Error("No available storage method found.");return n._driverSet=a.reject(e),n._driverSet}),c(this._driverSet,t,i),this._driverSet},Z.prototype.supports=function(e){return!!q[e]},Z.prototype._extend=function(e){$(this,e)},Z.prototype._getSupportedDrivers=function(e){for(var t=[],i=0,n=e.length;i<n;i++){var r=e[i];this.supports(r)&&t.push(r)}return t},Z.prototype._wrapLibraryMethodsWithReady=function(){for(var e=0,t=Q.length;e<t;e++)((e,t)=>{e[t]=function(){var i=arguments;return e.ready().then(function(){return e[t].apply(e,i)})}})(this,Q[e])},Z.prototype.createInstance=function(e){return new Z(e)},K=new Z,t.exports=K},{3:3}]},{},[4])(4)},814:e=>{var t,i,n="undefined"!=typeof crypto&&crypto.getRandomValues&&crypto.getRandomValues.bind(crypto)||"undefined"!=typeof msCrypto&&"function"==typeof window.msCrypto.getRandomValues&&msCrypto.getRandomValues.bind(msCrypto);n?(t=new Uint8Array(16),e.exports=function(){return n(t),t}):(i=new Array(16),e.exports=function(){for(var e,t=0;t<16;t++)!(3&t)&&(e=4294967296*Math.random()),i[t]=e>>>((3&t)<<3)&255;return i})}},t={};function i(n){var r=t[n];return void 0!==r||(r=t[n]={exports:{}},e[n](r,r.exports,i)),r.exports}i.d=(e,t)=>{for(var n in t)i.o(t,n)&&!i.o(e,n)&&Object.defineProperty(e,n,{enumerable:!0,get:t[n]})},i.g=function(){if("object"==typeof globalThis)return globalThis;try{return this||new Function("return this")()}catch(e){if("object"==typeof window)return window}}(),i.o=(e,t)=>Object.prototype.hasOwnProperty.call(e,t),i.r=e=>{"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})};var n,r={};{i.r(r),i.d(r,{default:()=>Fi});let te={URL:"URL",LOGGED_IN_STATUS:"moe_logged_in_status",FIRST_VISIT:"moe_first_visit"},ie={ID:"USER_ATTRIBUTE_UNIQUE_ID",EMAIL:"USER_ATTRIBUTE_USER_EMAIL",NAME:"USER_ATTRIBUTE_USER_NAME",FIRST_NAME:"USER_ATTRIBUTE_USER_FIRST_NAME",LAST_NAME:"USER_ATTRIBUTE_USER_LAST_NAME",MOBILE:"USER_ATTRIBUTE_USER_MOBILE",GENDER:"USER_ATTRIBUTE_USER_GENDER",BDAY:"USER_ATTRIBUTE_USER_BDAY",ID_MODIFIED:"USER_ID_MODIFIED_FROM"},ne={NUMBER:"number"},re={MOE_LIFECYCLE:{TOPIC_NAME:"MOE_LIFECYCLE",EVENT_NAMES:{MOE_INIT:"SDK_INITIALIZED",DEVICE_UUID:"DEVICE_UUID",SDK_DISABLED:"SDK_DISABLED",WEBP_INIT:"WEBP_INITIALIZED"}},USER_LIFECYCLE:{TOPIC_NAME:"USER_LIFECYCLE",EVENT_NAMES:{USER_IDENTITY_UPDATE:"USER_IDENTITY_UPDATE",LOGOUT:"LOGOUT"}},SPA_LIFECYCLE:{TOPIC_NAME:"SPA",EVENT_NAMES:{PAGE_CHANGED:"PAGE_CHANGED"}}},oe={SCRIPT_URL:"http://localhost:3001/sample.js",EDITOR_QUERY_PARAM:"moeWpE",NO_LIVE_CAMPAIGN:"MoeWpLive",CHECK_TEST_WEBP:"moeWpT",VERSION_FILE:"https://app-cdn.moengage.com/personalization-ui/editor/version.json",STAGING_EDITOR_FILE:"https://app-cdn.moengage.com/personalization-ui/editor/moe-web-editor.staging.js",STAGING_ERROR:"Version not found in staging",EDITOR_FILE:e=>`https://app-cdn.moengage.com/personalization-ui/editor/moe-web-editor.${e}.js`,CLUSTER_ENVIRONMENT_MAP:{DC_1:"sdk-01.moengage.com",DC_2:"sdk-02.moengage.com",DC_3:"sdk-03.moengage.com",DC_4:"sdk-04.moengage.com",DC_5:"sdk-05.moengage.com",DC_6:"sdk-06.moengage.com",DC_100:"sdk-100.moengage.com"},CLUSTERS:{dc_1:"DC_1",dc_2:"DC_2",dc_3:"DC_3",dc_4:"DC_4",dc_5:"DC_5",dc_6:"DC_6",dc_100:"DC_100"},EVENTS:{IMPRESSION:"MOE_WEBP_MESSAGE_SHOWN",CLICK:"MOE_WEBP_MESSAGE_CLICKED"},MOE_UUID:"moe_uuid",RETRY_INTERVAL:3e3,RETRY_MAX_TIME:30,PRE_PROD:"PRE_PROD",MAX_EVENTS_FOR_IN_SESSION:10,MAX_RETRY_OPERATION_ATTEMPTES:20,FUNCTION_DEBOUNCE_TIME:500,ANTI_FLICKER_STYLESHEET:"moe-flicker-style",ANTI_FLICKER_HIDE:"moe-anti-flicker-hide",ANTI_FLICKER_SHOW:"moe-anti-flicker-show",ANTI_FLICKER_CLASSNAME:"moe-anti-flicker-style",SYNC_TIME_FOR_WEB_ACTION_EVENTS:1440,DATA_MOE_SELECTOR_ID:"data-moe-id"},ae={PageEventHistoryManager:"MoengagePageEventHistoryManager"},se={WEB_P_EVENT_WATCHER_MAX_RETRIES:5},ce={ELEMENT_BORDER_CLASS:"moe-show-personalized-experience",DATA_ATTRIBUTE:{LABEL_NAME:"data-moe-personalized-label",BACKUP_TITLE:"data-moe-backup-title"},STYLE:{STYLE_ID:"moe-personalized-experience-css",STYLE_DATA:"\n    .moe-show-personalized-experience {\n      outline-offset: -3px;\n      outline: 3px dashed #06A6B7;\n      border: 3px dashed #06A6B7;\n    }\n    .tooltip {\n      visibility: hidden;\n      opacity: 0;\n      transition: opacity 0.2s, visibility 0.2s;\n      color: #fff;\n      border: 1px solid #06A6B7;\n      border-radius: 3px;\n      background-color: #06A6B7;\n      padding: 4px;\n      font-size: 12px;\n      white-space: nowrap;\n      position: fixed;\n      z-index: 1000;\n      pointer-events: none; /* Ensures the tooltip doesn't interfere with mouse events */\n    }\n    .tooltip.visible {\n      visibility: visible;\n      opacity: 1;\n    }\n    "},LABELS:{update:"Text edited",attribute:"Attributes updated",tracking:"Tracking enabled",insert:"Custom HTML added",insert_js:"",update_outerhtml:"HTML edited",rearrange:"Element rearranged",insert_image:"Image added",replace:"Element replaced"}},le={WEBP:"MoeWebP",PAGE_CONTEXT:"moePageContext"},ue={USER_DATA:"USER_DATA",IDENTITY_MAP:"IDENTITY_MAP",DEVICE_DATA:"DEVICE_DATA",SESSION:"SESSION",SDK_DISABLED:"SDK_DISABLED",INIT_DATA:"INIT_DATA",WEB_SETTINGS:"WEB_SETTINGS"},de={SESSION:"SESSION",NUMBER_OF_SESSIONS:"numberOfSessions"},Ee={LIVE:"v1/experiences/web/live",TEST:"v1/experiences/web/test",STATS:"v1/experiences/web/stats",WEB_ACTION:"v1/experiences/web/actions",LIVE_RECOMMENDATIONS:"v1/experiences/web/live_recom",SPLIT_URL:"v1/experiences/web/split",TAB_DATA:"v1/experiences/web/recommendations",FETCH:"v1/experiences/sdk/fetch"},ge={DATABASE_NAME:"moe_webp",EXPERIENCES:{STORE_NAME:"experiences"},AI_EXPERIENCES:{STORE_NAME:"ai_experiences",AI_EXPERIENCE_CONTEXT:"ai_experience_context",WEB_ACTION_EVENTS:"web_action_events",WEB_ACTIONS_LAST_FETCHED_TIME:"web_actions_last_fetched_time"},META:{STORE_NAME:"meta",LAST_FETCHED_TIME:"last_fetched_time",USER_IN_GCG:"user_in_gcg"},IN_SESSION:{STORE_NAME:"inSession",IN_SESSION_EVENTS:"in_session_events",IN_SESSION_EVENTS_HISTORY:"in_session_events_history"},SPLIT_EXPERIENCES:{STORE_NAME:"split_experiences"},TABBED_EXPERIENCES:{STORE_NAME:"tabbed_experiences"}};function o(e,t,i){return null!=e&&t?(e=e[(t=Array.isArray(t)?t:t.split("."))[0]])&&1<t.length?o(e,t.slice(1),i):void 0===e?i||null:e:null}class he{static set(e,t){he.baseLogTag,window&&(window.moeInternals?window.moeInternals.ephemeral||(window.moeInternals.ephemeral={}):(window.moeInternals={},window.moeInternals.ephemeral={}),window.moeInternals.ephemeral[e]=t)}static get(e){return o(window,"moeInternals.ephemeral."+e,null)}static clear(){window&&(window.moeInternals={},window.moeInternals.ephemeral={})}}he.baseLogTag="EphemeralStorage";let pe={INIT_DATA:"initData",BROWSER_DETAILS:"browserDetails",UNIFIED_LOGS:"unifiedLogs",HAS_USER_LOGGED_OUT:"hasUserLoggedOut"},ve={USER_DATA:"USER_DATA",PUSH_TOKEN:"PUSH_TOKEN",SUBSCRIPTION_DETAILS:"SUBSCRIPTION_DETAILS",SETUP_TIME:"SETUP_TIME",OPT_IN_SHOWN_TIME:"OPT_IN_SHOWN_TIME",OPTED_STATUS_TRACK_TIME:"OPTED_STATUS_TRACK_TIME",SOFT_ASK_STATUS:"SOFT_ASK_STATUS",HARD_ASK_STATUS:"HARD_ASK_STATUS",WEB_SETTINGS:"WEB_SETTINGS",GRACEFUL_DATA:"GRACEFUL_DATA",Q:{PREFIX:"Q",REPORT:"REPORT",DEVICE:"DEVICE"},INIT_DATA:"INIT_DATA",OLD_SDK:{USER_DATA:"moengage_data",SUBSCRIPTION_DETAILS:"MOE_PUSH_ENDPOINT",PUSH_TOKEN:"MOE_PUSH_TOKEN"},BROWSER_DETAILS:"browserDetails",SESSION:"SESSION",DEVICE_DATA:"DEVICE_DATA",IDENTITY_MAP:"IDENTITY_MAP",SDK_VERSION:"SDK_VERSION",SDK_DISABLED:"SDK_DISABLED"},_e={SESSION_COOKIE:{EXPIRY_YEARS:2}},fe="COOKIE_SHARING",me={COOKIE_NAME_MAPPING:{[ve.USER_DATA]:"moe_u_d",[ve.SUBSCRIPTION_DETAILS]:"moe_s_d",[ve.PUSH_TOKEN]:"moe_p_t",[ve.OPT_IN_SHOWN_TIME]:"moe_o_s_t",[ve.SOFT_ASK_STATUS]:"moe_s_a_s",[ve.HARD_ASK_STATUS]:"moe_h_a_s",[ve.SESSION]:"moe_s_n",[ve.DEVICE_DATA]:"moe_d_d",[ve.IDENTITY_MAP]:"moe_i_m",[ve.SDK_DISABLED]:"moe_dis",COOKIE_SHARING:"moe_c_s"},PERMISSION_STATE_MAPPING:{prompt:2,granted:1,dismissed:3,denied:0,shown:4,"not shown":5,allowed:6},SUBSCRIPTION_DETAILS_KEYS:{domain:"d",token:"t",endpoint:"e",keys:"k",p256dh:"p",auth:"a"},USER_DATA_KEYS:{attributes:"a",subscribedToOldSdk:"s_old",deviceUuid:"d_id",deviceAdded:"d_added"},ATTRIBUTE_KEYS:{key:"k",value:"v",updated_at:"u_at"},IDENTITY_MAP_KEYS:{userIdentities:"u_i",previousIdentities:"p_i",previousIdentitiesUpdatedTime:"p_i_u_t"},SESSION_KEYS:{sessionKey:"s_k",sessionStartTime:"s_s_t",sessionMaxTime:"s_m_t",customIdentifiersToTrack:"c_i_t_t",sessionExpiryTime:"s_e_t",numberOfSessions:"n_o_s",currentSource:"c_s"},SOURCE_KEYS:{source:"s",medium:"m",source_url:"s_u",term:"t",campaign_name:"c_n",campaign_id:"c_id",content:"c",extra:"e"},DEVICE_DATA_KEYS:{deviceUniqueId:"d_uid"}},Se={USER_ATTRIBUTE:"EVENT_ACTION_USER_ATTRIBUTE",UNSUBSCRIBED:"MOE_WEB_UNSUBSCRIBED",WEB_SESSION_START:"EVENT_ACTION_WEB_SESSION_START",PAGE_VIEWED:"MOE_PAGE_VIEWED",WEB_OPTIN_BANNER_LOAD:"MOE_WEB_OPTIN_BANNER_LOAD",WEB_OPTIN_CLOSED:"MOE_WEB_OPTIN_CLOSED",WEB_OPTIN_ACCEPTED:"MOE_WEB_OPTIN_ACCEPTED",USER_SUBSCRIBED:"MOE_USER_SUBSCRIBED",OPT_IN_SHOWN:"MOE_OPT_IN_SHOWN",OPT_IN_ALLOWED:"MOE_OPT_IN_ALLOWED",OPT_IN_DISMISSED:"MOE_OPT_IN_DISMISSED",OPT_IN_BLOCKED:"MOE_OPT_IN_BLOCKED",OPT_IN_ATTEMPT:"MOE_OPT_IN_ATTEMPT",LOGOUT:"MOE_LOGOUT",DEVICE_ATTRIBUTE:"EVENT_ACTION_DEVICE_ATTRIBUTE",PERMISSION_ALLOWED:"MOE_PUSH_PERMISSION_STATE_ALLOWED",PERMISSION_BLOCKED:"MOE_PUSH_PERMISSION_STATE_BLOCKED",MOE_PAGE_EXIT:"MOE_PAGE_EXIT",MOE_PAGE_SCROLL:"MOE_PAGE_SCROLL",MOE_PAGE_URL_EVENT:"MOE_PAGE_URL_EVENT",MOE_EXIT:"MOE_EXIT"},Te={URL:"URL",LOGGED_IN_STATUS:"moe_logged_in_status",FIRST_VISIT:"moe_first_visit"},Ie={ID:"USER_ATTRIBUTE_UNIQUE_ID",EMAIL:"USER_ATTRIBUTE_USER_EMAIL",NAME:"USER_ATTRIBUTE_USER_NAME",FIRST_NAME:"USER_ATTRIBUTE_USER_FIRST_NAME",LAST_NAME:"USER_ATTRIBUTE_USER_LAST_NAME",MOBILE:"USER_ATTRIBUTE_USER_MOBILE",GENDER:"USER_ATTRIBUTE_USER_GENDER",BDAY:"USER_ATTRIBUTE_USER_BDAY",ID_MODIFIED:"USER_ID_MODIFIED_FROM"},be=[Ie.ID,Ie.ID_MODIFIED],Ae={MOE_LIFECYCLE:{TOPIC_NAME:"MOE_LIFECYCLE",EVENT_NAMES:{MOE_INIT:"SDK_INITIALIZED",SETTINGS_FETCHED:"SETTINGS_FETCHED",EVENT_TRACKED:"EVENT_TRACKED",DEVICE_UUID:"DEVICE_UUID",MOE_INIT_COMPLETED:"SDK_INITIALIZATION_COMPLETED",CARDS_INIT:"CARDS_INITIALIZED",SDK_DISABLED:"SDK_DISABLED",SDK_ENABLED:"SDK_ENABLED",OSM_INIT:"OSM_INITIALIZED",WEBP_INIT:"WEBP_INITIALIZED"}},OPT_IN_LIFECYCLE:{TOPIC_NAME:"MOE_OPT_IN",EVENT_NAMES:{HARD_ASK_SHOWN:"HARD_ASK_SHOWN",HARD_ASK_DISMISSED:"HARD_ASK_DISMISSED",HARD_ASK_ATTEMPTED:"HARD_ASK_ATTEMPTED",HARD_ASK_ALLOWED:"HARD_ASK_ALLOWED",HARD_ASK_DENIED:"HARD_ASK_DENIED",SOFT_ASK_SHOWN:"SOFT_ASK_SHOWN",SOFT_ASK_DISMISSED:"SOFT_ASK_DISMISSED",SOFT_ASK_ALLOWED:"SOFT_ASK_ALLOWED"}},INAPP_LIFECYCLE:{TOPIC_NAME:"INAPP_LIFECYCLE",EVENT_NAMES:{MODULE_LOADED:"MODULE_LOADED",OSM_RENDERED:"OSM_RENDERED"}},USER_LIFECYCLE:{TOPIC_NAME:"USER_LIFECYCLE",EVENT_NAMES:{USER_IDENTITY_UPDATE:"USER_IDENTITY_UPDATE",LOGOUT:"LOGOUT"}},SPA_LIFECYCLE:{TOPIC_NAME:"SPA",EVENT_NAMES:{PAGE_CHANGED:"PAGE_CHANGED"}}},ye={dc_1:"DC_1",dc_2:"DC_2",dc_3:"DC_3",dc_4:"DC_4",dc_5:"DC_5",dc_6:"DC_6",dc_100:"DC_100"},Oe={DC_1:"sdk-01.moengage.com",DC_2:"sdk-02.moengage.com",DC_3:"sdk-03.moengage.com",DC_4:"sdk-04.moengage.com",DC_5:"sdk-05.moengage.com",DC_6:"sdk-06.moengage.com",DC_100:"sdk-100.moengage.com",EU:"sdk-02.moengage.com",IN:"sdk-03.moengage.com"},De={MOE_DASHBOARD:"https://dashboard.moengage.com",WEBSDK_DOCS:"https://developers.moengage.com/hc/en-us/articles/360060713252-Web-SDK-Integration",SELF_HANDLED_DOCS:"https://developers.moengage.com/hc/en-us/articles/360061219351-Configure-Self-Handled-Opt-In"},Ne={SESSION:"SESSION",SESSION_KEY:"sessionKey",SESSION_START_TIME:"sessionStartTime",SESSION_EXPIRY_TIME:"sessionExpiryTime",SESSION_MAX_TIME:"sessionMaxTime",SESSION_ENABLED:"sessionEnabled",CUSTOM_IDENTIFIERS_TO_TRACK:"customIdentifiersToTrack",CURRENT_SOURCE:"currentSource",NUMBER_OF_SESSIONS:"numberOfSessions"},Re={DATABASE_NAME:"moe_tracking",STORE_NAME:"events"},Le={DATABASE_NAME:"moe_tracking",STORE_NAME:"batched_events"},we={DATABASE_NAME:"moe_database",STORE_NAME:"moe_data"},Ce={UUID:"moe_uuid"};const Pe={OSM:{CLICK:"MOE_ONSITE_MESSAGE_CLICKED",IMPRESSION:"MOE_ONSITE_MESSAGE_SHOWN",DISMISS:"MOE_ONSITE_MESSAGE_DISMISSED",AUTO_DISMIS:"MOE_ONSITE_MESSAGE_AUTO_DISMISS",DELIVERED:"MOE_ONSITE_MESSAGE_DELIVERED",TYPE:"onsite"},WP:{CLICK:"MOE_WEBP_MESSAGE_CLICKED",IMPRESSION:"MOE_WEBP_MESSAGE_SHOWN",DISMISS:"MOE_WEBP_MESSAGE_DISMISSED",DELIVERED:"MOE_WEBP_MESSAGE_DELIVERED",TYPE:"webp"}};let Me={DATABASE_NAME:"moe_database",OFFLINE_SYNC_EVENT:"moe_offline_data_sync",STORES:{OFFLINE_DATA:{NAME:"offline_data"}}},ke={API:{REPORT_ADD:"v2/sdk/report/"},CONFIG:{TIME_BETWEEN_BATCHES:15e3}},Be={FIRST_SEEN_SESSIONS:1},xe={TOPIC:"MOE_AUTOMATED_EVENTS",NAMES:[Se.UNSUBSCRIBED,Se.WEB_SESSION_START,Se.PAGE_VIEWED,Se.WEB_OPTIN_BANNER_LOAD,Se.WEB_OPTIN_CLOSED,Se.WEB_OPTIN_ACCEPTED,Se.USER_SUBSCRIBED,Se.OPT_IN_ATTEMPT,Se.OPT_IN_SHOWN,Se.OPT_IN_ALLOWED,Se.OPT_IN_DISMISSED,Se.OPT_IN_BLOCKED,Se.PERMISSION_ALLOWED,Se.PERMISSION_BLOCKED,Se.LOGOUT,Pe.OSM.CLICK,Pe.OSM.IMPRESSION,Pe.OSM.DISMISS,Pe.OSM.AUTO_DISMIS]},Ue=[Se.OPT_IN_ATTEMPT],We={MOE_PUSH_OPTED:"moe_push_opted"},Fe={END_POINT:"v1/sdk_logging/"},Ke={API:{DEVICE_ADD:"v2/device/add",DEVICE_TOKEN_CHECK:"v2/device/token-check",REPORT_ADD:"v2/report/add"},MAX_PAYLOAD_SIZE:195},je={TV:"tv",TABLET:"tablet",MOBILE:"mobile",WEB:"web"},He={TIZEN:"Tizen",WEB_OS:"WebOS",XBOX:"Xbox",VIZIO:"viziotv",DEFAULT:"SmartTV"},Ge="User is offline.",Ve=[{moeName:"uid",attributeName:"USER_ATTRIBUTE_UNIQUE_ID",programName:"id"},{moeName:"u_em",attributeName:"USER_ATTRIBUTE_USER_EMAIL",programName:"email"},{moeName:"u_gd",attributeName:"USER_ATTRIBUTE_USER_GENDER",programName:"gender"},{moeName:"u_bd",attributeName:"USER_ATTRIBUTE_USER_BDAY",programName:"birthday"},{moeName:"u_n",attributeName:"USER_ATTRIBUTE_USER_NAME",programName:"name"},{moeName:"u_fn",attributeName:"USER_ATTRIBUTE_USER_FIRST_NAME",programName:"first_name"},{moeName:"u_ln",attributeName:"USER_ATTRIBUTE_USER_LAST_NAME",programName:"last_name"},{moeName:"u_mb",attributeName:"USER_ATTRIBUTE_USER_MOBILE",programName:"mobile"}],Ye=["Google Chrome","Mozilla Firefox","Opera","Apple Safari","Edge"],qe="identifiers",ze=[ve.DEVICE_DATA];function a(){return window[window.moengage_object||"Moengage"]}class Xe{static logData(e,t){return{log_type:e,sent_time:(new Date).toISOString(),lake_fields:t}}static setRemoteLogging(e,t){return this.isTrackingEnabled||(this.logLevel=e,this.isTrackingEnabled=t),this.isTrackingEnabled}static log(e,t,i,n,...r){!this.isTrackingEnabled||e!==this.logLevel&&"verbose"!==this.logLevel||a().remoteLogs.addRemoteLogs(this.logData(e,{msg:i+[...r].toString(),file_name:t,trace:n}))}}let Qe="color: white; background: #41AE55; border-radius: 5px;";class Je{static setLogLevel(e,t){var i=Je.baseLogTag+".setLogLevel";null==he.get(pe.UNIFIED_LOGS)&&he.set(pe.UNIFIED_LOGS,[]),null==e?Je.logLevel=0:e in[0,1,2]?0<(Je.logLevel=e)&&t&&Je.releaseAllLogs():Je.warn(0,i,"Value",e,"not supported for setDebugLevel(). Current log level is",Je.logLevel,". Debug level can only be [0, 1, 2]")}static setLogTabStyle(e){Je.tagLogStyle=Je.tagLogStyle.replace("#48beab",e)}static log(e,t,i,...n){e<=Je.logLevel?console.log("%c "+Je.logBrand+" %c %c info %c %c "+t+" ",Qe,"","color: white; background: #18a0bf; border-radius: 5px;","",Je.tagLogStyle,i,...n):Je.cacheLog(()=>{Je.log(e,t,i,...n)})}static remoteLogTracking(e,t,i,n,...r){Xe.log(t,i,n,...r),this.log(e,i,n,...r)}static error(e,t,i,...n){var r;null!=(r=n[n.length-1])&&r.isCached||Xe.log("error",t,i,...n),e<=Je.logLevel?console.error("%c "+Je.logBrand+" %c %c error %c %c "+t+" ",Qe,"","color: white; background: #cc0a0a; border-radius: 5px;","",Je.tagLogStyle,i,...n.slice(0,-1)):Je.cacheLog(()=>{Je.error(e,t,i,...n,{isCached:!0})})}static warn(e,t,i,...n){var r;null!=(r=n[n.length-1])&&r.isCached||Xe.log("warning",t,i,...n),e<=Je.logLevel?console.warn("%c "+Je.logBrand+" %c %c warn %c %c "+t+" ",Qe,"","color: white; background: #e8ab51; border-radius: 5px;","",Je.tagLogStyle,i,...n.slice(0,-1)):Je.cacheLog(()=>{Je.warn(e,t,i,...n,{isCached:!0})})}static customLabel(e,t,i,...n){e<=Je.logLevel?console.log("%c "+Je.logBrand+" %c %c "+t+" %c %c "+i+" %c ",Qe,"",Je.tagLogStyle,"","color: white; background: #a400ff; border-radius: 5px;","",...n):Je.cacheLog(()=>{Je.customLabel(e,t,i,...n)})}static image(e,t){e<=Je.logLevel?console.log("%c+","font-size: 1px; padding: 20px 80px; line-height: 45px; background: url("+t+"); background-size: 160px 90px; color: transparent;"):Je.cacheLog(()=>{Je.image(e,t)})}static releaseAllLogs(){var e=he.get(pe.UNIFIED_LOGS),t=e.length,i=e;if(he.set(pe.UNIFIED_LOGS,[]),0<t){Je.log(0,"Logger.releaseAllLogs","<---- HISTORICAL LOGS BEGIN ----\x3e");for(let e=0;e<t;e++)i[e]();Je.log(0,"Logger.releaseAllLogs","<---- HISTORICAL LOGS END ----\x3e")}}static setLogBrand(e){Je.logBrand=e}static setBrandColor(e){Qe="color: white; background: "+e+"; border-radius: 5px;"}static cacheLog(e){let t=he.get(pe.UNIFIED_LOGS);(t=null==t?[]:t).push(e),he.set(pe.UNIFIED_LOGS,t)}}Je.baseLogTag="Logger",Je.logBrand="MoEngage",Je.logLevel=0,Je.tagLogStyle="color: white; background: #48beab; border-radius: 5px;";let $e=e=>{if(e){var t=e.indexOf("?");if(t<0)return{};t=(e=e.slice(t+1)).replace("?","").split("&");let i={};return t.forEach(e=>{var t=(e=e.split("="))[0];e=decodeURIComponent(e[1]||""),i[t]?"[object Array]"===Object.prototype.toString.call(i[t])?i[t].push(e):i[t]=[i[t],e]:i[t]=e}),JSON.parse(JSON.stringify(i))}return{}};class Ze{static get(e,t){return Ze.makeNetworkCall(n.METHODS.GET,e,t)}static post(e,t){return Ze.makeNetworkCall(n.METHODS.POST,e,t)}static makeNetworkCall(e,t,i={}){return new Promise((n,r)=>{var a=JSON.stringify(o(i,"postData",null));t=((e,t)=>{if(t){for(var i in"?"!==e[e.length-1]&&(e+="?"),t)t.hasOwnProperty(i)&&null!=t[i]&&(e+=i+"="+encodeURIComponent(t[i])+"&");"&"===e[e.length-1]&&(e=e.slice(0,-1))}return e})(t,o(i,"queryParams",null));let s=new XMLHttpRequest;s.open(e,t,!0),Ze.addRequestHeaders(s,o(i,"headers",{})),s.onreadystatechange=()=>{4===s.readyState&&200===s.status||4===s.readyState&&410===s.status?n({status:s.status,responseText:s.responseText}):4===s.readyState&&200!==s.status&&r({code:s.status,reason:s.responseText})},s.send(a)})}static addRequestHeaders(e,t){for(var i in t)t.hasOwnProperty(i)&&e.setRequestHeader(i,t[i]);return e}}(r=(r=n=n||{}).METHODS||(r.METHODS={})).GET="GET",r.POST="POST";var s,c,l,u,d,E=i(790),g=function(e,t,i,n){return new(i=i||Promise)(function(r,o){function a(e){try{c(n.next(e))}catch(e){o(e)}}function s(e){try{c(n.throw(e))}catch(e){o(e)}}function c(e){var t;e.done?r(e.value):((t=e.value)instanceof i?t:new i(function(e){e(t)})).then(a,s)}c((n=n.apply(e,t||[])).next())})};class et{static initialize(){return g(this,void 0,void 0,function*(){var e;return null==et.ready&&(et.experiencesStore=E.createInstance({driver:[E.INDEXEDDB,E.WEBSQL,E.LOCALSTORAGE],name:ge.DATABASE_NAME,storeName:ge.EXPERIENCES.STORE_NAME}),et.aiExperiencesStore=E.createInstance({driver:[E.INDEXEDDB,E.WEBSQL,E.LOCALSTORAGE],name:ge.DATABASE_NAME,storeName:ge.AI_EXPERIENCES.STORE_NAME}),et.metaStore=E.createInstance({driver:[E.INDEXEDDB,E.WEBSQL,E.LOCALSTORAGE],name:ge.DATABASE_NAME,storeName:ge.META.STORE_NAME}),et.inSessionStore=E.createInstance({driver:[E.INDEXEDDB,E.WEBSQL,E.LOCALSTORAGE],name:ge.DATABASE_NAME,storeName:ge.IN_SESSION.STORE_NAME}),et.splitExperiences=E.createInstance({driver:[E.INDEXEDDB,E.WEBSQL,E.LOCALSTORAGE],name:ge.DATABASE_NAME,storeName:ge.SPLIT_EXPERIENCES.STORE_NAME}),et.tabbedExperiences=E.createInstance({driver:[E.INDEXEDDB,E.WEBSQL,E.LOCALSTORAGE],name:ge.DATABASE_NAME,storeName:ge.TABBED_EXPERIENCES.STORE_NAME}),e=[et.experiencesStore.ready(),et.aiExperiencesStore.ready(),et.metaStore.ready(),et.inSessionStore.ready(),et.splitExperiences.ready(),et.tabbedExperiences.ready()],et.ready=Promise.all(e)),et.ready})}static clear(){return g(this,void 0,void 0,function*(){var e=et.baseLogTag+".clear";try{yield et.initialize(),yield Promise.all([et.experiencesStore.clear(),et.aiExperiencesStore.clear(),et.metaStore.clear(),et.splitExperiences.clear(),et.tabbedExperiences.clear()]);var t=[et.experiencesStore.ready(),et.aiExperiencesStore.ready(),et.metaStore.ready(),et.splitExperiences.ready(),et.tabbedExperiences.ready()];et.ready=Promise.all(t)}catch(t){Je.error(1,e,"Error clearing web personalization stores:",t)}return et.ready})}}et.baseLogTag="MOE_WEBP_STORES";class tt{constructor(e){this.debugLevel=0,this.cluster=null,this.environment=null,this.baseDomainName="https://sdk-01.moengage.com/",this.inapp=null,this.customSoftAsk=null;var t=tt.baseLogTag+".constructor";null!=o(e,"app_id",null)?(this.appId=o(e,"app_id",null),this.integrationType=s.OLD_SDK):null!=o(e,"appId",null)?(this.appId=o(e,"appId",null),this.integrationType=s.NEW_SDK):(Je.error(1,t,"App Id not specified. Please check docs page to complete the integration - ",De.WEBSDK_DOCS),this.integrationType=null),null!=o(e,"debug_logs",null)?this.debugLevel=o(e,"debug_logs",0):null!=o(e,"debugLevel",null)?this.debugLevel=o(e,"debugLevel",0):(Je.log(2,t,"No log level config found. Using default value of",0),this.debugLevel=0),this.appId&&(this.baseDomainName="https://sdk-01.moengage.com/",this.forceSwUpdate=o(e,"forceSwUpdate",!1),this.cluster=ye.dc_3,this.cluster=o(e,"cluster",this.cluster),this.cluster&&null!=Oe[this.cluster.toUpperCase()]&&(this.environment=Oe[this.cluster.toUpperCase()]),o(e,"environment",null)&&(this.environment=e.environment),this.environment&&(this.baseDomainName="https://"+this.environment+"/"),0<this.debugLevel&&this.appId.indexOf("_DEBUG")<0?this.appId=this.appId+"_DEBUG":0===this.debugLevel&&0<=this.appId.indexOf("_DEBUG")&&(this.appId=this.appId.substr(0,this.appId.indexOf("_DEBUG"))),this.swPath=o(e,"swPath",null),null!=e.customSoftAsk?this.customSoftAsk={mainClass:o(e,"customSoftAsk.mainClass",null),allowClass:o(e,"customSoftAsk.allowClass",null),dismissClass:o(e,"customSoftAsk.dismissClass",null)}:this.customSoftAsk={mainClass:o(e,"main_class",null),allowClass:o(e,"allow_class",null),dismissClass:o(e,"block_class",null)},null!=o(e,"inapp.host",null)&&(this.inapp={host:o(e,"inapp.host",null)}),null!=o(e,"swScope",null)&&(this.swScope=o(e,"swScope",null)),null!=o(e,"disable_onsite",null)&&(this.disableOnsite=o(e,"disable_onsite",!1)),null!=o(e,"enableSPA",null)&&(this.enableSPA=o(e,"enableSPA",!1)),null!=o(e,"cards",null)&&(this.cards=o(e,"cards",{})),null!=o(e,"proxyDomains",null)&&(this.proxyDomains=o(e,"proxyDomains",null),this.proxyDomains.api)&&(this.baseDomainName="https://"+this.proxyDomains.api+"/",this.environment=this.proxyDomains.api),null!=o(e,"disable_web_push",null)&&(this.disableWebPush=o(e,"disable_web_push",!1)),null!=o(e,"disableCookies",null)&&(this.disableCookies=o(e,"disableCookies",!1)),null!=o(e,"disableSdk",null))&&(this.disableSdk=o(e,"disableSdk",!1))}static save(e){he.set(pe.INIT_DATA,new tt(e)),gt.set(ve.INIT_DATA,new tt(e))}static get(){return he.get(pe.INIT_DATA)}}function h(e,t){return!(e!==Ie.EMAIL&&e!==Ie.MOBILE&&!t.includes(e))}tt.baseLogTag="InitData",(r=s=s||{}).OLD_SDK="OLD_SDK",r.NEW_SDK="NEW_SDK";class it{constructor(){this.items=[]}static enqueue(e,t){e=it.getLocalStorageQName(e);let i=new it;(i=gt.get(e)?gt.get(e):i).items.push(t),i.items=i.items.slice(Math.max(i.items.length-50,0)),gt.set(e,i)}static dequeue(e){e=it.getLocalStorageQName(e);var t=gt.get(e);let i=null;return t&&0<t.items.length&&(i=t.items[0],t.items.splice(0,1),gt.set(e,t)),i}static isEmpty(e){return e=it.getLocalStorageQName(e),!(gt.get(e)&&0<gt.get(e).items.length)}static purge(e){var t=this.baseLogTag+".purge",i=it.getLocalStorageQName(e);it.isEmpty(e)||gt.remove(i),Je.log(2,t,`Queue "${e}" has been cleared.`)}static getLocalStorageQName(e){return ve.Q.PREFIX+"_"+e}}it.baseLogTag="LocalQ";let{SUBSCRIPTION_DETAILS_KEYS:nt,USER_DATA_KEYS:rt,ATTRIBUTE_KEYS:ot,IDENTITY_MAP_KEYS:at,SESSION_KEYS:st,SOURCE_KEYS:ct,DEVICE_DATA_KEYS:lt}=me;class ut{static getCompressedKeyName(e){return me.COOKIE_NAME_MAPPING[e]||e}static getOriginalName(e){return ut.REVERSE_COOKIE_NAME_MAPPING[e]||e}static compressValue(e,t){return null==e?e:"boolean"!=typeof e||t!==ve.SDK_DISABLED&&t!==fe?"string"==typeof e&&Object.keys(me.PERMISSION_STATE_MAPPING).includes(e)?me.PERMISSION_STATE_MAPPING[e]:"object"!=typeof e||Array.isArray(e)?e:ut.compressObject(e,t):e?1:0}static decompressValue(e,t){return null==e?e:"number"!=typeof e||0!==e&&1!==e||t!==ve.SDK_DISABLED&&t!==fe?"number"==typeof e&&0<=e&&e<=6&&(t===ve.SOFT_ASK_STATUS||t===ve.HARD_ASK_STATUS)?Object.keys(me.PERMISSION_STATE_MAPPING).find(t=>me.PERMISSION_STATE_MAPPING[t]===e):"object"!=typeof e||Array.isArray(e)?e:ut.decompressObject(e,t):1===e}static compressObject(e,t){if(!e)return e;switch(t){case ve.SUBSCRIPTION_DETAILS:var i=e;if(!i)return i;var{domain:n,token:r,endpoint:o,keys:a,p256dh:s,auth:c}=nt,l={};if(i.domain&&(l[n]=i.domain),i.token&&(l[r]=i.token),i.endpoint){let e=i.endpoint;e.startsWith("https://fcm.googleapis.com/fcm/send/")&&(e="h://fcm.googleapis.com/fcm/send/"),l[o]=e}return i.keys&&(l[a]={},i.keys.p256dh&&(l[a][s]=i.keys.p256dh),i.keys.auth)&&(l[a][c]=i.keys.auth),l;case ve.USER_DATA:return function(e){if(!e)return e;var{attributes:t,subscribedToOldSdk:i,deviceUuid:n,deviceAdded:r}=rt;let{key:o,value:a,updated_at:s}=ot;var c={};return e.attributes&&(c[t]=e.attributes.map(e=>{var t,i,n={};return e.key&&(n[o]=(t=e.key,(i=Ve.find(e=>e.attributeName===t))?i.moeName:t)),void 0!==e.value&&(n[a]=e.value),void 0!==e.updated_at&&(n[s]=e.updated_at),n})),void 0!==e.subscribedToOldSdk&&(c[i]=e.subscribedToOldSdk),e.deviceUuid&&(c[n]=e.deviceUuid),void 0!==e.deviceAdded&&(c[r]=e.deviceAdded),c}(e);case ve.IDENTITY_MAP:return(n=e)&&(({userIdentities:r,previousIdentities:o,previousIdentitiesUpdatedTime:s}=at),a={},n.userIdentities&&(a[r]=n.userIdentities),n.previousIdentities&&(a[o]=n.previousIdentities),void 0!==n.previousIdentitiesUpdatedTime&&(a[s]=n.previousIdentitiesUpdatedTime),a);case ve.SESSION:return function(e){var t,i,n,r,o,a,s,c;return e&&(({sessionKey:t,sessionStartTime:i,sessionMaxTime:n,customIdentifiersToTrack:r,sessionExpiryTime:o,numberOfSessions:a,currentSource:s}=st),c={},e.sessionKey&&(c[t]=e.sessionKey),e.sessionStartTime&&(c[i]=e.sessionStartTime),void 0!==e.sessionMaxTime&&(c[n]=e.sessionMaxTime),e.customIdentifiersToTrack&&(c[r]=e.customIdentifiersToTrack),void 0!==e.sessionExpiryTime&&(c[o]=e.sessionExpiryTime),void 0!==e.numberOfSessions&&(c[a]=e.numberOfSessions),e.currentSource&&(c[s]=(e=>{var t,i,n,r,o,a,s,c,l;return e&&(({source:t,medium:i,source_url:n,term:r,campaign_name:o,campaign_id:a,content:s,extra:c}=ct),l={},e.source&&(l[t]=e.source),e.medium&&(l[i]=e.medium),e.source_url&&(l[n]=e.source_url),e.term&&(l[r]=e.term),e.campaign_name&&(l[o]=e.campaign_name),e.campaign_id&&(l[a]=e.campaign_id),e.content&&(l[s]=e.content),e.extra&&(l[c]=e.extra),l)})(e.currentSource)),c)}(e);case ve.DEVICE_DATA:return(c=e)&&(i=lt.deviceUniqueId,l={},c.deviceUniqueId&&(l[i]=c.deviceUniqueId),l);default:return e}}static decompressObject(e,t){if(!e)return e;switch(t){case ve.SUBSCRIPTION_DETAILS:var i=e;if(!i)return i;var{domain:n,token:r,endpoint:o,keys:a,p256dh:s,auth:c}=nt,l={};if(i[n]&&(l.domain=i[n]),i[r]&&(l.token=i[r]),i[o]){let e=i[o];"h://fcm.googleapis.com/fcm/send/"===e&&(e="https://fcm.googleapis.com/fcm/send/"),l.endpoint=e}return i[a]&&(l.keys={},i[a][s]&&(l.keys.p256dh=i[a][s]),i[a][c])&&(l.keys.auth=i[a][c]),l;case ve.USER_DATA:return function(e){if(!e)return e;var{attributes:t,subscribedToOldSdk:i,deviceUuid:n,deviceAdded:r}=rt;let{key:o,value:a,updated_at:s}=ot;var c={};return e[t]&&(c.attributes=e[t].map(e=>{var t,i,n={};return e[o]&&(n.key=(t=e[o],(i=Ve.find(e=>e.moeName===t))?i.attributeName:t)),void 0!==e[a]&&(n.value=e[a]),void 0!==e[s]&&(n.updated_at=e[s]),n})),void 0!==e[i]&&(c.subscribedToOldSdk=e[i]),e[n]&&(c.deviceUuid=e[n]),void 0!==e[r]&&(c.deviceAdded=e[r]),c}(e);case ve.IDENTITY_MAP:return(n=e)&&(({userIdentities:r,previousIdentities:o,previousIdentitiesUpdatedTime:s}=at),i={},n[r]&&(i.userIdentities=n[r]),n[o]&&(i.previousIdentities=n[o]),void 0!==n[s]&&(i.previousIdentitiesUpdatedTime=n[s]),i);case ve.SESSION:return function(e){var t,i,n,r,o,a,s,c;return e&&(({sessionKey:t,sessionStartTime:i,sessionMaxTime:n,customIdentifiersToTrack:r,sessionExpiryTime:o,numberOfSessions:a,currentSource:s}=st),c={},e[t]&&(c.sessionKey=e[t]),e[i]&&(c.sessionStartTime=e[i]),void 0!==e[n]&&(c.sessionMaxTime=e[n]),e[r]&&(c.customIdentifiersToTrack=e[r]),void 0!==e[o]&&(c.sessionExpiryTime=e[o]),void 0!==e[a]&&(c.numberOfSessions=e[a]),e[s]&&(c.currentSource=(e=>{var t,i,n,r,o,a,s,c,l;return e&&(({source:t,medium:i,source_url:n,term:r,campaign_name:o,campaign_id:a,content:s,extra:c}=ct),l={},e[t]&&(l.source=e[t]),e[i]&&(l.medium=e[i]),e[n]&&(l.source_url=e[n]),e[r]&&(l.term=e[r]),e[o]&&(l.campaign_name=e[o]),e[a]&&(l.campaign_id=e[a]),e[s]&&(l.content=e[s]),e[c]&&(l.extra=e[c]),l)})(e[s])),c)}(e);case ve.DEVICE_DATA:return(a=e)&&(l={},a[c=lt.deviceUniqueId]&&(l.deviceUniqueId=a[c]),l);default:return e}}static isCompressedCookie(e){return e.startsWith("moe_")&&Object.values(me.COOKIE_NAME_MAPPING).includes(e)}static isLegacyValue(e){return"object"==typeof e&&null!==e&&e.hasOwnProperty("MOE_DATA_TYPE")&&e.hasOwnProperty("actualValue")}}ut.REVERSE_COOKIE_NAME_MAPPING=Object.fromEntries(Object.entries(me.COOKIE_NAME_MAPPING).map(([e,t])=>[t,e]));class dt{static set(e,t){var i,n;null!=(n=tt.get())&&n.disableCookies||(n=dt.baseTag+".set",null==t?dt.remove(e):(t=ut.compressValue(t,e),(i=ut.getCompressedKeyName(e))!==e&&dt.remove(e),e===ve.PUSH_TOKEN?Je.log(2,n,"Skipping PUSH_TOKEN as it is redundant with SUBSCRIPTION_DETAILS"):(e=JSON.stringify(t),n=Date.now(),t=";expires="+new Date(n+31536e6*_e.SESSION_COOKIE.EXPIRY_YEARS).toUTCString(),document.cookie=i+"="+encodeURIComponent(e)+t+";domain="+dt.getOrigin()+";path=/;SameSite=None; Secure")))}static get(e){if(null==(t=tt.get())||!t.disableCookies){var t=ut.getCompressedKeyName(e);let i=dt.getCookieValue(t),n=!0;return null===i&&t!==e&&(i=dt.getCookieValue(e),n=!1),null===i?null:i=dt.processParseValue(i,e,n)}}static getCookieValue(e){var t=e+"=",i=dt.getDecodedCookies();for(let e=i.length-1;0<=e;e--){let n=i[e];for(;" "===n.charAt(0);)n=n.substring(1);if(0===n.indexOf(t))return n.substring(t.length,n.length)}return null}static processParseValue(e,t,i){var n="MOE_DATA_TYPE",r="actualValue";try{var a=JSON.parse(e);ut.isLegacyValue(a)?"string"===o(a,n,null)?e=(e=o(a,r,null))?String(e):null:"boolean"===o(a,n,null)&&(e=o(a,r,null)):e=i?ut.decompressValue(a,t):a}catch(e){}return e}static remove(e){var t;null!=(t=tt.get())&&t.disableCookies||(t=ut.getCompressedKeyName(e),document.cookie=t+"=;domain="+dt.getOrigin()+";path=/;expires=Thu, 01 Jan 1970 00:00:01 GMT;",t!==e&&(document.cookie=e+"=;domain="+dt.getOrigin()+";path=/;expires=Thu, 01 Jan 1970 00:00:01 GMT;"))}static setRaw(e,t,i){var n;if(null==(n=tt.get())||!n.disableCookies)if(null==t)dt.remove(e);else{let n="";null!=i&&(n=";expires="+i.toISOString()),document.cookie=e+"="+encodeURIComponent(t)+n+";domain="+dt.getOrigin()+";path=/;"}}static getOrigin(){if(null==(e=tt.get())||!e.disableCookies){var e=dt.baseTag+".getOrigin";let t=window.location.origin;return t=t.indexOf(".")!==t.lastIndexOf(".")?t.substring(t.indexOf(".")):"."+t.substring(t.lastIndexOf("/")+1),"localhost"===window.location.hostname&&(Je.warn(1,e,"Cross domain user persitence will not work with localhost. \n\nWe will save the key-value pairs in the localhost cookie store for reference. You'll be able to test this functionality in a hosted staging/test environment."),t=""),t}}static getDecodedCookies(){let e=dt.baseTag+".getDecodedCookies";return document.cookie.split(";").map(t=>{let i=t.trim();"%"===i.slice(-1)&&(i+="25");try{return decodeURIComponent(i)}catch(t){return Je.error(2,e,"Error decoding cookie:",i,t),i}})}}dt.baseTag="CookieStorage";let Et="MOE_DATA";class gt{static setPrefix(e){gt.prefix=e+"_"}static set(e,t){gt.baseLogTag,e=gt.prefix+e,localStorage&&((n=gt.getMoeData())[e]=t,localStorage.setItem(Et,JSON.stringify(n)));var i,n=gt.KEYS_SHARED_WITH_COOKIE.indexOf(e);gt.isSharedWithCookie&&0<=n&&(i="object"!=typeof t||Array.isArray(t)?t:Object.assign({},t),0===n&&Array.isArray(i.attributes)&&(i.attributes=i.attributes.filter(e=>!!this.isPushBillingOrIdentityAttribute(e.key))),e===ve.SUBSCRIPTION_DETAILS&&(i.domain=t.domain,i.token=t.token,i.endpoint=t.endpoint,i.keys=t.keys),dt.set(e,i))}static get(e){return gt.baseLogTag,e=gt.prefix+e,localStorage?o(gt.getMoeData(),e,null):null}static remove(e){var t,i=gt.baseLogTag+".remove",n=gt.prefix+e;localStorage&&null!=gt.get(e)&&(delete(t=gt.getMoeData())[n],localStorage.setItem(Et,JSON.stringify(t)),Je.log(2,i,"Key",e,"removed.")),gt.isSharedWithCookie&&0<=gt.KEYS_SHARED_WITH_COOKIE.indexOf(e)&&dt.remove(e)}static logout(){var e,t,i=["INIT_DATA","Q","WEB_SETTINGS","SUBSCRIPTION_DETAILS","PUSH_TOKEN","GRACEFUL_DATA","DEVICE_DATA","SDK_VERSION","SDK_DISABLED"];for(e in ve)i.indexOf(e)<0&&gt.remove(ve[e]);for(t in ve.Q)it.purge(t)}static getString(e){if(e=gt.prefix+e,localStorage)return"string"==typeof(e=gt.get(e))||e instanceof String?e:JSON.stringify(e)}static removePrefix(){gt.prefix=""}static copyKeysFromCookie(){for(let i=0;i<gt.KEYS_SHARED_WITH_COOKIE.length;i++){var e=gt.KEYS_SHARED_WITH_COOKIE[i],t=dt.get(e);if(null!=t){let i="object"!=typeof t||Array.isArray(t)?t:Object.assign({},t);if(e===ve.USER_DATA&&(t=gt.get(e)&&gt.get(e).attributes,Array.isArray(i.attributes)&&Array.isArray(t)&&0<t.length)){let e=[...t];i.attributes.forEach(t=>{var i=e.findIndex(e=>e.key===t.key);0<=i?e[i]=t:e.push(t)}),e=e.filter(e=>!(this.isPushBillingOrIdentityAttribute(e.key)&&i.attributes.findIndex(t=>t.key===e.key)<0)),i.attributes=e}gt.set(e,i)}}dt.get(ve.PUSH_TOKEN)&&dt.remove(ve.PUSH_TOKEN),gt.removeStaleKeysFromLS(),gt.copyIdentitiesFromCookiesToIDB()}static isPushBillingOrIdentityAttribute(e){var t=gt.get(ve.WEB_SETTINGS),i=(null==(i=null==t?void 0:t.configs)?void 0:i.identityAttributes)||[],n=(null==(n=null==t?void 0:t.configs)?void 0:n.subscriberBasedBillingAttributes)||[];return!!(null!=t&&t.isPushSubBilling&&h(e,n)||be.includes(e)||i.includes((null==(t=Ve.find(t=>t.attributeName===e))?void 0:t.moeName)||e))}static copyIdentitiesFromCookiesToIDB(){var e,t,i=this.baseLogTag+".copyIdentitiesFromCookiesToIDB",n=dt.get(ve.IDENTITY_MAP),r=dt.get(ve.USER_DATA),o={};null!=n&&n.userIdentities&&(({userIdentities:n,previousIdentities:e,previousIdentitiesUpdatedTime:t}=n),o.userIdentities=n,o.previousIdentities=e,o.previousIdentitiesUpdatedTime=t),null!=(n=null==r?void 0:r.attributes)&&n.length&&r.attributes.find(e=>e.key===Ie.ID)&&(o.moe_user_id=r.attributes.find(e=>e.key===Ie.ID).value),null!=(e=this.moeDataStore)&&e.getItem||(this.moeDataStore=E.createInstance({driver:[E.INDEXEDDB],name:"moe_database",storeName:"moe_data"}),this.moeDataStore&&(this.moeDataStore.setItem(qe,o),Je.log(2,i,"Copied identities from cookie to IndexedDB")))}static removeStaleKeysFromLS(){var e=gt.baseLogTag+".removeStaleKeysFromLS";try{Object.keys(gt.getMoeData()).forEach(e=>{var t=dt.get(e);!this.KEYS_SHARED_WITH_COOKIE.includes(e)||ze.includes(e)||t||!1===t||gt.remove(e)})}catch(t){Je.error(1,e,t)}}static getMoeData(){var e=gt.baseLogTag+".getMoeData",t=localStorage.getItem(Et);if(null==t)return{};try{return JSON.parse(t)}catch(t){return Je.error(1,e,t),{}}}}gt.baseLogTag="PersistentStorage",gt.prefix="",gt.isSharedWithCookie=!1,gt.KEYS_SHARED_WITH_COOKIE=[ve.USER_DATA,ve.SUBSCRIPTION_DETAILS,ve.SOFT_ASK_STATUS,ve.OPT_IN_SHOWN_TIME,ve.HARD_ASK_STATUS,ve.SESSION,ve.DEVICE_DATA,ve.IDENTITY_MAP,ve.SDK_DISABLED];class ht{constructor(e,t){this.key=e,this.value=t,this.updated_at=(new Date).getTime()}static equal(e,t){return e.key===t.key&&JSON.stringify(e.value)===JSON.stringify(t.value)}}class pt{constructor(e,t,i=!0){this.name=e,this.attributes=t,i&&this.attributes.push(new ht(te.URL,location.href))}}class vt{constructor(e){var t;this.experiences=null==(t=null==e?void 0:e.experiences)?void 0:t.map(e=>new _t(e)),this.user_in_gcg=e&&e.user_in_gcg,this.personalization_used=null==e?void 0:e.personalization_used,this.split_experiences=(null==e?void 0:e.split_experiences)||[]}}vt.baseLogTag="CampaignDataModel";class _t{constructor(e){this.delivery=o(e,"delivery",{}),this.url=o(e,"url",""),this.id=o(e,"id",""),this.gcg_enabled=o(e,"gcg_enabled"),this.expiry_time=o(e,"expiry_time"),this.updated_time=o(e,"updated_time"),this.context=o(e,"context",{}),this.payload=o(e,"payload",[]),this.name=o(e,"name",""),this.status=o(e,"status",""),this.in_session_behaviour_segment=o(e,"in_session_behaviour_segment"),this.url_filters=o(e,"url_filters"),this.is_ai=o(e,"is_ai"),this.page_attributes=o(e,"page_attributes"),this.tab_list=o(e,"tab_list")}}(r=c=c||{}).AND="and",r.OR="or",(r=l=l||{}).BOOL="bool",r.STRING="string",r.DATE="datetime",r.NUMBER="double",r.LONG="long",r.ARRAY_BOOL="array_bool",r.ARRAY_NUMBER="array_double",r.ARRAY_STRING="array_string",r.ARRAY_DATETIME="array_datetime",(r=u=u||{}).EQ="is",r.LT="lessThan",r.GT="greaterThan",r.BETWEEN="between",r.IN="in",r.EXISTS="exists",r.CONTAINS="contains",r.STARTSWITH="startsWith",r.ENDSWITH="endsWith",r.INTHELAST="inTheLast",r.INTHENEXT="inTheNext",r.AFTER="after",r.BEFORE="before",r.ON="on",r.TODAY="today",(r=d=d||{}).ALLOF="all_of",r.ANYOFF="any_of";class ft{}ft.REMOVE_TRAIL_CHARS=/[^\w\s]+$/gi;class mt{constructor(e,t,i,n){this.dataType=e,this.availableOperations=t,this.event=i,this.filter=n}validate(){return!(this.availableOperations.indexOf(this.filter.operator)<0)}checkEq(){let e=!1,t=(t,i)=>{this.dataType===l.STRING&&typeof t===l.STRING&&(t=this.removeSpecialChars(t),i=this.removeSpecialChars(i)),(this.dataType!==l.STRING||this.filter.case_sensitive||t.toLowerCase()!==i.toLowerCase())&&t!==i||(e=!0)};var i;return this.event?this.event.attributes.forEach(e=>{e.key===this.filter.name&&t(e.value,this.filter.value)}):(i=this.getPageContextObjectValue(this.filter.name),t(i,this.filter.value)),e}checkExists(){let e=!1;return this.event?this.event.attributes.forEach(t=>{t.key===this.filter.name&&(e=!0)}):this.getPageContextObjectValue(this.filter.name)&&(e=!0),e}removeSpecialChars(e){return e.replace(ft.REMOVE_TRAIL_CHARS,"")}getPageContextObjectValue(e){var t;e=e.split(".");let i=Y();for(t of e)i=i[t];return i}}let St={isBoolean:e=>"boolean"==typeof e,isNumber:e=>"number"==typeof e,isString:e=>"string"==typeof e,isNumeric:e=>"number"==typeof e||"string"==typeof e&&Number(e).toString()===e,isDate:e=>"[object Date]"===Object.prototype.toString.call(e),isArray:e=>Array.isArray(e)},Tt=[u.EQ,u.EXISTS,u.CONTAINS,u.STARTSWITH,u.ENDSWITH,u.IN];class It extends mt{constructor(e,t){super(l.STRING,Tt,e,t),this.event||(this.value=this.getPageContextObjectValue(t.name))}evaluate(){var e;It.baseLogTag;let t=!1;if(this.event&&(e=this.event.attributes.filter(e=>e.key===this.filter.name),this.value=0<e.length?e[0].value:null),null!=this.value&&St.isString(this.value))switch(this.filter.operator){case u.EQ:t=this.checkEq();break;case u.EXISTS:t=this.checkExists();break;case u.CONTAINS:t=this.checkContains();break;case u.STARTSWITH:t=this.checkStartsWith();break;case u.ENDSWITH:t=this.checkEndsWith();break;case u.IN:t=this.checkIn()}return this.filter.negate?!t:t}checkContains(){return this.event,this.filter.case_sensitive?0<=this.value.indexOf(this.filter.value):0<=this.value.toLowerCase().indexOf(this.filter.value.toLowerCase())}checkStartsWith(){var e=(e,t)=>e.substr(0,t.length)===t;return this.filter.case_sensitive?e(this.value,this.filter.value):e(this.value.toLowerCase(),this.filter.value.toLowerCase())}checkEndsWith(){var e,t,i=(e,t,i)=>((void 0===i||i>e.length)&&(i=e.length),e.substring(i-t.length,i)===t);return this.filter.case_sensitive?i(this.value,this.filter.value):(e=this.removeSpecialChars(this.value),t=this.removeSpecialChars(this.filter.value),i(e.toLowerCase(),t.toLowerCase()))}checkIn(){let e=!1;if(Array.isArray(this.filter.value))for(let t=this.filter.value.length-1;0<=t;t--)if(this.filter.case_sensitive){if(this.filter.value[t]===this.value){e=!0;break}}else if(this.filter.value[t].toLowerCase()===this.value.toLowerCase()){e=!0;break}return e}}It.baseLogTag="StringDataType";let bt=[u.EQ,u.EXISTS];class At extends mt{constructor(e,t){super(l.BOOL,bt,e,t)}evaluate(){let e=!1;switch(this.filter.operator){case u.EQ:e=this.checkEq();break;case u.EXISTS:e=this.checkExists()}return this.filter.negate?!e:e}}At.baseLogTag="BooleanDataType";let yt=[u.EXISTS,u.ON,u.BETWEEN,u.BEFORE,u.AFTER,u.INTHELAST,u.INTHENEXT,u.TODAY];class Ot extends mt{constructor(e,t){!St.isDate(t.value)&&St.isString(t.value)&&(t.value=new Date(t.value.split("Z").join(""))),!St.isDate(t.value2)&&St.isString(t.value2)&&null!=t.value2&&(t.value2=new Date(t.value2.split("Z").join(""))),!St.isDate(t.value1)&&St.isString(t.value1)&&null!=t.value1&&(t.value1=new Date(t.value1.split("Z").join(""))),super(l.DATE,yt,e,t)}evaluate(){Ot.baseLogTag;let e=!1;var t=this.event.attributes.filter(e=>e.key===this.filter.name),i=0<t.length?t[0]:null;if(null!=i)switch(i.value.setHours(0,0,0,0),this.filter.operator){case u.EQ:e=this.checkEq();break;case u.EXISTS:e=this.checkExists();break;case u.ON:e=this.checkOn(i);break;case u.BETWEEN:e=this.checkBetween(i);break;case u.BEFORE:e=this.checkBefore(i);break;case u.AFTER:e=this.checkAfter(i);break;case u.INTHELAST:e=this.checkLastX(i);break;case u.INTHENEXT:e=this.checkNextX(i);break;case u.TODAY:e=this.checkToday(i)}return this.filter.negate?!e:e}checkOn(e){return e.value.setHours(0,0,0,0)===this.filter.value.setHours(0,0,0,0)}checkBetween(e){return this.filter.value2?this.filter.value.getTime()<=e.value.getTime()&&e.value.getTime()<this.filter.value2.getTime():this.filter.value.getTime()<=e.value.getTime()&&e.value.getTime()<this.filter.value1.getTime()}checkBefore(e){var{value:t}=this.filter;return typeof t===ne.NUMBER?((new Date).setHours(0,0,0,0)-e.value.setHours(0,0,0,0))/864e5>t:e.value.setHours(0,0,0,0)<t.setHours(0,0,0,0)}checkAfter(e){var{value:t}=this.filter;return typeof t===ne.NUMBER?(e.value.setHours(0,0,0,0)-(new Date).setHours(0,0,0,0))/864e5>t:e.value.setHours(0,0,0,0)>t.setHours(0,0,0,0)}checkLastX(e){var t=(new Date).setHours(0,0,0,0);return 0<t-(e=e.value.setHours(0,0,0,0))&&(t-e)/864e5<=this.filter.value}checkNextX(e){var t=(new Date).setHours(0,0,0,0);return 0<(e=e.value.setHours(0,0,0,0))-t&&(e-t)/864e5<=this.filter.value}checkToday(e){return e.value.setHours(0,0,0,0)===(new Date).setHours(0,0,0,0)}}Ot.baseLogTag="DateTimeDataType";let Dt=[u.EQ,u.EXISTS,u.GT,u.LT,u.BETWEEN,u.IN];class Nt extends mt{constructor(e,t){super(l.NUMBER,Dt,e,t),this.event||(this.value=this.getPageContextObjectValue(t.name))}evaluate(){var e;Nt.baseLogTag;let t=!1;if(this.event&&(e=this.event.attributes.filter(e=>e.key===this.filter.name),this.value=0<e.length?e[0].value:null),null!=this.value&&"number"==typeof this.value)switch(this.filter.operator){case u.EQ:t=this.checkEq();break;case u.EXISTS:t=this.checkExists();break;case u.GT:t=this.checkGreaterThan();break;case u.LT:t=this.checkLessThan();break;case u.BETWEEN:t=this.checkBetween();break;case u.IN:t=this.checkIn()}return this.filter.negate?!t:t}checkGreaterThan(){return this.value>this.filter.value}checkLessThan(){return this.value<this.filter.value}checkBetween(){return this.filter.value2?this.filter.value&&this.filter.value2&&this.filter.value<=this.value&&this.value<this.filter.value2:this.filter.value&&this.filter.value1&&this.filter.value<=this.value&&this.value<this.filter.value1}checkIn(){return Array.isArray(this.filter.value)&&0<=this.filter.value.indexOf(this.value)}}Nt.baseLogTag="NumberDataType";let Rt=[u.EQ,u.EXISTS,u.CONTAINS,u.STARTSWITH,u.ENDSWITH,u.IN,u.LT,u.GT,u.BETWEEN,u.INTHELAST,u.INTHENEXT,u.AFTER,u.BEFORE,u.ON,u.TODAY];class Lt extends mt{constructor(e,t){super(t.data_type,Rt,e,t)}evaluate(){var e=this.event.attributes.filter(e=>e.key===this.filter.name);return!(null==(e=0<e.length?e[0]:null)||!St.isArray(e.value))&&(this.filter.array_filter_type&&this.filter.array_filter_type===d.ANYOFF?this.checkAnyOf(e):this.checkAllOf(e))}checkAllOf(e){return e.value.every(t=>this.getFilterResult(t,e))}checkAnyOf(e){return e.value.some(t=>this.getFilterResult(t,e))}getFilterResult(e,t){return t=this.createCustomEvent(t.key,e),!!(e=this.getDataType(t)).validate()&&e.evaluate()}createCustomEvent(e,t){return e=new ht(e,t),new pt(this.event.name,[e])}getDataType(e){let t;switch(this.filter.data_type){case l.ARRAY_BOOL:t=new At(e,this.filter);break;case l.ARRAY_DATETIME:t=new Ot(e,this.filter);break;case l.ARRAY_NUMBER:t=new Nt(e,this.filter);break;case l.ARRAY_STRING:t=new It(e,this.filter)}return t}}class wt{static doesEventMatchFilters(e,t){wt.baseLogTag;let i=!1,n=null;switch(t.data_type){case l.BOOL:(n=new At(e,t)).validate()&&(i=n.evaluate());break;case l.STRING:(n=new It(e,t)).validate()&&(i=n.evaluate());break;case l.NUMBER:case l.LONG:(n=new Nt(e,t)).validate()&&(i=n.evaluate());break;case l.DATE:(n=new Ot(e,t)).validate()&&(i=n.evaluate());break;case l.ARRAY_STRING:case l.ARRAY_DATETIME:case l.ARRAY_BOOL:case l.ARRAY_NUMBER:(n=new Lt(e,t)).validate()&&(i=n.evaluate())}return i}static doesValueMatchFilter(e,t){return e=new ht(t.name,e),e=new pt("sample event",[e]),wt.doesEventMatchFilters(e,t)}}wt.baseLogTag="TriggerEvaluator";let Ct=e=>o(e,"url_filters.filters",[]);var p=i(414),v=function(e,t,i,n){return new(i=i||Promise)(function(r,o){function a(e){try{c(n.next(e))}catch(e){o(e)}}function s(e){try{c(n.throw(e))}catch(e){o(e)}}function c(e){var t;e.done?r(e.value):((t=e.value)instanceof i?t:new i(function(e){e(t)})).then(a,s)}c((n=n.apply(e,t||[])).next())})};let Pt=e=>v(void 0,void 0,void 0,function*(){var t;Mt(t=e).length&&(t=(e=>{let t=[];return e.forEach(e=>{var i;(null===(i=null==e?void 0:e.in_session_behaviour_segment)||void 0===i?void 0:i.included_filters)&&(t=t.concat(e.in_session_behaviour_segment.included_filters.filters[0].action_name))}),t})(e),et.inSessionStore.setItem(ge.IN_SESSION.IN_SESSION_EVENTS,t))}),Mt=e=>e.filter(e=>!!e.in_session_behaviour_segment),kt=()=>v(void 0,void 0,void 0,function*(){return et&&et.inSessionStore?new Promise((e,t)=>v(void 0,void 0,void 0,function*(){var t=yield et.inSessionStore.getItem(ge.IN_SESSION.IN_SESSION_EVENTS_HISTORY);e(t||[])})):[]});var _=function(e,t,i,n){return new(i=i||Promise)(function(r,o){function a(e){try{c(n.next(e))}catch(e){o(e)}}function s(e){try{c(n.throw(e))}catch(e){o(e)}}function c(e){var t;e.done?r(e.value):((t=e.value)instanceof i?t:new i(function(e){e(t)})).then(a,s)}c((n=n.apply(e,t||[])).next())})};function f(e){return _(this,void 0,void 0,function*(){var t=o(e,"in_session_behaviour_segment.included_filters.filters",[]),i=o(e,"in_session_behaviour_segment.included_filters.filter_operator","and");if(!(yield function(e,t){return _(this,void 0,void 0,function*(){return new Promise((i,n)=>_(this,void 0,void 0,function*(){var{count:n,type:r}=e,o=yield xt(t);let a;switch(r){case"exactly":a=o===n;break;case"atleast":a=n<=o;break;case"atmost":a=o<=n}i(a)}))})}(t[0].execution,t[0].action_name)))return!1;let n=yield m(t[0]);if(1<t.length)for(let e=0;e<t.length;e++)if(i===c.AND){if(0==(n=!(!n||!(yield m(t[e])))))break}else if(i===c.OR&&1==(n=!(!n&&!(yield m(t[e])))))break;return n})}function m(e){return _(this,void 0,void 0,function*(){var t=o(e,"attributes.filters",[]);let i=!0;if(t&&0<t.length){let a=yield Bt(e.action_name);var n=o(e,"attributes.filter_operator","and"),r=t.map(e=>!!a.find(t=>wt.doesEventMatchFilters(t,e)));i=r[0];for(let e=1;e<r.length;e++)if(n===c.AND){if(!1===(i=i&&r[e]))break}else if(n===c.OR&&!0===(i=i||r[e]))break}return i})}let Bt=e=>_(void 0,void 0,void 0,function*(){return(yield kt()).filter(t=>e===t.name)}),xt=e=>_(void 0,void 0,void 0,function*(){var t=yield kt();let i=0;return t.forEach(t=>{t.name===e&&i++}),i});var S=function(e,t,i,n){return new(i=i||Promise)(function(r,o){function a(e){try{c(n.next(e))}catch(e){o(e)}}function s(e){try{c(n.throw(e))}catch(e){o(e)}}function c(e){var t;e.done?r(e.value):((t=e.value)instanceof i?t:new i(function(e){e(t)})).then(a,s)}c((n=n.apply(e,t||[])).next())})};function T(e){return S(this,void 0,void 0,function*(){return yield function(e,t){return S(this,void 0,void 0,function*(){if(!window[le.PAGE_CONTEXT])return!1;let i=!0;if(e&&0<e.length){var n=e.map(e=>wt.doesEventMatchFilters(void 0,e));i=n[0];for(let e=1;e<n.length;e++)if(t===c.AND){if(!1===(i=i&&n[e]))break}else if(t===c.OR&&!0===(i=i||n[e]))break}return i})}(o(e,"page_attributes.filters",[]),o(e,"page_attributes.filter_operator","and"))})}var I=function(e,t,i,n){return new(i=i||Promise)(function(r,o){function a(e){try{c(n.next(e))}catch(e){o(e)}}function s(e){try{c(n.throw(e))}catch(e){o(e)}}function c(e){var t;e.done?r(e.value):((t=e.value)instanceof i?t:new i(function(e){e(t)})).then(a,s)}c((n=n.apply(e,t||[])).next())})};class Ut{static getIdentityMap(){var e=gt.get(ve.WEB_SETTINGS);return null!=e&&e.isDomainLevelStorage?this.getIdentitiesFromCookies():this.getIdentitiesFromLocalStorage()}static getIdentitiesFromLocalStorage(){var e=gt.get(ve.IDENTITY_MAP);return null!=e&&e.userIdentities?e:null}static getIdentitiesFromCookies(){var e,t=dt.get(ve.IDENTITY_MAP);return t&&"object"==typeof t&&t.userIdentities?(e={userIdentities:t.userIdentities},t.previousIdentities&&(e.previousIdentities=t.previousIdentities,e.previousIdentitiesUpdatedTime=t.previousIdentitiesUpdatedTime),e):null}static getUserIdentities(){var e=this.getIdentityMap();return null!=e&&e.userIdentities?e.userIdentities:null}static updateCurrentUserIdentities(e){return I(this,void 0,void 0,function*(){let t;var i=this.getIdentityMap();t=null!=i&&i.userIdentities?Object.assign(Object.assign({},i),{userIdentities:Object.assign(Object.assign({},i.userIdentities),e)}):(this.createIdentityMap(),Object.assign(Object.assign({},this.getIdentityMap()),{userIdentities:e})),gt.set(ve.IDENTITY_MAP,t),yield this.updateIdentifiersIDB(t)})}static broadcastUserIdentityUpdate(){var e=this.baseLogTag+".broadcastUserIdentityUpdate";Je.log(1,e,"User Identities Updated."),hi.broadcastToWindow({topic:Ae.USER_LIFECYCLE.TOPIC_NAME,name:Ae.USER_LIFECYCLE.EVENT_NAMES.USER_IDENTITY_UPDATE})}static broadcastLogout(){hi.broadcastToWindow({topic:Ae.USER_LIFECYCLE.TOPIC_NAME,name:Ae.USER_LIFECYCLE.EVENT_NAMES.LOGOUT})}static updatePreviousUserIdentities(e,t){return I(this,void 0,void 0,function*(){let i;var n,r=this.getIdentityMap();i=null!=r&&r.userIdentities?(n=(null==r?void 0:r.previousIdentities)||{},Object.assign(Object.assign({},r),{previousIdentities:Object.assign(Object.assign({},n),e),previousIdentitiesUpdatedTime:t||(new Date).getTime()})):(this.createIdentityMap(),Object.assign(Object.assign({},this.getIdentityMap()),{previousIdentities:e,previousIdentitiesUpdatedTime:t||(new Date).getTime()})),gt.set(ve.IDENTITY_MAP,i),yield this.updateIdentifiersIDB(i)})}static updateIdentifiersIDB(e){var t;return I(this,void 0,void 0,function*(){var i;null!=(t=this.moeDataStore)&&t.getItem||(this.moeDataStore=E.createInstance({driver:[E.INDEXEDDB],name:we.DATABASE_NAME,storeName:we.STORE_NAME})),this.moeDataStore&&(Object.keys(e).length?(i=(yield this.moeDataStore.getItem(qe))||{},yield this.moeDataStore.setItem(qe,Object.assign(Object.assign({},i),e))):yield this.moeDataStore.setItem(qe,e))})}static copyUidIntoIdentityMap(e){var t=this.baseLogTag+".copyUidIntoIdentityMap";(e=e.getAttribute("id"))&&(this.updateCurrentUserIdentities({uid:e}),Je.log(1,t,"UID copied into IdentityMap."))}static getIdentifiersFromIdentities(){var{userIdentities:e,previousIdentities:t,previousIdentitiesUpdatedTime:i}=this.getIdentityMap()||{},n={};return e&&Object.keys(e).length&&(n.userIdentities=e),0<i&&(216e5<(new Date).getTime()-i?this.removePreviousUserIdentities():n.previousIdentities=t),n}static removePreviousUserIdentities(){return I(this,void 0,void 0,function*(){var e=this.baseLogTag+".removePreviousUserIdentities",t=Object.assign(Object.assign({},this.getIdentityMap()),{previousIdentities:{},previousIdentitiesUpdatedTime:0});gt.set(ve.IDENTITY_MAP,t),yield this.updateIdentifiersIDB(t),Je.log(1,e,"previousIdentities removed from IdentityMap.")})}static createIdentityMap(){gt.set(ve.IDENTITY_MAP,{userIdentities:{},previousIdentities:{},previousIdentitiesUpdatedTime:0})}}function b(){var e=navigator.userAgent;return!(!/(android|bb\d+|meego).+mobile|avantgo|bada\/|blackberry|blazer|compal|elaine|fennec|hiptop|iemobile|ip(hone|od)|ipad|iris|kindle|Android|Silk|lge |maemo|midp|mmp|netfront|opera m(ob|in)i|palm( os)?|phone|p(ixi|re)\/|plucker|pocket|psp|series(4|6)0|symbian|treo|up\.(browser|link)|vodafone|wap|windows (ce|phone)|xda|xiino/i.test(e)&&!/1207|6310|6590|3gso|4thp|50[1-6]i|770s|802s|a wa|abac|ac(er|oo|s\-)|ai(ko|rn)|al(av|ca|co)|amoi|an(ex|ny|yw)|aptu|ar(ch|go)|as(te|us)|attw|au(di|\-m|r |s )|avan|be(ck|ll|nq)|bi(lb|rd)|bl(ac|az)|br(e|v)w|bumb|bw\-(n|u)|c55\/|capi|ccwa|cdm\-|cell|chtm|cldc|cmd\-|co(mp|nd)|craw|da(it|ll|ng)|dbte|dc\-s|devi|dica|dmob|do(c|p)o|ds(12|\-d)|el(49|ai)|em(l2|ul)|er(ic|k0)|esl8|ez([4-7]0|os|wa|ze)|fetc|fly(\-|_)|g1 u|g560|gene|gf\-5|g\-mo|go(\.w|od)|gr(ad|un)|haie|hcit|hd\-(m|p|t)|hei\-|hi(pt|ta)|hp( i|ip)|hs\-c|ht(c(\-| |_|a|g|p|s|t)|tp)|hu(aw|tc)|i\-(20|go|ma)|i230|iac( |\-|\/)|ibro|idea|ig01|ikom|im1k|inno|ipaq|iris|ja(t|v)a|jbro|jemu|jigs|kddi|keji|kgt( |\/)|klon|kpt |kwc\-|kyo(c|k)|le(no|xi)|lg( g|\/(k|l|u)|50|54|\-[a-w])|libw|lynx|m1\-w|m3ga|m50\/|ma(te|ui|xo)|mc(01|21|ca)|m\-cr|me(rc|ri)|mi(o8|oa|ts)|mmef|mo(01|02|bi|de|do|t(\-| |o|v)|zz)|mt(50|p1|v )|mwbp|mywa|n10[0-2]|n20[2-3]|n30(0|2)|n50(0|2|5)|n7(0(0|1)|10)|ne((c|m)\-|on|tf|wf|wg|wt)|nok(6|i)|nzph|o2im|op(ti|wv)|oran|owg1|p800|pan(a|d|t)|pdxg|pg(13|\-([1-8]|c))|phil|pire|pl(ay|uc)|pn\-2|po(ck|rt|se)|prox|psio|pt\-g|qa\-a|qc(07|12|21|32|60|\-[2-7]|i\-)|qtek|r380|r600|raks|rim9|ro(ve|zo)|s55\/|sa(ge|ma|mm|ms|ny|va)|sc(01|h\-|oo|p\-)|sdk\/|se(c(\-|0|1)|47|mc|nd|ri)|sgh\-|shar|sie(\-|m)|sk\-0|sl(45|id)|sm(al|ar|b3|it|t5)|so(ft|ny)|sp(01|h\-|v\-|v )|sy(01|mb)|t2(18|50)|t6(00|10|18)|ta(gt|lk)|tcl\-|tdg\-|tel(i|m)|tim\-|t\-mo|to(pl|sh)|ts(70|m\-|m3|m5)|tx\-9|up(\.b|g1|si)|utst|v400|v750|veri|vi(rg|te)|vk(40|5[0-3]|\-v)|vm40|voda|vulc|vx(52|53|60|61|70|80|81|83|85|98)|w3c(\-| )|webc|whit|wi(g |nc|nw)|wmlb|wonu|x700|yas\-|your|zeto|zte\-/i.test(e.substr(0,4)))}function A(){var e=navigator.userAgent.toLowerCase(),t=/(ipad|tablet|(android(?!.*mobile))|(windows(?!.*phone)(.*touch))|kindle|playbook|silk|(puffin(?!.*(IP|AP|WP))))/.test(e);return/nexus player|neo-x5|adt-2|tsbnettv|roku|tizen|smart-tv.+(samsung)|hbbtv.+maple;(\d+)|(nux; netcast.+smarttv|lg (netcast\.tv-201\d|android tv))|(apple) ?tv|crkey|droid.+aft(\w)( bui|\))|\(dtv[\);].+(aquos)|(aquos-tv[\w ]+)\)|(bravia[\w ]+)( bui|\))|(mitv-\w{5}) bui|Hbbtv.*(technisat) (.*);|\b(roku)[\dx]*[\)\/]((?:dvp-)?[\d\.]*)|hbbtv\/\d+\.\d+\.\d+ +\([\w\+ ]*; *([\w\d][^;]*);([^;]*)|\b(android tv|smart[- ]?tv|opera tv|tv; rv:)\b/i.test(e)?je.TV:t?je.TABLET:b()?je.MOBILE:je.WEB}function y(e,t){var i=t&&new RegExp("^("+t.join("|")+")$");return A()===je.TV&&(null!=i&&i.test(e)||!t)?{moe_os_type:(()=>{var e=navigator.userAgent.toLowerCase();return/tizen/i.test(e)?He.TIZEN:/web0s/i.test(e)?He.WEB_OS:/xbox/i.test(e)?He.XBOX:/vizio/i.test(e)?He.VIZIO:He.DEFAULT})(),os:je.TV.toUpperCase()}:{}}function O(e,t){if(null==e||null==t)return e===t;if(e instanceof Function)return e===t;if(e instanceof RegExp)return e===t;if(e===t||e.valueOf()===t.valueOf())return!0;if(Array.isArray(e)&&e.length!==t.length)return!1;if(e instanceof Date)return!1;if(!(e instanceof Object))return!1;if(!(t instanceof Object))return!1;let i=Object.keys(e);return Object.keys(t).every(e=>-1!==i.indexOf(e))&&i.every(i=>O(e[i],t[i]))}Ut.baseLogTag="IdentityMethods";class Wt{constructor(e,t,i){this.os="web",this.osPlatform=e.userAgent,this.isMobile=b(),this.os=b()?"mweb":"web",this.name=Wt.getBrowserName(e.userAgent,t),this.isIncognito=i}static getInstance(){return function(e,t,i,n){return new(i=i||Promise)(function(t,r){function o(e){try{s(n.next(e))}catch(e){r(e)}}function a(e){try{s(n.throw(e))}catch(e){r(e)}}function s(e){var n;e.done?t(e.value):((n=e.value)instanceof i?n:new i(function(e){e(n)})).then(o,a)}s((n=n.apply(e,[])).next())})}(this,0,void 0,function*(){var e,t;return null==he.get(pe.BROWSER_DETAILS)?(e=yield Wt.isIncognito(window),e=new Wt(navigator,document,e),he.set(pe.BROWSER_DETAILS,e),(t=gt.get(ve.BROWSER_DETAILS))&&Wt.isBrowserUpdated(t,e)||gt.set(pe.BROWSER_DETAILS,e),e):he.get(pe.BROWSER_DETAILS)})}static isIncognito(e){let t=e.RequestFileSystem||e.webkitRequestFileSystem;return new Promise(i=>{t?t(e.TEMPORARY,100,()=>{i(!1)},()=>{i(!0)}):i(!1)})}static getBrowserName(e,t){return-1!==e.indexOf("MSIE")||1==t.documentMode?Wt.BROWSER_NAMES.INTERNET_EXPLORER:-1<e.indexOf("Edg")?Wt.BROWSER_NAMES.EDGE:-1<e.indexOf("OPR")||-1<e.indexOf("Opera")?Wt.BROWSER_NAMES.OPERA:-1<e.indexOf("Chrome")||e.match(/\b(?:crmo|crios)\/([\w\.]+)/i)?-1<e.indexOf("MMS")?Wt.BROWSER_NAMES.OPERA_NEON:Wt.BROWSER_NAMES.CHROME:-1<e.indexOf("Safari")?Wt.BROWSER_NAMES.SAFARI:-1<e.indexOf("Firefox")?Wt.BROWSER_NAMES.FIREFOX:Wt.BROWSER_NAMES.OTHERS}static isBrowserUpdated(e,t){return O(e,t)}isWebPushCompatible(){return this.isChrome()||this.isFirefox()||this.isOpera()||this.isSafari()||this.isEdge()}isChrome(){return this.name===Wt.BROWSER_NAMES.CHROME}isFirefox(){return this.name===Wt.BROWSER_NAMES.FIREFOX}isOpera(){return this.name===Wt.BROWSER_NAMES.OPERA||this.name===Wt.BROWSER_NAMES.OPERA_NEON}isSafari(){return this.name===Wt.BROWSER_NAMES.SAFARI}isEdge(){return this.name===Wt.BROWSER_NAMES.EDGE}static isIOS(){return!(!navigator.userAgent.match(/iPad/i)&&!navigator.userAgent.match(/iPhone/i))}}(r=(r=Wt=Wt||{}).BROWSER_NAMES||(r.BROWSER_NAMES={})).CHROME="Google Chrome",r.FIREFOX="Mozilla Firefox",r.OPERA="Opera",r.OPERA_NEON="Opera Neon",r.SAFARI="Apple Safari",r.INTERNET_EXPLORER="Internet Explorer",r.EDGE="Edge",r.OTHERS="Others";let Ft=Wt,Kt=()=>new Promise((e,t)=>{try{var i=JSON.parse(localStorage.getItem("MOE_DATA"));i&&i.WEB_SETTINGS&&i.WEB_SETTINGS.configs&&e(i.WEB_SETTINGS),t("Error in getting sdk settings from localstorage - no data found")}catch(e){Je.error(1,"getSDKSettings","Error in getting sdk settings from localstorage ",e),t(e)}}),jt=()=>new Promise((e,t)=>{try{var i=JSON.parse(localStorage.getItem("MOE_DATA"));return i&&i.INIT_DATA&&e(i.INIT_DATA),{}}catch(e){Je.error(1,"getSDKSettings","Error in getting init data from localstorage ",e),t(e)}});class Ht{constructor(e,t){this.key=e,this.value=t,this.updated_at=(new Date).getTime()}static equal(e,t){return e.key===t.key&&JSON.stringify(e.value)===JSON.stringify(t.value)}}function D(){var e;return(null==(e=gt.get(ve.SUBSCRIPTION_DETAILS))?void 0:e.token)||null}let Gt=e=>e===Se.UNSUBSCRIBED||e===Se.PERMISSION_BLOCKED,Vt=e=>{let t;try{t=JSON.stringify(e)}catch(e){return!1}return new Blob([t]).size/1024>Ke.MAX_PAYLOAD_SIZE};function N(e){return`Event "${e}" can't get tracked as its size is more than ${Ke.MAX_PAYLOAD_SIZE} KB. Max permissible event size is ${Ke.MAX_PAYLOAD_SIZE} KB.`}class Yt{initiateSessionAndSource(e){return new Promise((t,i)=>{this.isSessionRunning()&&this.isCurrentSourceSameAsPreviousSource()||this.startNewSession(e),t(!0)})}clearSessionAndSource(){gt.remove(Ne.SESSION)}isSessionRunning(){return this.getSessionKey()&&!this.isSessionExpired()}isSessionExpired(){var e=this.getSessionExpiryTime(),t=he.get("wasBrowserInactive");return!(!t&&null!==t)&&(this.isWindowActive()&&he.set("wasBrowserInactive",!1),(new Date).getTime()>e)}isNonEventInteractive(e){return Yt.NON_INTERACTIVE_EVENTS.includes(e.name)||0<e.attributes.filter(e=>"moe_non_interactive"===e.key&&1===e.value).length}getCurrentSource(){let e=$e(window.location.href),t="",i={};var n;if(Object.keys(e).includes("utm_source"))return t="utm_",this.geCustomIdentifiersToTrack().forEach(t=>{e[t]&&(i[t]=e[t])}),n={source_url:window.location.href},e[t+"source"]&&(n.source=e[t+"source"]),e[t+"medium"]&&(n.medium=e[t+"medium"]),e[t+"term"]&&(n.term=e[t+"term"]),e[t+"campaign"]&&(n.campaign_name=e[t+"campaign"]),e[t+"content"]&&(n.content=e[t+"content"]),e.utm_id&&(n.campaign_id=e.utm_id),Object.keys(i).length&&(n.extra=i),n}getActiveSource(){return this.getSavedSource()||this.getCurrentSource()}isSourceOrganic(){let e=$e(window.location.href);var t=Object.keys(e);let i=!1;return this.geCustomIdentifiersToTrack().forEach(t=>{e[t]&&(i=!0)}),!t.includes("utm_source")&&!t.includes("source")&&!i}setCurrentSource(e){var t=this.getSession()||{};t.currentSource=e,gt.set(Ne.SESSION,t)}removeCurrentSource(){var e=this.getSession();e&&(e.currentSource=void 0,gt.set(Ne.SESSION,e))}getSavedSource(){var e=o(this.getSession(),Ne.CURRENT_SOURCE,void 0);if(e)return e}isCurrentSourceSameAsPreviousSource(){var e,t;return!!this.isSourceOrganic()||(delete(e=Object.assign({},this.getCurrentSource())).source_url,delete(t=Object.assign({},this.getSavedSource())).source_url,O(e,t))}getSessionKey(){return o(this.getSession(),Ne.SESSION_KEY,null)}getSessionStartTime(){return o(this.getSession(),Ne.SESSION_START_TIME,null)}getSessionExpiryTime(){return o(this.getSession(),Ne.SESSION_EXPIRY_TIME,null)}getSessionMaxTime(){return o(this.getSession(),Ne.SESSION_MAX_TIME,null)}getSession(){return gt.get(Ne.SESSION)}geCustomIdentifiersToTrack(){return o(this.getSession(),Ne.CUSTOM_IDENTIFIERS_TO_TRACK,[])||[]}generateSessionKey(){return(0,p.v4)()}startNewSession(e){this.removeCurrentSource();var t=this.getNumberOfSessions();e={sessionKey:this.generateSessionKey(),sessionStartTime:(new Date).toISOString(),sessionMaxTime:e.configs.sessionInactiveDuration,customIdentifiersToTrack:e.configs.sourceExtraParams,sessionExpiryTime:(new Date).getTime()+1e3*e.configs.sessionInactiveDuration,numberOfSessions:++t},gt.set(Ne.SESSION,e)}extendSession(){var e=this.getSession();e&&(e.sessionExpiryTime=(new Date).getTime()+1e3*e.sessionMaxTime,gt.set(Ne.SESSION,e))}handleBrowserInactivity(e){"hidden"===e&&he.set("wasBrowserInactive",!0)}isWindowActive(){return!!he.get("isWindowActive")}getNumberOfSessions(){return o(gt.get(Ne.SESSION),Ne.NUMBER_OF_SESSIONS)||0}}Yt.NON_INTERACTIVE_EVENTS=[Se.WEB_OPTIN_BANNER_LOAD,Se.OPT_IN_SHOWN,Se.WEB_OPTIN_BANNER_LOAD,Se.LOGOUT];let qt=i(372),zt=ve.Q;class Xt{static clear(e){var t=Xt.baseLogTag+".clear";if(B()){let i=[];for(;!it.isEmpty(e);)switch(e){case zt.REPORT:let n=it.dequeue(zt.REPORT);i.push(e=>{ui.reportAdd(n).then(()=>{e()})});break;case zt.DEVICE:it.dequeue(zt.DEVICE)&&i.push(e=>{ui.deviceAdd().then(()=>{e()})});break;default:Je.error(1,t,"Do not know how to handle queue with name:",e)}setTimeout(()=>{Xt.processing[e]=!0,qt(i,5,(t,i)=>{Xt.processing[e]=!1})},0)}}static startPeriodicClear(e){let t=Xt.baseLogTag+".startPeriodicCleanQ";Xt.clearInterval(e);var i=()=>{it.isEmpty(e)?(Je.log(1,t,"If you see multiple event tracks with same, they were captured over multiple visits or page refreshes."),o(Xt.processing,e,!1)||Xt.clearInterval(e)):(Xt.clear(e),Je.log(1,t,"Starting periodic queue clear for",e))};i(),Xt.intervals[e]=setInterval(i,6e3)}static clearInterval(e){null!=Xt.intervals[e]&&(clearInterval(Xt.intervals[e]),Xt.intervals[e]=null)}}function R(e){return`${(e=e?new Date(e):new Date).getDate()}:${e.getMonth()+1}:${e.getFullYear()}:${e.getHours()}:${e.getMinutes()}:`+e.getSeconds()}Xt.baseLogTag="QManager",Xt.intervals={},Xt.processing={};class Qt{constructor(e){this.EVENT_ACTION=e.event.name,this.EVENT_ATTRS=e.event.attributes&&Jt(e.event.attributes),this.EVENT_G_TIME=(new Date).getTime().toString(),this.EVENT_L_TIME=R(e.event.timestamp),this.EVENT_ATTRS_CUST=e.postData.c,this.N_I_E=e.postData.nie}}Qt.baseLogTag="ReportAddViewEvent";let Jt=e=>{let t={};return e.forEach(e=>{t[e.key]=e.value}),t};class $t{static visibilityChange(){"hidden"!==document.visibilityState||$t.windowClosed||ni.reactToTriggerEvents()}static removeEventListeners(){document.removeEventListener("visibilitychange",$t.visibilityChange,!1)}static addListeners(){document.addEventListener("visibilitychange",$t.visibilityChange,!1)}}$t.windowClosed=!1;let Zt=$t;class ei{static initialize(){return function(e,t,i,n){return new(i=i||Promise)(function(t,r){function o(e){try{s(n.next(e))}catch(e){r(e)}}function a(e){try{s(n.throw(e))}catch(e){r(e)}}function s(e){var n;e.done?t(e.value):((n=e.value)instanceof i?n:new i(function(e){e(n)})).then(o,a)}s((n=n.apply(e,[])).next())})}(this,0,void 0,function*(){var e,t;return null==ei.ready&&(ei.offlineDataStore=E.createInstance({driver:[E.INDEXEDDB],name:Me.DATABASE_NAME,storeName:Me.STORES.OFFLINE_DATA.NAME}),t=E.createInstance({driver:[E.INDEXEDDB],name:Me.DATABASE_NAME,storeName:"moe_data"}),e=E.createInstance({driver:[E.INDEXEDDB],name:Me.DATABASE_NAME,storeName:"moe_backup"}),t=[ei.offlineDataStore.ready(),t.ready(),e.ready()],ei.ready=Promise.all(t)),yield ei.ready})}}class ti{static getRemoteLogsBatchRequestOptions(e){return new Promise(t=>{ui.collectGetParams().then(i=>{i={query_params:Object.assign(Object.assign({},i),{unique_id:i.unique_id,os:"web"===i.os?"Web":"mWeb"}),logs:[...e]},t(i)})})}static sendBatchOfLogs(e){let t=ui.baseLogTag+".sendBatchOfLogs";return new Promise((i,n)=>{ti.getRemoteLogsBatchRequestOptions(e).then(n=>{var r=(r=jt()).baseDomainName+Fe.END_POINT+n.query_params.os.toLowerCase()+"/"+r.appId;Ze.post(r,{postData:n}).then(()=>{Je.log(1,t,"[sendBatchOfLogs] batch payload: "+JSON.stringify(e)),Je.log(1,t,"Batch Remote Logs sent to MoEngage successfully"),ti.batchRemoteLogsApiRetries=1,i(!0)}).catch(i=>{Je.log(1,t,"Batch Remote Logs API failed",i),this.handleRemoteLogsFailure(e)})})})}static handleRemoteLogsFailure(e){var t=ui.baseLogTag+".handleRemoteLogsFailure";Je.log(1,t,"Retry Batch Logs Failed API",ti.batchRemoteLogsApiRetries),ti.batchRemoteLogsApiRetries<3&&setTimeout(()=>{ti.batchRemoteLogsApiRetries++,ti.sendBatchOfLogs(e)},3e3*ti.batchRemoteLogsApiRetries)}static sendBeacon(e){ti.getRemoteLogsBatchRequestOptions(e).then(e=>{var t=(t=jt()).baseDomainName+Fe.END_POINT+e.query_params.os.toLowerCase()+"/"+t.appId+"?"+(new Date).getTime();Je.log(1,"RemoteLogsApi.sendBeacon","[sendBeacon] Remote Logs batch payload: "+JSON.stringify(e)),navigator.sendBeacon(t,JSON.stringify(e))})}}ti.batchRemoteLogsApiRetries=1;var L,w=function(e,t,i,n){return new(i=i||Promise)(function(r,o){function a(e){try{c(n.next(e))}catch(e){o(e)}}function s(e){try{c(n.throw(e))}catch(e){o(e)}}function c(e){var t;e.done?r(e.value):((t=e.value)instanceof i?t:new i(function(e){e(t)})).then(a,s)}c((n=n.apply(e,t||[])).next())})};class ii{static updateEventStore(){A()!==je.TV&&E.createInstance({driver:[E.INDEXEDDB,E.WEBSQL,E.LOCALSTORAGE],name:Le.DATABASE_NAME,storeName:Le.STORE_NAME}).setItem(Le.STORE_NAME,ii.reports)}static spliceReports(e=ii.reports.length){return e=ii.reports.splice(0,e),ii.updateEventStore(),e}static spliceRemoteLogs(e=ii.remoteLogs.length){return ii.remoteLogs.splice(0,e)}static suspendBatching(){var e=ii.baseLogTag+".suspendBatching";this.spliceReports(),this.spliceRemoteLogs(),ii.periodicSyncInterval&&ii.clearInterval(),Zt.removeEventListeners(),Je.log(2,e,"Batching has stopped.")}static shouldCreateNewBatch(){return!ii.lastbatchCreatedAt||(new Date).getTime()-ii.lastbatchCreatedAt>=ke.CONFIG.TIME_BETWEEN_BATCHES}static shouldCreateNewBatchForRemoteLogs(){return!ii.lastRemoteLogsbatchCreatedAt||(new Date).getTime()-ii.lastRemoteLogsbatchCreatedAt>=ke.CONFIG.TIME_BETWEEN_BATCHES}static reactToTriggerEvents(){var e=ii.baseLogTag+".reactToTriggerEvents";0<ii.reports.length?(Je.log(1,e,`Trigger Events: Created Batch of ${ii.reports.length} reports`,R()),ii.createBatch()):Je.log(2,e,R()+": No report's to sync for this event."),0<ii.remoteLogs.length?(Je.log(1,e,`Trigger Events: Created Batch of remote logs ${ii.remoteLogs.length} reports`,R()),ii.createRemoteLogsBatch()):Je.log(2,e,R()+": No logs's to sync for remote logs.")}static periodicSync(e){var t=ii.baseLogTag+".periodicSync";0<ii.reports.length&&ii.shouldCreateNewBatch()?(Je.log(1,t,`Periodic sync: Created Batch of ${ii.reports.length} reports`,R()),ii.createBatch()):Je.log(2,t,R()+`: No report's to sync at this interval. The next sync will attempt in ${e} seconds`),0<ii.remoteLogs.length&&ii.shouldCreateNewBatchForRemoteLogs()?(Je.log(1,t,`Periodic sync: Created Batch of remote logs ${ii.reports.length} reports`,R()),ii.createRemoteLogsBatch()):Je.log(2,t,R()+`: No report's to sync at this interval for remote logs. The next sync will attempt in ${e} seconds`)}static clearInterval(){clearInterval(ii.periodicSyncInterval),ii.lastbatchCreatedAt=null}static init(e){Ft.getInstance().then(t=>w(this,void 0,void 0,function*(){(ii.isOfflineBatchingSupported(t,e)||e.configs.remoteLogTracking)&&(yield ei.initialize(),ii.periodicSyncInterval&&ii.clearInterval(),ii.periodicSyncInterval=window.setInterval(ii.periodicSync.bind(this,e.configs.periodicFlushTime),1e3*e.configs.periodicFlushTime),Zt.addListeners())}))}static sendBatch(e){let t=ii.baseLogTag+".sendBatch";return new Promise(i=>{try{ui.sendBatchOfReports(e).then(()=>{ii.lastbatchCreatedAt=(new Date).getTime(),i(!0)})}catch(e){Je.error(1,t,"Error in sending batch",e),i(!1)}})}static sendRemoteLogs(e){let t=ii.baseLogTag+".sendRemoteLogs";return new Promise(i=>{try{ti.sendBatchOfLogs(e).then(()=>{ii.lastRemoteLogsbatchCreatedAt=(new Date).getTime(),i(!0)})}catch(e){Je.error(1,t,"Error in sending batch of remote logs",e),i(!1)}})}static createBatch(e){0<ii.reports.length&&(e=ii.spliceReports(e),ii.sendBatch(e))}static createRemoteLogsBatch(e){0<ii.remoteLogs.length&&(e=ii.spliceRemoteLogs(e),ii.sendRemoteLogs(e))}static addReport(e,t){var i=ii.baseLogTag+".addReport";return e=new Qt(e),Vt(e)?(Je.error(1,i,N(e.EVENT_ACTION)),!1):(ii.reports.push(e),Vt(ii.reports)?(ii.reports.pop(),Je.log(1,i,`Created Batch of ${ii.reports.length} reports as payload size would have breached after adding new event to this batch: "${e.EVENT_ACTION}"`,R()),ii.createBatch(),ii.reports.push(e),ii.updateEventStore()):(ii.updateEventStore(),ii.reports.length===t&&(Je.log(1,i,`Created Batch of ${t} reports`,R()),ii.createBatch(t))),!0)}static sendBeacon(){var e=ii.baseLogTag+".sendBeacon";0<ii.reports.length&&(Je.log(1,e,`Window Unload: Created batch of ${ii.reports.length} reports`,R()),ui.sendBeacon(ii.spliceReports())),0<ii.remoteLogs.length&&(Je.log(1,e,`Window Unload: Created Remote Logs batch of ${ii.remoteLogs.length} reports`,R()),ti.sendBeacon(ii.spliceRemoteLogs()),ii.lastRemoteLogsbatchCreatedAt=(new Date).getTime())}static flushReports(e=!1){return w(this,void 0,void 0,function*(){var t=ii.baseLogTag+".flushReports";try{e&&Zt.removeEventListeners(),0<ii.reports.length&&(Je.log(1,t,`Flushed ${ii.reports.length} reports`,R()),yield ii.sendBatch(ii.spliceReports())),0<ii.remoteLogs.length&&(Je.log(1,t,`Flushed ${ii.remoteLogs.length} remote logs`,R()),yield ii.sendRemoteLogs(ii.spliceRemoteLogs()))}catch(e){Je.error(1,t,"Error in flushing reports",e)}})}static isOfflineBatchingSupported(e,t){return t=t||gt.get(ve.WEB_SETTINGS),ii.isBatchingSupported(t,e)}static addRemoteLogs(e,t=15){var i=ii.baseLogTag+".addRemoteLogs";ii.remoteLogs.push(e),ii.remoteLogs.length===t&&(Je.log(1,i,`Created Batch of ${t} reports`,R()),ii.createRemoteLogsBatch(t))}static isBatchingSupported(e,t){try{var i=A();return!(null==e||!e.configs.isBatchingEnabled||("web"!==i||t.name!==Ft.BROWSER_NAMES.CHROME&&t.name!==Ft.BROWSER_NAMES.EDGE&&t.name!==Ft.BROWSER_NAMES.OPERA)&&("mobile"!==i||Ft.isIOS()||t.name!==Ft.BROWSER_NAMES.CHROME&&t.name!==Ft.BROWSER_NAMES.OPERA)||!navigator.sendBeacon)}catch(e){Je.error(1,"BatchManager.isBatchingSupported",e)}}}ii.baseLogTag="BatchManager",ii.reports=[],ii.remoteLogs=[],ii.lastbatchCreatedAt=null,ii.lastRemoteLogsbatchCreatedAt=null;let ni=ii;class ri{constructor(e){var t=ri.baseLogTag+".constructor";let i=Ei.getSync().getAttribute("id");i=i?i.toString():void 0;var n=window.analytics;let r,o;if(n){o=n._VERSIONS;try{r=n.user().anonymousId()}catch(e){Je.error(1,t,"Error getting anonymous id from segment api",e)}}this.c=void 0,this.h="",t=Ut.getIdentityMap(),(i||r||null!=t&&t.userIdentities)&&(this.identifiers={moe_user_id:i,segment_id:r,user_identities:(null==t?void 0:t.userIdentities)||void 0,previous_identities:(null==t?void 0:t.previousIdentities)||void 0}),this.meta={bid:(0,p.v4)(),segmentSdkData:n?o:void 0}}}ri.baseLogTag="ReportPostData";class oi{constructor(e,t,i,n){oi.baseLogTag,this.type=e,this.getParams=t,this.event=i,this.postData=new ri(n);var r,o,a={},s={};for(r of i.attributes)r&&null!=r.key&&(this.status=oi.STATUS.VALID,null!=r.value)&&("function"==typeof r.value.getMonth?((o={})[r.key]=Math.round(r.value.getTime()-6e4*r.value.getTimezoneOffset()),null==s.timestamp&&(s.timestamp=[]),s.timestamp.push(o)):a[r.key]=r.value);this.postData.e=i.name,this.postData.a=a,this.postData.c=(e=s,0===Object.keys(e).length&&e.constructor===Object?void 0:s),window&&window.location&&null!=window.location.href&&(this.postData.url=window.location.href)}}oi.baseLogTag="ReportClass",(L=(r=oi=oi||{}).STATUS||(r.STATUS={}))[L.INVALID=0]="INVALID",L[L.VALID=1]="VALID",(L=r.REPORT_ADD_TYPE||(r.REPORT_ADD_TYPE={}))[L.USER_ATTRIBUTE=0]="USER_ATTRIBUTE",L[L.EVENT=1]="EVENT";let ai=oi;class si{constructor(e,t,i=!0){this.name=e,this.attributes=t,this.timestamp=(new Date).getTime(),i&&this.attributes.push(new Ht(Te.URL,location.href))}static createUserAttributeEvent(e){return new Promise((t,i)=>{var n=[],r=e.key;switch(e.key){case"id":e.key=Ie.ID;break;case"email":e.key=Ie.EMAIL;break;case"name":e.key=Ie.NAME;break;case"first_name":e.key=Ie.FIRST_NAME;break;case"last_name":e.key=Ie.LAST_NAME;break;case"mobile":e.key=Ie.MOBILE;break;case"gender":e.key=Ie.GENDER;break;case"birthday":e.key=Ie.BDAY}n.push(e),e.key!==r&&Je.log(2,"Event.createUserAttributeEvent","Key changed to MoE reserved keyname: ",e.key),t(new si(Se.USER_ATTRIBUTE,n,!1))})}static createEvent(e,t,i){return new Promise((n,r)=>{Ei.get().then(r=>function(e,t,i,n){return new(i=i||Promise)(function(t,r){function o(e){try{s(n.next(e))}catch(e){r(e)}}function a(e){try{s(n.throw(e))}catch(e){r(e)}}function s(e){var n;e.done?t(e.value):((n=e.value)instanceof i?n:new i(function(e){e(n)})).then(o,a)}s((n=n.apply(e,[])).next())})}(this,0,void 0,function*(){try{var o=new Ht(Te.LOGGED_IN_STATUS,!!r.getAttribute("id")),a=new Yt,s=new Ht(Te.FIRST_VISIT,a.getNumberOfSessions()<=Be.FIRST_SEEN_SESSIONS);t.push(o,s),n(new si(e,t,i))}catch(o){Je.error(1,"Event.createEvent","Error occurred in create events ",o)}}))})}}class ci{static addEvent(e){ci.history.push(e),ci.listeners.forEach(t=>{t(e)})}static getHistory(){return ci.history}static addEventListener(e){ci.listeners.push(e)}static clear(){ci.history=[]}static clearAll(){ci.history=[],ci.listeners=[]}}var C;ci.history=[],ci.listeners=[];class li{static track(e,t,i){let n="MoEngage.event.trackEvent";return new Promise((r,o)=>function(e,t,i,n){return new(i=i||Promise)(function(t,r){function o(e){try{s(n.next(e))}catch(e){r(e)}}function a(e){try{s(n.throw(e))}catch(e){r(e)}}function s(e){var n;e.done?t(e.value):((n=e.value)instanceof i?n:new i(function(e){e(n)})).then(o,a)}s((n=n.apply(e,[])).next())})}(this,0,void 0,function*(){var o,a;if(B()){let l;i=!!i;try{l=yield Kt()}catch(i){return Je.warn(1,n,"SDK not yet initialized. Caching event and will track when SDK is initialized.",i),null!=(o=window.moengage_q)&&o.push({f:"track_event",a:[e,t]}),void r(!1)}if("string"==typeof e&&e)if(l.configs.blacklistedEvents&&l.configs.blacklistedEvents.includes(e))Je.error(1,n,`This event "${e}" is blacklisted. Please contact Moengage team to whitelist it.`),r({error:5001,message:`Event "${e}" is blacklisted.`});else if(!Ue.includes(e)||l.configs.whitelistedEvents&&l.configs.whitelistedEvents.includes(e))try{var s=[];if(null==t||null!==t&&t===Object(t)&&"[object Object]"===Object.prototype.toString.call(t)){for(var c in t=null==t?{}:t)t.hasOwnProperty(c)&&s.push(new Ht(c,t[c]));let n=new Yt,o=(yield n.initiateSessionAndSource(l),yield si.createEvent(e,s));ci.addEvent(o),null!=l&&l.configs.isWebPersonalizationModuleEnabled&&null!=(a=window.MoeWebP)&&a.handleInSessionEvent(o),ui.collectGetParams().then(t=>{Gt(e)&&delete t.push_id,t=new ai(ai.REPORT_ADD_TYPE.EVENT,t,o);var a={session_id:n.getSessionKey(),start_time:n.getSessionStartTime(),background_initiated:0},s=[],c=n.getActiveSource();c&&(n.setCurrentSource(c),s.push(c)),t.postData.meta.session=a,s.length&&(t.postData.meta.source=s),n.isNonEventInteractive(o)&&(t.postData.nie=1),ui.reportAdd(t,i).then(()=>{n.isNonEventInteractive(o)||n.extendSession(),r(!0)})})}else Je.error(1,n,"Event attributes were not passed a key-value pair object for event: "+e),r({error:5002,message:"Event value needs to be a key-value pair object"})}catch(e){Je.error(1,n,"Error occurred in tracking events ",e)}else Je.error(1,n,`This event "${e}" has not been whitelisted. Please contact Moengage team to whitelist it.`),r({error:5001,message:`Event "${e}" is not whitelisted.`});else Je.error(1,n,"Event name not a string or null or empty string:",e),r({error:5001,message:"Event name can not be null"})}else Je.warn(2,n,`Not tracking the event "${e}" as Web SDK has been disabled.`),r(!1)}))}}(r=C=C||{}).PROMPT="prompt",r.GRANTED="granted",r.DENIED="denied",r.DISMISSED="dismissed";var P=function(e,t,i,n){return new(i=i||Promise)(function(r,o){function a(e){try{c(n.next(e))}catch(e){o(e)}}function s(e){try{c(n.throw(e))}catch(e){o(e)}}function c(e){var t;e.done?r(e.value):((t=e.value)instanceof i?t:new i(function(e){e(t)})).then(a,s)}c((n=n.apply(e,t||[])).next())})};class ui{static deviceAdd(){var e=ui.baseLogTag+".deviceAdd";return ui.isExecutingDeviceAdd?(Je.warn(2,e,"Device add is already in progress. Skipping this call."),Promise.resolve(!1)):(ui.isExecutingDeviceAdd=!0,new Promise((e,t)=>P(this,void 0,void 0,function*(){if(B()){let i=tt.get();return ui.collectGetParams(Ke.API.DEVICE_ADD).then(n=>{n={queryParams:n=Object.assign(Object.assign({},n),{url:window.location.href})},Ze.post(i.baseDomainName+Ke.API.DEVICE_ADD,n).then(()=>{Ei.get().then(e=>{e.deviceAdded=!0,e.save().then(()=>{Xt.startPeriodicClear(ve.Q.REPORT),ui.onDeviceAdd.res()})}).then(()=>{this.trackDeviceAttributes(),ui.isExecutingDeviceAdd=!1,e(!0)})}).catch(e=>{it.enqueue(ve.Q.DEVICE,!0),ui.isExecutingDeviceAdd=!1,t(!1)})})}e(!1)})))}static trackDeviceAttributes(){let e=ui.baseLogTag+".trackDeviceAttributes";return new Promise((t,i)=>P(this,void 0,void 0,function*(){try{var i="WEB"===(i=A().toUpperCase())?"DESKTOP":i;li.track(Se.DEVICE_ATTRIBUTE,{deviceType:i});let t=!1;Ft.getInstance().then(i=>{Kt().then(n=>P(this,void 0,void 0,function*(){if(o=n,s=i,!tt.get().disableWebPush&&o.isWebPushEnabled&&0<=Ye.indexOf(s.name)&&navigator.serviceWorker&&"PushManager"in window&&"Notification"in window){let i=D();if(!i)try{var r=a()||{};let e="";(e="function"==typeof r.getPermissionState?yield r.getPermissionState():e)===C.GRANTED&&(i=!0)}catch(o){Je.error(2,e,"Failed to get push notification permission state.",o)}t=i}var o,s})).then(()=>{li.track(Se.DEVICE_ATTRIBUTE,{[We.MOE_PUSH_OPTED]:!!t,source:"deviceAdd"}),gt.set(ve.OPTED_STATUS_TRACK_TIME,Date.now())})})}catch(i){Je.error(2,e,"Failed to track device attributes.",i)}t(null)}))}static reportAdd(e,t){let i=ui.baseLogTag+".reportAdd";return new Promise((n,r)=>(t=!!t,Kt().then(o=>{o.isPushSubBilling?Ei.get().then(a=>{a.deviceAdded?ui.reportAddInternal(e,t).then(()=>{this.sendBroadcast(e),n(!0)}).catch(()=>{r(!1)}):(it.enqueue(ve.Q.REPORT,e),Je.log(1,i,"Report added to queue as device not added yet:",e.event.name),Je.log(2,i,"Event Queued:",e.event.name),e.type===ai.REPORT_ADD_TYPE.USER_ATTRIBUTE&&(h(e.event.attributes[0].key,null==(a=null==o?void 0:o.configs)?void 0:a.subscriberBasedBillingAttributes)?(Je.log(1,i,"Attribute accepted for push sub billing."),ui.deviceAdd()):Je.log(2,i,"Attribute NOT accepted for push sub billing.")),n(!0))}):ui.reportAddInternal(e,t).then(()=>{this.sendBroadcast(e),n(!0)}).catch(()=>{r(!1)})}).catch(e=>{Je.error(1,i,"Error in getting Web SDK Settings. This might indicate that the App is blocked."),r(!1)})))}static sendBroadcast(e){xe.NAMES.includes(e.event.name)&&hi.broadcastToWindow({topic:xe.TOPIC,name:e.event.name,data:e.event.attributes})}static getSegmentId(){var e=window.analytics;if(e&&e.user)return e.user().anonymousId()}static getBatchRequestOptions(e){return new Promise(t=>{ui.collectGetParams(ke.API.REPORT_ADD).then(i=>P(this,void 0,void 0,function*(){var n,r=ui.getSegmentId()||"",o=Ei.getSync(),a=tt.get(),s={session_id:(n=new Yt).getSessionKey(),start_time:n.getSessionStartTime(),background_initiated:0},c=[],l=n.getActiveSource(),{userIdentities:n,previousIdentities:l}=(l&&(n.setCurrentSource(l),c.push(l)),yield Ut.getIdentifiersFromIdentities()),u=(l={user_identities:n||void 0,previous_identities:l||void 0},yield this.getParamsFromCookie());let d=null;var E=Object.assign({},i);null!==u&&"object"==typeof u&&(d=u.moe_user_id,null!==u.push_id&&(E.push_id=u.push_id),null!==u.unique_id)&&(E.unique_id=u.unique_id),o={query_params:E,identifiers:Object.assign(Object.assign({moe_user_id:null!==d?d:o.getAttribute("id")||(null==n?void 0:n.uid)||void 0,segment_id:r||void 0},l),{moe_aid:k()}),meta:{bid:(0,p.v4)(),request_time:(new Date).toISOString(),session:s,source:c.length?c:void 0,initiator:null!=(E=null==(u=null==a?void 0:a.proxyDomains)?void 0:u.api)&&E.length?"proxy_server":void 0},viewsCount:e.length,viewsInfo:[...e]},t(o)}))})}static getParamsFromCookie(){let e=this.baseLogTag+".getMoeUserIdFromCookies",t={moe_user_id:null,unique_id:null,push_id:null};return new Promise(i=>{Kt().then(e=>{var n,r;null!=e&&e.isDomainLevelStorage&&(e=dt.get(ve.USER_DATA),r=null==(r=dt.get(ve.SUBSCRIPTION_DETAILS))?void 0:r.token,e&&(null!=(n=e.attributes)&&n.length&&e.attributes.find(e=>e.key===Ie.ID)?t.moe_user_id=e.attributes.find(e=>e.key===Ie.ID).value:t.moe_user_id=void 0,null!=(n=e.deviceUuid))&&n.length&&(t.unique_id=e.deviceUuid),null!=r&&r.length&&x(r)?t.push_id=r:t.push_id=void 0),i(t)}).catch(n=>{Je.error(2,e,"Error occurred while trying to fetch SDK Settings: ",n),i(t)})})}static addReportsToOfflineDB(e,t){return P(this,void 0,void 0,function*(){let i=ui.baseLogTag+".addReportsToOfflineDB";var n=yield ui.getBatchRequestOptions([]);yield ei.offlineDataStore.setItem(t||"report_add_"+(new Date).getTime(),e),yield ei.offlineDataStore.setItem("requestMetaData",n),yield ei.offlineDataStore.setItem(t||"batch_"+(new Date).getTime(),Object.assign(Object.assign({},n),{viewsCount:e.length,viewsInfo:e})),navigator.serviceWorker&&navigator.serviceWorker.ready.then(e=>{e.sync?e.sync.register(Me.OFFLINE_SYNC_EVENT).then(()=>{Je.log(2,i,"offline sync event registered")}).catch(e=>{Je.error(1,i,"Service worker sync error",e)}):Je.log(2,i,"Service worker sync unavailable")})})}static sendReportBeacon(e,t,i){var n=ui.baseLogTag+".sendReportBeacon";try{if(!e&&navigator.sendBeacon&&navigator.sendBeacon(t,new Blob([JSON.stringify(i)],{type:"text/plain;charset=UTF-8"})))return!0}catch(e){Je.error(2,n,"Failed to send Report call with Beacon:",e)}return!1}static sendBatchOfReports(e){let t=ui.baseLogTag+".sendBatchOfReports";return new Promise((i,n)=>{ui.getBatchRequestOptions(e).then(r=>{var o=tt.get();let a=o.baseDomainName+ke.API.REPORT_ADD+o.appId;Kt().then(n=>{if(!window.navigator.onLine)return this.sendToOfflineTracking(e,Ge,n);ui.sendReportBeacon(n.configs.isBeaconDisabled,a,r)?(Je.log(1,t,"[sendBatchOfReports] batch payload: "+JSON.stringify(e)),Je.log(1,t,"Batch sent to MoEngage successfully through beacon"),i(!0)):Ze.post(a,{postData:r}).then(()=>{Je.log(1,t,"[sendBatchOfReports] batch payload: "+JSON.stringify(e)),Je.log(1,t,"Batch sent to MoEngage successfully"),i(!0)}).catch(r=>{Je.error(1,t,"Batch Report add API failed",r),i(this.sendToOfflineTracking(e,r,n))})}).catch(e=>{e!==Ge&&Je.error(1,t,"Error in getting Web SDK Settings. This might indicate that the App is blocked."),n(e)})})})}static sendToOfflineTracking(e,t,i){let n=ui.baseLogTag+".sendToOfflineTracking";return new Promise((r,o)=>{B()?Ft.getInstance().then(a=>{ni.isOfflineBatchingSupported(a,i)?(Je.error(1,n,"Add Report API failed, adding reports to offline db. ",t),ui.addReportsToOfflineDB(e).then(()=>{Je.log(2,n,"Network offline: Batch added to offline db")}),r(!0)):(Je.warn(1,n,"Report not added to offline db. Offline tracking is supported only if batching is enabled. It is supported only on Chrome, Edge and Opera browsers on desktop web and Chrome and Opera browsers on Android web."),o(t))}).catch(()=>{o(t)}):(Je.warn(2,n,"Not adding report(s) to offline db as SDK has been disabled."),o(t))})}static reportAddInternal(e,t){let i=ui.baseLogTag+".reportAddInternal";return new Promise((n,r)=>{Kt().then(r=>{Ft.getInstance().then(o=>{if(t){var a,s=ui.getUpdatedPushDetails();for(a in s)!s.hasOwnProperty(a)||Gt(e.event.name)&&"push_id"===a||(e.getParams[a]=s[a]);var c=y(),l=(c={queryParams:Object.assign(Object.assign({},e.getParams),c)},e.postData.nie?(delete(l=Object.assign({},e)).postData.meta.source,delete l.postData.meta.session,c.postData=l.postData):c.postData=e.postData,tt.get().baseDomainName);l+=Ke.API.DEVICE_ADD,Ze.post(l,c).then(()=>{var t="WEB"===(t=A().toUpperCase())?"DESKTOP":t;li.track(Se.DEVICE_ATTRIBUTE,{deviceType:t}),n(ui.handleReportAddSuccess(e))}).catch(t=>{ni.isBatchingSupported(r,o)?it.enqueue(ve.Q.DEVICE,e):ui.handleReportAddFailure(e,t)})}else ni.isBatchingSupported(r,o)?(ni.addReport(e,r.configs.eventBatchCount)&&(Je.log(1,i,"Event batched successfully:",e.event),this.addEventsToIDB(e.event)),n(!0)):(l=new Qt(e),Vt(l)?(Je.error(1,i,N(l.EVENT_ACTION)),n(!1)):ui.sendBatchOfReports([l]).then(()=>{n(ui.handleReportAddSuccess(e))}).catch(t=>{ui.handleReportAddFailure(e,t)}))})}).catch(e=>{Je.error(1,i,"Error in getting Web SDK Settings. This might indicate that the App is blocked."),r(!1)})})}static handleReportAddSuccess(e){var t=ui.baseLogTag+".handleReportAddSuccess";return e.type===ai.REPORT_ADD_TYPE.EVENT?(Je.log(1,t,"Event tracked successfully:",e.event),this.addEventsToIDB(e.event)):e.type===ai.REPORT_ADD_TYPE.USER_ATTRIBUTE&&Je.log(1,t,"User attribute added successfully:",e.event.attributes),ui.addReportApiRetries=1,!0}static handleReportAddFailure(e,t){var i=ui.baseLogTag+".handleReportAddFailure";Je.error(1,i,"Add Report API failed",t),e.type===ai.REPORT_ADD_TYPE.EVENT?Je.log(1,i,"Queueing unsuccessful event tracking:",e.event):e.type===ai.REPORT_ADD_TYPE.USER_ATTRIBUTE&&Je.log(1,i,"Queueing unsuccessful user attribute add:",e.event.attributes),ui.addReportApiRetries<3&&setTimeout(()=>{ui.addReportApiRetries++,it.enqueue(ve.Q.REPORT,e),Xt.startPeriodicClear(ve.Q.REPORT)},3e3*ui.addReportApiRetries)}static checkIfTokenValid(e){let t=tt.get().baseDomainName+Ke.API.DEVICE_TOKEN_CHECK,i=tt.get();return new Promise(n=>{e?Ei.get().then(r=>{r={queryParams:{app_id:i.appId,unique_id:r.deviceUuid,push_id:e}},Ze.post(t,r).then(e=>{200===e.status?n(!0):n(!1)}).catch(e=>{n(!1)})}):n(!1)})}static collectGetParams(e){return new Promise((t,i)=>{Ei.get().then(i=>P(this,void 0,void 0,function*(){let n=tt.get(),r=(null!=n&&null!=n.appId||(n=new tt(gt.get(ve.INIT_DATA))),yield Kt());var o=new Date;let a=Date.UTC(o.getUTCFullYear(),o.getUTCMonth(),o.getUTCDate(),o.getUTCHours(),o.getUTCMinutes(),o.getUTCSeconds(),o.getUTCMilliseconds());Ft.getInstance().then(o=>{var s,c,l=this.getDeviceUniqueId(),u=y(e,[Ke.API.REPORT_ADD,Ke.API.DEVICE_ADD,ke.API.REPORT_ADD]),d=Object.assign({os:o.os,os_platform:o.osPlatform,is_incognito:o.isIncognito,app_id:n.appId,os_ver:o.name,sdk_ver:"2.58.02",model:o.name,app_ver:"1.0",device_ts:Number(a),device_tz_offset:(-6e4*(new Date).getTimezoneOffset()).toString(),unique_id:i.deviceUuid,device_tz:(new Date).getTimezoneOffset().toString(),device_unique_id:l},u),E=(l=i.getAttribute("cart_token"),x(((u=null==(u=tt.get())?void 0:u.swPath)&&u.includes("tools/moengage")&&l&&null!=r&&r.configs.isMultiIdEnabled&&e!==Ke.API.DEVICE_ADD&&(d.cart_token=l),u=D()))&&(d.push_id=u),o.isWebPushCompatible()&&(l=r.webPushPlatformData,((u=o).isChrome()||u.isOpera()||u.isEdge()||u.isSafari()?"vapid"===(null==(c=null==l?void 0:l.chrome)?void 0:c.subscriptionMode)&&null!=(c=null==l?void 0:l.chrome)&&c.vapidPublicKey:u.isFirefox()&&"vapid"===(null==(c=null==l?void 0:l.firefox)?void 0:c.subscriptionMode)&&null!=(u=null==l?void 0:l.firefox)&&u.vapidPublicKey)?(d.subscription_type="vapid",d.vapid_public=(c=r.webPushPlatformData,(l=o).isChrome()||l.isOpera()||l.isEdge()||l.isSafari()?(null==(s=null==c?void 0:c.chrome)?void 0:s.vapidPublicKey)||"":l.isFirefox()&&(null==(s=null==c?void 0:c.firefox)?void 0:s.vapidPublicKey)||"")):d.subscription_type="normal"),null!=n.environment&&(d.environment=n.environment),gt.get(ve.SUBSCRIPTION_DETAILS));if(null!=E&&null!=E.keys){for(var g in E.keys)d["keys_"+g]=encodeURI(E.keys[g]);null!=E.endpoint&&(d.endpoint=encodeURI(E.endpoint)),d.expirationTime=E.expirationTime}t(d)})}))})}static getDeviceUniqueId(){var e;return(null==(e=gt.get(ve.DEVICE_DATA))?void 0:e.deviceUniqueId)||void 0}static getUpdatedPushDetails(){var e={},t=gt.get(ve.SUBSCRIPTION_DETAILS);if(null!=t){var i=t.token;if(null!=i&&"NA"!==i&&""!==i&&"null"!==i&&(e.push_id=i),t.keys){for(var n in t.keys)e["keys_"+n]=encodeURI(t.keys[n]);null!=t.endpoint&&(e.endpoint=encodeURI(t.endpoint)),e.expirationTime=t.expirationTime}}return e}static sendBeacon(e){if(!window.navigator.onLine)return this.sendToOfflineTracking(e,Ge);ui.getBatchRequestOptions(e).then(e=>{var t=(t=tt.get()).baseDomainName+ke.API.REPORT_ADD+t.appId+"?"+(new Date).getTime();Je.log(1,"MoeApi.sendBeacon","[sendBeacon] batch payload: "+JSON.stringify(e)),navigator.sendBeacon(t,JSON.stringify(e))})}static addEventsToIDB(e){var t;A()!==je.TV&&null!=(t=E.createInstance({driver:[E.INDEXEDDB,E.WEBSQL,E.LOCALSTORAGE],name:Re.DATABASE_NAME,storeName:Re.STORE_NAME}))&&t.setItem(e.name,e)}}ui.baseLogTag="MoeApi",ui.onDeviceAdd=new class{constructor(){this.p=null,this.res=null,this.rej=null;try{this.p=new Promise((e,t)=>{this.res=e,this.rej=t})}catch(e){Je.error(1,"Utils.PromiseObject","Promises not supported")}}},ui.webSdkApiRetries=1,ui.offlineEvents=[],ui.addReportApiRetries=1,ui.isExecutingDeviceAdd=!1;var M=function(e,t,i,n){return new(i=i||Promise)(function(r,o){function a(e){try{c(n.next(e))}catch(e){o(e)}}function s(e){try{c(n.throw(e))}catch(e){o(e)}}function c(e){var t;e.done?r(e.value):((t=e.value)instanceof i?t:new i(function(e){e(t)})).then(a,s)}c((n=n.apply(e,t||[])).next())})};let di=null;class Ei{constructor(e){this.attributes=[],this.subscribedToOldSdk=!1,null==e?(this.deviceUuid=(0,p.v4)(),this.attributes=[],this.deviceAdded=!1):(this.deviceUuid=o(e,"deviceUuid",(0,p.v4)()),this.attributes=o(e,"attributes",[]),this.deviceAdded=o(e,"deviceAdded",!1))}addAttribute(e){let t=Ei.baseLogTag+".addAttribute";return new Promise(i=>M(this,void 0,void 0,function*(){let n=!0,r=(e.key=Ei.getMorphedKey(e.key),-1);for(let t=this.attributes.length-1;0<=t;t--)e.key===this.attributes[t].key&&(r=t);0<=r?(O(this.attributes[r].value,e.value)&&(Je.log(2,t,"Duplicate attribute found: ",e),n=yield this.isAttibuteTrackingRequired(this.attributes[r].updated_at)),n&&(this.attributes[r].value=e.value,this.attributes[r].updated_at=(new Date).getTime())):(Je.log(2,t,"Adding attribute:",e),this.attributes.push(e)),this.save().then(()=>{i(n)})}))}isAttibuteTrackingRequired(e){return M(this,void 0,void 0,function*(){var t,i=yield Kt();return null===i.configs.userAttributeCacheTime||(t=(new Date).getTime()-e,Math.round(t/1e3)>i.configs.userAttributeCacheTime)})}static getLocalUser(){let e=Ei.baseLogTag+".getLocalUser";return new Promise(t=>{var i;gt.get(ve.USER_DATA)?(Je.log(2,e,"Found user in localstorage"),i=gt.get(ve.USER_DATA),t(new Ei(i))):t(null)})}static getCookieUser(){return new Promise(e=>{var t=Ei.baseLogTag+".getLocalUser";dt.get(ve.USER_DATA)?(Je.log(2,t,"Found user in cookie"),t=dt.get(ve.USER_DATA),e(new Ei(t))):e(null)})}static getMigrationUser(){let e=Ei.baseLogTag+".getLocalUser";return new Promise(t=>{var i=localStorage.getItem(ve.OLD_SDK.USER_DATA);if(i)try{var n=JSON.parse(i);if(n.is_new_sdk_migrated)t(null);else{var r,a=new Ei({deviceAdded:o(n,"device_add",!1),deviceUuid:o(n,"uuid",(0,p.v4)())}),s=o(n,"user_attrs",{});for(r in s)s.hasOwnProperty(r)&&a.attributes.push(new Ht(r,s[r]));var c=localStorage.getItem(ve.OLD_SDK.PUSH_TOKEN);null!=c&&"NA"!==c&&"null"!==c&&(a.subscribedToOldSdk=!0),t(a)}}catch(i){Je.error(1,e,"Error getting the migration user. Resolving as a new user."),Je.error(1,e,i),t(null)}else t(null)})}static getSync(){return Ei.instance}static get(){let e=Ei.baseLogTag+".get";return null!=di?di:di=new Promise((t,i)=>{Ft.getInstance().then(e=>Kt()).then(t=>{var i=Ei.getLocalUser(),n=t.isDomainLevelStorage?Ei.getCookieUser():"resolved",r=Ei.getMigrationUser();return Promise.all([i,n,r]).then(i=>{let n=i[0],r=i[1];return(i=i[2])?i.save().then(t=>{var i=localStorage.getItem(ve.OLD_SDK.USER_DATA);if(i)try{var n=JSON.parse(i);n.is_new_sdk_migrated=!0,localStorage.setItem(ve.OLD_SDK.USER_DATA,JSON.stringify(n))}catch(t){Je.error(1,e,"Error parsing migration user JSON",t)}return Je.log(1,e,"User resolved from older SDK: ",t),t}):(()=>{var i;return(r&&"resolved"!==r?(Je.log(1,e,"User resolved from cookie: ",r),r):(Je.log(1,e,"Local user: ",n),i=new Ei(n),t.isPushSubBilling&&(D()||((e,t)=>{let i=[Ie.EMAIL,Ie.MOBILE,...t];return 0<e.filter(e=>i.includes(e.key)).length||k()})(i.attributes,null==t?void 0:t.configs.subscriberBasedBillingAttributes)?(i.deviceAdded=!0,ui.trackDeviceAttributes()):i.deviceAdded=!1),i)).save()})()})}).then(e=>{Ei.isResolved=!0,t(e)}).catch(t=>{Je.error(1,e,"Error in fetching/creating user",t),di=null,i(t)})})}static logout(){return new Promise(e=>{di=null,this.instance=null,window.MoeWebP&&(window.MoeWebP.deviceUuid=null),e(!0)})}save(){Ei.baseLogTag,Ei.isAmpEnabled()&&(this.deviceUuid=dt.get("moe_uuid")),gt.get("WEB_SETTINGS");var e=gt.get(ve.WEB_SETTINGS);return null!=e&&e.configs.isWebPersonalizationModuleEnabled&&null!=(e=window.MoeWebP)&&e.deviceUuid&&this.deviceUuid!==window.MoeWebP.deviceUuid&&(this.deviceUuid=window.MoeWebP.deviceUuid),Ei.instance=this,new Promise(e=>{gt.set(ve.USER_DATA,this),dt.setRaw(Ce.UUID,Ei.instance.deviceUuid),e(this)})}static isAmpEnabled(){var e=dt.get(Ce.UUID);return e&&e.includes("amp")}getAttribute(e){let t=null;return e=Ei.getMorphedKey(e),this.attributes.map(i=>{i.key===e&&(t=i.value)}),t}indexOfAttribute(e){let t=-1;return e=Ei.getMorphedKey(e),this.attributes.map((i,n)=>{i.key===e&&(t=n)}),t}static getMorphedKey(e){switch(e){case"id":e=Ie.ID;break;case"email":e=Ie.EMAIL;break;case"name":e=Ie.NAME;break;case"first_name":e=Ie.FIRST_NAME;break;case"last_name":e=Ie.LAST_NAME;break;case"mobile":e=Ie.MOBILE;break;case"gender":e=Ie.GENDER;break;case"birthday":e=Ie.BDAY}return e}}function k(){var e;return he.get(pe.HAS_USER_LOGGED_OUT)||!(e=$e(window.location.href)).moe_aid||e.moe_aid.includes("{{")?void 0:e.moe_aid}function B(){var e,t=!!tt.get().disableSdk;let i=!1;return!((i=(null!=(e=gt.get(ve.WEB_SETTINGS))&&e.isDomainLevelStorage?dt:gt).get(ve.SDK_DISABLED))||t&&!1!==i)}function x(e){return null!=e&&"NA"!==e&&""!==e&&"null"!==e}Ei.baseLogTag="UserModel",Ei.isResolved=!1,Ei.instance=null;class gi{static getListeners(){return this.listeners}static getTopicListeners(e){return o(gi.topicListeners,e,[])}static addListener(e){gi.listeners.push(e)}static addTopicListener(e,t){gi.topicListeners[e]=gi.getTopicListeners(e),gi.topicListeners[e].push(t)}static broadcast(e){gi.listeners.map(t=>{t(e)}),o(gi.topicListeners,e.topic,[]).map(t=>{t(e)})}static broadcastToWindow(e,t=!1){window&&(t||B())&&window.dispatchEvent(new CustomEvent(e.topic,{detail:{name:e.name,data:e.data||null}}))}static deprecatedSdkCallback(e){window.dispatchEvent(new CustomEvent("MOE_OPT_IN",{detail:e}))}static resetAllListeners(){gi.listeners=[],gi.topicListeners={}}static resetListeners(){gi.listeners=[]}}gi.listeners=[],gi.topicListeners={};let hi=gi;var U=function(e,t,i,n){return new(i=i||Promise)(function(r,o){function a(e){try{c(n.next(e))}catch(e){o(e)}}function s(e){try{c(n.throw(e))}catch(e){o(e)}}function c(e){var t;e.done?r(e.value):((t=e.value)instanceof i?t:new i(function(e){e(t)})).then(a,s)}c((n=n.apply(e,t||[])).next())})};function W(e){var t=document.createElement("div");return t.innerHTML=e,t.firstElementChild}function F(e){return new Date(Date.parse(e))}function K(e,t=15){return e=(new Date).getTime()-new Date(e).getTime(),t<=Math.round(e/6e4)}let pi=()=>window.Moengage,vi=()=>""!==window.location.search?Di(window.location.search):Di(window.location.hash),_i=()=>{var e=vi();return e[oe.EDITOR_QUERY_PARAM]&&"1"===e[oe.EDITOR_QUERY_PARAM]&&fi()},fi=()=>window.self===window.top,mi=e=>e.sort((e,t)=>e.delivery.priority===t.delivery.priority&&(e=e.updated_time,t=t.updated_time,0<F(e+"Z").getTime()-F(t+"Z").getTime())?-1:1),Si=e=>{let t=[];return e=e.filter(e=>!!(e&&F(e.expiry_time+"Z")>new Date)||(t.push(e.id),!1)),0<t.length&&H("expired_experiences",t),e=e.sort((e,t)=>t.delivery.priority-e.delivery.priority),(e=>{const t={},i={};return{experiences:e=e.filter(e=>{if(e.is_ai&&(i[e.id]=e.context),0===e.payload.length)return!(Number(e.context.moe_variation_id)>1);let n=!1;return e.payload.forEach(i=>{const r=i.widgetId&&"insert_js"===i.type?i.selector+"_"+i.type+"_"+i.widgetId:i.selector+"_"+i.type;i.widgetId&&!i.content||t[r]||(n=!0,t[r]=i,t[r].expId=e.id)}),n}),allOp:t,aiExperienceContext:i}})(mi(e))},Ti=e=>U(void 0,void 0,void 0,function*(){yield Promise.all(e.map(e=>{et.experiencesStore.setItem(e.id,e)}))}),Ii=()=>U(void 0,void 0,void 0,function*(){let e=[];return yield et.experiencesStore.iterate(t=>{e.push(t)}),e}),bi=e=>U(void 0,void 0,void 0,function*(){return yield et.experiencesStore.getItem(e)}),Ai=e=>U(void 0,void 0,void 0,function*(){return yield et.tabbedExperiences.getItem(e)}),yi=()=>U(void 0,void 0,void 0,function*(){var e;return yield null==(e=et.metaStore)?void 0:e.removeItem(ge.META.LAST_FETCHED_TIME)}),Oi=e=>U(void 0,void 0,void 0,function*(){let t,i=q(window.location.href),n=[];var r=e.map(e=>U(void 0,void 0,void 0,function*(){var t=q(new URL(e.url).href);if(null!=e&&e.page_attributes){if(yield T(e))return e}else{if(e.url_filters){if((e=>{var t=Ct(e);let i=!0;if(t&&0<t.length){let o=new pt("MOE_PAGE_VIEWED",[]);var n=e.url_filters.filter_operator,r=t.map(e=>wt.doesEventMatchFilters(o,e));i=r[0];for(let e=0;e<r.length;e++)if(n===c.AND){if(!1===(i=i&&r[e]))break}else if(n===c.OR&&!0===(i=i||r[e]))break}return i})(e))return e}else if(t===i)return e;n.push(e.id)}}));r=(yield Promise.all(r)).filter(e=>null==e?void 0:e.id),0<n.length&&(H("current_url",i),H("url_failed_experiences",n));let o=!1;var a,s=[];for(a of r)(null==(t=null==a?void 0:a.in_session_behaviour_segment)||!t.included_filters||(yield f(a)))&&(s.push(a),o=o||V(a));return o&&window.MoeWebP.clearLastFetchedTime(),s});function j(){var e,t="Web Personalisation.getMetaInfo",i=document.currentScript;let n,r,o,a,s,c,l,u,d="",E="";return i?(d=oe.CLUSTERS.dc_3,i=new URL(i.src),n=(i=new URLSearchParams(i.search)).get("app_id")||"",r=i.get("env")||"",a=i.get("api_proxy")||"",s=i.get("cdn_proxy")||"",c=i.get("app-cdn_proxy")||"",l=i.get("image_proxy")||"",o="true"===i.get("enable_split_url"),u="true"===i.get("disable_webp"),i.get("cluster")&&(e=i.get("cluster"))&&oe.CLUSTER_ENVIRONMENT_MAP[e.toUpperCase()]&&(d=e.toUpperCase()),"1"!==i.get("debug_logs")||n.includes("_DEBUG")||(n+="_DEBUG"),r?E="https://"+r+"/":d&&(E="https://"+oe.CLUSTER_ENVIRONMENT_MAP[d]+"/"),a&&(E="https://"+a+"/"),r||d||Je.error(2,t,"Please check WebP integration: data center not present"),n||Je.error(2,t,"Please check WebP integration: app_id not present"),{APP_ID:n,HOST:E,CLUSTER:d,ENABLE_SPLIT_URL:o,CDN_PROXY_DOMAIN:s,APP_CDN_PROXY_DOMAIN:c,IMAGE_PROXY_DOMAIN:l,DISABLE_WEBP:u}):{}}let Di=e=>{if(e){var t=e.indexOf("?");if(t<0)return{};t=(e=e.slice(t+1)).replace("?","").split("&");let i={};return t.forEach(e=>{var t=(e=e.split("="))[0];e=decodeURIComponent(e[1]||""),i[t]?"[object Array]"===Object.prototype.toString.call(i[t])?i[t].push(e):i[t]=[i[t],e]:i[t]=e}),JSON.parse(JSON.stringify(i))}return{}};function H(e,t){window.MoeWebP.statsData[e]=t}function G(){var e;try{var t=gt.get(ue.USER_DATA);let i;return t&&t.deviceUuid?i=t.deviceUuid:(i=null==(e=window.MoeWebP)?void 0:e.deviceUuid)||(i=(0,p.v4)(),window.MoeWebP=window.MoeWebP||{},window.MoeWebP.deviceUuid=i),i}catch(e){Je.error(2,"Web Personalisationutils.getOrSetDeviceUUID","Error fetching or setting device UUID:",e)}}let Ni=(e,t)=>{let i;return function(...n){clearTimeout(i),i=setTimeout(()=>{e.apply(this,n),i=void 0},t)}};function V(e){return"is_ai"in e&&0<e.payload.length}function Y(){return window[le.PAGE_CONTEXT]}function q(e){return(e=e.split("?")[0]).replace(/^(https?:\/\/)?(www\.)?/,"https://").replace(/\/$/,"")}function z(e){var t=q(window.location.href);e&&e.redirection_url&&q(e.redirection_url)!==t&&location.replace(e.redirection_url)}let Ri=(e,t,i=!1)=>U(void 0,void 0,void 0,function*(){var n=yield bi(e);return!!n&&(n.payload=t,i&&(n.is_ai=!0),window.MoeWebP.handleDomManipulator(n),!0)});function X(e){var t=gt.get(ue.INIT_DATA),i=!(null==t||!t.disableSdk),n=gt.get(ue.SDK_DISABLED);if(!(n||i&&!1!==n||!t&&e))return 1;Je.warn(2,"Web Personalisationutils.isSdkEnabled","Web Personlization is disabled")}function Q(e,t){var i=oe.DATA_MOE_SELECTOR_ID,n=e.getAttribute(i);n?(n=n.split(",").map(e=>e.trim())).includes(t)||(n.push(t),e.setAttribute(i,n.join(","))):e.setAttribute(i,t)}let Li,wi=(e,t)=>{var i,n;null!=e&&e.setAttribute&&(i=t=>{e.setAttribute(ce.DATA_ATTRIBUTE.LABEL_NAME,t)},(n=e.getAttribute(ce.DATA_ATTRIBUTE.LABEL_NAME)||"")&&!n.includes(ce.LABELS[t])?i(n+" & "+ce.LABELS[t]):i(ce.LABELS[t]))},Ci=()=>{Li=(()=>{let e=document.createElement("div");function t(t){t.stopPropagation();var i=this.getAttribute(ce.DATA_ATTRIBUTE.LABEL_NAME);e.textContent=i,i=(i=t.clientX)+15,t=t.clientY-35,e.style.left=i+"px",e.style.top=t+"px",e.classList.add("visible")}function i(){e.classList.remove("visible")}return e.classList.add("tooltip"),window.onload=()=>{document.body.appendChild(e)},{enable:function(e=document){e.querySelectorAll(`[${ce.DATA_ATTRIBUTE.LABEL_NAME}]`).forEach(e=>{e.addEventListener("mousemove",t),e.addEventListener("mouseleave",i)})},disable:function(e=document){e.querySelectorAll(`[${ce.DATA_ATTRIBUTE.LABEL_NAME}]`).forEach(e=>{e.removeEventListener("mousemove",t),e.removeEventListener("mouseleave",i)})}}})()};class Pi{static initiate(e,t,i,n){var r=Pi.baseLogTag+".initiate";if(null!=(o=e.content)&&o.length&&(e.content=(e=>{let t=e;var{CDN_PROXY_DOMAIN:e,APP_CDN_PROXY_DOMAIN:i,IMAGE_PROXY_DOMAIN:n}=j();return"string"==typeof t&&t.length&&(i&&(t=t.replace(/app-cdn\.moengage\.com/gi,i)),e&&(t=t.replace(/cdn\.moengage\.com/gi,e)),n)?t.replace(/image\.moengage\.com/gi,n):t})(e.content)),!e||!e.type)return Je.error(2,r,"Operation type is missing:",e),{success:!1,reason:"invalid type",operation:e};var o=e.type;let a;switch(o){case"insert":a=Pi.handleInsertOp(e,i);break;case"insert_js":a=Pi.handleInsertJSOp(e,i);break;case"replace":a=Pi.handleReplaceOp(e,i);break;case"update":a=Pi.handleUpdateOp(e,i);break;case"update_outerhtml":a=Pi.handleUpdateHTMLOp(e,i);break;case"delete":a=Pi.handleDeleteOp(e,i);break;case"hide":a=Pi.handleHideOp(e,i);break;case"attribute":a=Pi.handleAttributeOp(e,i);break;case"tracking":a=Pi.handleTrackingOp(e,i,t,n);break;case"rearrange":a=Pi.handleReArrangeOp(e,i);break;default:a={success:!1,reason:"invalid type",operation:e}}return a}static handleInsertOp(e,t){var i,n=Pi.baseLogTag+".handleInsertOp";return e.content&&e.placement?(t=t.querySelector(null==e?void 0:e.selector))?(i=W(fi()||null==(i=e.metaData)||!i.html?e.content:null==(i=e.metaData)?void 0:i.html),wi(i,e.content.trim().startsWith("<img")?"insert_image":e.type),e.dataMoeId&&Q(i,e.dataMoeId),"after"===e.placement?t.parentNode.insertBefore(i,t.nextSibling):"before"===e.placement&&t.parentNode.insertBefore(i,t),Je.log(2,n,"Operation applied successfully: ",e),{success:!0}):(Je.error(1,n,"invalid query selector -> ",e),{success:!1,reason:"invalid query selector",operation:e}):(Je.error(1,n,"Unable to find content / placement.",e),{success:!1,reason:"unable to find content / placement.",operation:e})}static handleInsertJSOp(e,t){var i=Pi.baseLogTag+".handleInsertJSOp";if(e.content)try{var n=(e=>{try{return JSON.parse(e)}catch(e){return null}})(null==e?void 0:e.content),r=document.createElement("script");return r.textContent=n,(document.body||document.head).appendChild(r),Je.log(2,i,"Operation applied successfully: ",e),{success:!0}}catch(t){return{success:!1,reason:"Document is not loaded.: "+t,operation:e}}return Je.error(1,i,"Unable to find content / placement.",e),{success:!1,reason:"unable to find content / placement.",operation:e}}static handleReplaceOp(e,t){var i,n=Pi.baseLogTag+".handleReplaceOp";return e.content?(t=t.querySelector(e.selector),i=W(e.content),t&&i?(wi(i,e.type),e.dataMoeId&&Q(i,e.dataMoeId),t.replaceWith(i),Je.log(2,n,"Operation applied successfully: ",e),{success:!0}):(Je.error(1,n,"invalid "+(t?"content ->":"query selector -> "),e),{success:!1,reason:"invalid "+(t?"content":"query selector"),operation:e})):(Je.error(1,n,"Unable to find content.",e),{success:!1,reason:"unable to find  content.",operation:e})}static handleUpdateOp(e,t){var i=Pi.baseLogTag+".handleUpdateOp";return e.content?(t=t.querySelector(e.selector))?(e.dataMoeId&&Q(t,e.dataMoeId),t.innerHTML=e.content,Je.log(2,i,"Operation applied successfully: ",e),wi(t,e.type),{success:!0}):(Je.error(1,i,"invalid query selector ->",e),{success:!1,reason:"unable to find selector / content / placement.",operation:e}):(Je.error(1,i,"Unable to find content.",e),{success:!1,reason:"unable to find content.",operation:e})}static handleUpdateHTMLOp(e,t){var i,n,r,o=Pi.baseLogTag+".handleUpdateHTMLOp";return e.content?(i=t.querySelector(e.selector))?(n=W(e.content),e.tab_info&&(wi(n,e.type),r=e.tab_info,t=t.getElementById(r.tab_id))&&t.classList.remove("moe-hide-tab"),e.dataMoeId&&Q(i,e.dataMoeId),i.outerHTML=n.outerHTML,Je.log(2,o,"Operation applied successfully: ",e),{success:!0}):(Je.error(1,o,"invalid query selector ->",e),{success:!1,reason:"unable to find selector / content / placement.",operation:e}):(Je.error(1,o,"Unable to find content.",e),{success:!1,reason:"unable to find content.",operation:e})}static handleDeleteOp(e,t){var i=Pi.baseLogTag+".handleDeleteOp";return(t=t.querySelector(e.selector))?(t.remove(),Je.log(2,i,"Operation applied successfully: ",e),{success:!0}):(Je.error(1,i,"invalid query selector ->",e),{success:!1,reason:"invalid query selector.",operation:e})}static handleHideOp(e,t){var i=Pi.baseLogTag+".handleHideOp";return(t=t.querySelector(e.selector))&&t.style?(t.style.display="none",wi(t,e.type),Je.log(2,i,"Operation applied successfully: ",e),{success:!0}):(Je.error(1,i,"invalid query selector -> ",e),{success:!1,reason:"invalid query selector",operation:e})}static handleAttributeOp(e,t){var i=Pi.baseLogTag+".handleAttributeOp";if(e.attributes){let n=t.querySelector(e.selector);return n?(Object.keys(e.attributes).forEach(t=>{var i;"style"===t?(i=(i=n.getAttribute(t)||"")+((e,t)=>{let i=0<t.length&&";"!==t.slice(-1)?";":"";return Object.keys(e).forEach(t=>{i=i+t+":"+e[t]+";"}),i})(e.attributes[t],i),n.setAttribute(t,i)):n.setAttribute(t,e.attributes[t])}),e.dataMoeId&&Q(n,e.dataMoeId),wi(n,e.type),Je.log(2,i,"Operation applied successfully: ",e),{success:!0}):(Je.error(1,i,"invalid "+(n?"attributes":"query selector "),e),{success:!1,reason:n?"unable to find attributes.":"invalid query selector",operation:e})}return Je.error(1,i,"Unable to find attributes.",e),{success:!1,reason:"unable to find attributes.",operation:e}}static handleTrackingOp(e,t,i,n){var r=Pi.baseLogTag+".handleTrackingOp";return t=t.querySelector(null==e?void 0:e.selector),e.id&&n?t&&e.id?(((t,n)=>{var r,o=t._moeListeners||[];for(r of o)if(r.fn===n&&r.operation===e&&r.context===i)return;var a=t=>{n(t,e,i)};t.addEventListener("click",a),t._moeListeners=o.concat({fn:n,operation:e,context:i,clickHandler:a})})(t,this.eventTracking),wi(t,e.type),Je.log(2,r,"Operation applied successfully: ",e),{success:!0}):(Je.error(1,r,"invalid "+(t?"ID ":"query selector "),e),{success:!1,reason:t?"unable to track ID.":"invalid query selector",operation:e}):(e.id&&wi(t,null==e?void 0:e.type),Je.error(1,r,"Unable to find ID or it is not a Live Experience.",e),{success:!1,reason:"unable to find ID or it is not a Live Experience.",operation:e})}static eventTracking(e,t,i){var n=e.target.dataset.widgetId;e=e.target.dataset.tabContainerId,i=Object.assign({b_id:t.id},i),t.widgetId&&(i.widget_id=t.widgetId),e?i.moe_widget_id=e:n&&(i.moe_widget_id=n),pi().track_event(oe.EVENTS.CLICK,i)}static handleReArrangeOp(e,t){var i=Pi.baseLogTag+".handleReArrangeOp";let n=e.selector&&t.querySelector(e.selector);return e.orderList&&n?(t=e.orderList.map(e=>(n.children[e].setAttribute("data-moe-rearrange-id",e.toString()),n.children[e])),n.innerHTML="",t.forEach(e=>{n.appendChild(e)}),e.dataMoeId&&Q(n,e.dataMoeId),wi(n,null==e?void 0:e.type),Je.log(2,i,"Operation applied successfully.",e),{success:!0}):(Je.error(2,i,"unable to find selector / new order list.",e),{success:!1,reason:"unable to find selector / new order list.",operation:e})}}Pi.baseLogTag="DomManipulator";var J=function(e,t,i,n){return new(i=i||Promise)(function(r,o){function a(e){try{c(n.next(e))}catch(e){o(e)}}function s(e){try{c(n.throw(e))}catch(e){o(e)}}function c(e){var t;e.done?r(e.value):((t=e.value)instanceof i?t:new i(function(e){e(t)})).then(a,s)}c((n=n.apply(e,t||[])).next())})};class Mi{constructor(){var e=j();this.appId=e.APP_ID,this.host=e.HOST,this.deviceType=function(){var e=navigator.userAgent.toLowerCase();return(e=>!!/(ipad|tablet|(android(?!.*mobile))|(windows(?!.*phone)(.*touch))|kindle|playbook|silk|(puffin(?!.*(IP|AP|WP))))/i.test(e))(e)?"tablet":(()=>{var e=navigator.userAgent;return!(!/(android|bb\d+|meego).+mobile|avantgo|bada\/|blackberry|blazer|compal|elaine|fennec|hiptop|iemobile|ip(hone|od)|ipad|iris|kindle|Android|Silk|lge |maemo|midp|mmp|netfront|opera m(ob|in)i|palm( os)?|phone|p(ixi|re)\/|plucker|pocket|psp|series(4|6)0|symbian|treo|up\.(browser|link)|vodafone|wap|windows (ce|phone)|xda|xiino/i.test(e)&&!/1207|6310|6590|3gso|4thp|50[1-6]i|770s|802s|a wa|abac|ac(er|oo|s\-)|ai(ko|rn)|al(av|ca|co)|amoi|an(ex|ny|yw)|aptu|ar(ch|go)|as(te|us)|attw|au(di|\-m|r |s )|avan|be(ck|ll|nq)|bi(lb|rd)|bl(ac|az)|br(e|v)w|bumb|bw\-(n|u)|c55\/|capi|ccwa|cdm\-|cell|chtm|cldc|cmd\-|co(mp|nd)|craw|da(it|ll|ng)|dbte|dc\-s|devi|dica|dmob|do(c|p)o|ds(12|\-d)|el(49|ai)|em(l2|ul)|er(ic|k0)|esl8|ez([4-7]0|os|wa|ze)|fetc|fly(\-|_)|g1 u|g560|gene|gf\-5|g\-mo|go(\.w|od)|gr(ad|un)|haie|hcit|hd\-(m|p|t)|hei\-|hi(pt|ta)|hp( i|ip)|hs\-c|ht(c(\-| |_|a|g|p|s|t)|tp)|hu(aw|tc)|i\-(20|go|ma)|i230|iac( |\-|\/)|ibro|idea|ig01|ikom|im1k|inno|ipaq|iris|ja(t|v)a|jbro|jemu|jigs|kddi|keji|kgt( |\/)|klon|kpt |kwc\-|kyo(c|k)|le(no|xi)|lg( g|\/(k|l|u)|50|54|\-[a-w])|libw|lynx|m1\-w|m3ga|m50\/|ma(te|ui|xo)|mc(01|21|ca)|m\-cr|me(rc|ri)|mi(o8|oa|ts)|mmef|mo(01|02|bi|de|do|t(\-| |o|v)|zz)|mt(50|p1|v )|mwbp|mywa|n10[0-2]|n20[2-3]|n30(0|2)|n50(0|2|5)|n7(0(0|1)|10)|ne((c|m)\-|on|tf|wf|wg|wt)|nok(6|i)|nzph|o2im|op(ti|wv)|oran|owg1|p800|pan(a|d|t)|pdxg|pg(13|\-([1-8]|c))|phil|pire|pl(ay|uc)|pn\-2|po(ck|rt|se)|prox|psio|pt\-g|qa\-a|qc(07|12|21|32|60|\-[2-7]|i\-)|qtek|r380|r600|raks|rim9|ro(ve|zo)|s55\/|sa(ge|ma|mm|ms|ny|va)|sc(01|h\-|oo|p\-)|sdk\/|se(c(\-|0|1)|47|mc|nd|ri)|sgh\-|shar|sie(\-|m)|sk\-0|sl(45|id)|sm(al|ar|b3|it|t5)|so(ft|ny)|sp(01|h\-|v\-|v )|sy(01|mb)|t2(18|50)|t6(00|10|18)|ta(gt|lk)|tcl\-|tdg\-|tel(i|m)|tim\-|t\-mo|to(pl|sh)|ts(70|m\-|m3|m5)|tx\-9|up(\.b|g1|si)|utst|v400|v750|veri|vi(rg|te)|vk(40|5[0-3]|\-v)|vm40|voda|vulc|vx(52|53|60|61|70|80|81|83|85|98)|w3c(\-| )|webc|whit|wi(g |nc|nw)|wmlb|wonu|x700|yas\-|your|zeto|zte\-/i.test(e.substr(0,4)))})()?"mweb":e.includes("mac")&&1<navigator.maxTouchPoints?"tablet":"web"}()}getLiveExperiences(e=!1){return J(this,void 0,void 0,function*(){var t=Y();let i={};return!e&&t&&(i.page_attributes=t),new Promise((t,n)=>J(this,void 0,void 0,function*(){this.makeAPICall(Ee.LIVE,{all_exp:e},i,!0).then(i=>{var n;t(new vt(i)),i.personalization_used.dpm||e&&(n=new Date,U(void 0,void 0,void 0,function*(){var e;return yield null==(e=et.metaStore)?void 0:e.setItem(ge.META.LAST_FETCHED_TIME,n)}))}).catch(e=>{n(e)})}))})}getTestExperiences(){return J(this,void 0,void 0,function*(){return new Promise((e,t)=>J(this,void 0,void 0,function*(){e(this.makeAPICall(Ee.TEST))}))})}sendStats(e){return J(this,void 0,void 0,function*(){return new Promise((t,i)=>J(this,void 0,void 0,function*(){t(this.makeAPICall(Ee.STATS,void 0,e,!1))}))})}getWebActions(){return J(this,void 0,void 0,function*(){return new Promise((e,t)=>J(this,void 0,void 0,function*(){e(this.makeAPICall(Ee.WEB_ACTION))}))})}getLiveRecommendations(e){return J(this,void 0,void 0,function*(){return e.platform=this.deviceType,new Promise((t,i)=>J(this,void 0,void 0,function*(){t(this.makeAPICall(Ee.LIVE_RECOMMENDATIONS,e))}))})}isSplitUrlExperince(){return J(this,void 0,void 0,function*(){return new Promise((e,t)=>J(this,void 0,void 0,function*(){var t=new Date;e(this.makeAPICall(Ee.SPLIT_URL,{},{user_time:Math.floor(t.getTime()/1e3),user_tz_offset:60*t.getTimezoneOffset()}))}))})}getTabData(e,t){return J(this,void 0,void 0,function*(){return new Promise((i,n)=>J(this,void 0,void 0,function*(){i(this.makeAPICall(Ee.TAB_DATA,{},{experience_id:e,tab_id:t}))}))})}fetchExperiences(e,t){return J(this,void 0,void 0,function*(){return new Promise((i,n)=>J(this,void 0,void 0,function*(){i(this.makeAPICall(Ee.FETCH,{},Object.assign({experience_key:e},t)))}))})}makeAPICall(e,t,i,n){let r=Mi.baseLogTag+".makeAPICall";return new Promise((a,s)=>{var c={day:["Sunday","Monday","Tuesday","Wednesday","Thursday","Friday","Saturday"][(c=new Date).getDay()],hours:String(c.getHours()).padStart(2,"0")},l=function(){var e={};try{var t=gt.get(ue.IDENTITY_MAP),i=G();(()=>{var e=gt.get(ue.USER_DATA);if(e){let t;null!=e&&e.attributes.map(e=>{e.key===ie.ID&&(t=e.value)}),null==t||t.toString()}})(),t&&(t.userIdentities&&(e.user_identifiers=t.userIdentities),t.previousIdentities)&&(e.previous_user_identifiers=t.previousIdentities),i&&(e.unique_id=i)}catch(e){Je.error(2,"Web Personalisationutils.getUserIdentifier","Error fetching user identifier :",e)}return e}();let u;u=""!==window.location.search?Di(window.location.search):Di(window.location.hash);var d=window.location.href.split("?")[0],E=Object.assign(Object.assign(Object.assign({},u),{app_id:this.appId,sdk_ver:"2.58.02",platform:(E=this.deviceType,e===Ee.STATS&&"tablet"===E?"web":E),payload_id:u.payload_id,USER_TYPE:1<(o(gt.get(ue.SESSION),de.NUMBER_OF_SESSIONS)||0)?"Returning":"New",DAY_OF_THE_WEEK:c.day,TIME_OF_THE_DAY:c.hours,current_url:t?d:void 0,unique_id:l.unique_id}),t);c={headers:{},postData:i,queryParams:{}},[Ee.LIVE,Ee.LIVE_RECOMMENDATIONS,Ee.SPLIT_URL,Ee.TAB_DATA,Ee.FETCH].includes(e)?(delete E.unique_id,c.postData=Object.assign(Object.assign(Object.assign({},c.postData),E),{identifiers:l})):c.queryParams=E;try{if(c.postData)c.headers={"MOE-APPKEY":this.appId,"Content-Type":"application/json"},Ze.post(""+this.host+e,c).then(e=>{e=JSON.parse(e.responseText),a(e)}).catch(e=>{Je.error(1,r,"Error in POST request: ",e),s(e)});else{let t=(new Date).getTime();Je.log(1,r,`API requested Start Time: ${e} -> `,t),Ze.get(""+this.host+e,c).then(i=>{i=JSON.parse(i.responseText);var o=(Je.log(1,r,"Get WebP API call success, response: ",i),(new Date).getTime());Je.log(1,r,`API response received Time : ${e} -> `,o),n&&(H("api_start_time",t),H("api_end_time",o)),a(i)}).catch(e=>{Je.error(1,r,"Error in GET request: ",e),s(e)})}}catch(c){Je.error(1,r,"Error getting WebP Test Expressions: ",c),i||(d=(new Date).getTime(),n&&H("api_request_failed_time",d)),s("Error getting WebP Expressions")}})}}Mi.baseLogTag="WebPApi";class ki{static listenToDomChanges(e,t,i,n,r){let o=ki.baseLogTag+".listenToDOMChanges";var a=r?document:document.querySelector(e.selector);let s=document.location.href,c=Ni(ki.retryFailedExperiences.bind(this,r),oe.FUNCTION_DEBOUNCE_TIME),l=Ni(function(e){Je.log(2,o,"Dom Observer is disconnected, Total number of retry: "+ki.observerCounter),d.disconnect()},oe.FUNCTION_DEBOUNCE_TIME),u=Ni(this.reApplyRevertedChanges.bind(this),oe.FUNCTION_DEBOUNCE_TIME),d=new MutationObserver(o=>{let a=!0;var d,E=s!==document.location.href;o.forEach(e=>{var t;"childList"===e.type&&(null==(t=e.removedNodes[0])?void 0:t.nodeValue)===(null==(t=e.addedNodes[0])?void 0:t.nodeValue)&&(a=!1)}),a&&(r?(o=Fi.failedOperations.length,d=Object.keys(Fi.moeOperationsWithDataID).length,0<o?c():(ki.observerCounter>oe.MAX_RETRY_OPERATION_ATTEMPTES&&d<1&&o<1||E)&&l(),0<d&&u()):E||this.selectorObserver(e,t,n,i))});this.observers.push(d),a&&d.observe(a,{childList:!0,subtree:!0,attributes:!1,characterData:!0})}static selectorObserver(e,t,i,n){var r=ki.baseLogTag+".documentObserver",o=null==t?void 0:t.cid.split("_")[0];(Je.log(1,r,"Re-applying the operation: ",e),r=Pi.initiate(e,t,n,i)).success&&(o&&!Fi.appliedExperiences.hasOwnProperty(o)&&(Fi.appliedExperiences[o]=!0),ki.listenToDomChanges(e,t,n,i))}static retryFailedExperiences(e){var t=ki.baseLogTag+".retryFailedExperiences";Je.log(2,t,"Retring Failed Operations, Total number of retry attempts: "+ki.observerCounter),e(),ki.observerCounter++}static reApplyRevertedChanges(){let e=Fi.moeOperationsWithDataID,t=ki.baseLogTag+".documentObserver";Je.log(2,t,"Retring Failed Operations, Total number of retry attempts: "+ki.observerCounter),Object.keys(e).forEach(i=>{var n=e[i];((e,t)=>{var i;for(i of(e=e.querySelectorAll(`[${oe.DATA_MOE_SELECTOR_ID}]`),Array.from(e)))if((i.getAttribute(oe.DATA_MOE_SELECTOR_ID)||"").split(",").map(e=>e.trim()).includes(t))return i;return null})(document,i)||n.forEach(e=>{Pi.initiate(e,void 0,document,!0),Je.log(2,t,"Re-applying the operation: ",e)})}),ki.observerCounter++}static disconnectObservers(){this.observers&&0<this.observers.length&&(this.observers.forEach(e=>{e.disconnect()}),this.observers=[])}}ki.baseLogTag="Webp.Listener",ki.observerCounter=1,ki.observers=[];class Bi{constructor(e){this.events={},this.listener=null,this.historyManager=window[ae.PageEventHistoryManager],this.onEvent=e=>{var t=Bi.baseLogTag+".onEvent";try{this.events[e.name]&&this.events[e.name].forEach(t=>{(t=this.getAttributeValue(e.attributes,t))&&this.trigger(t)})}catch(e){Je.error(2,t,"Error occurred during check event trigger experiences: ",e)}},this.events=e}onTrigger(e){this.listener=e}startWatching(){return function(e,t,i,n){return new(i=i||Promise)(function(t,r){function o(e){try{s(n.next(e))}catch(e){r(e)}}function a(e){try{s(n.throw(e))}catch(e){r(e)}}function s(e){var n;e.done?t(e.value):((n=e.value)instanceof i?n:new i(function(e){e(n)})).then(o,a)}s((n=n.apply(e,[])).next())})}(this,0,void 0,function*(){var e=Bi.baseLogTag+".startWatching";this.historyManager?(Je.log(2,e,"Initialized event Trigger Watcher for AI experiences"),this.historyManager.getHistory().forEach(this.onEvent),this.historyManager.addEventListener(this.onEvent)):Bi.startWatchingRetries<=se.WEB_P_EVENT_WATCHER_MAX_RETRIES&&setTimeout(()=>{Bi.startWatchingRetries++,this.historyManager=window[ae.PageEventHistoryManager],this.startWatching()},2e3*Bi.startWatchingRetries)})}trigger(e){null!=this.listener&&this.listener(e)}getAttributeValue(e,t){let i=null;for(var n of e)if(n.key===t){i=n.value;break}return i}}Bi.baseLogTag="experienceTriggerManager",Bi.startWatchingRetries=1;var $=function(e,t,i,n){return new(i=i||Promise)(function(r,o){function a(e){try{c(n.next(e))}catch(e){o(e)}}function s(e){try{c(n.throw(e))}catch(e){o(e)}}function c(e){var t;e.done?r(e.value):((t=e.value)instanceof i?t:new i(function(e){e(t)})).then(a,s)}c((n=n.apply(e,t||[])).next())})},Z=function(e,t,i,n){return new(i=i||Promise)(function(r,o){function a(e){try{c(n.next(e))}catch(e){o(e)}}function s(e){try{c(n.throw(e))}catch(e){o(e)}}function c(e){var t;e.done?r(e.value):((t=e.value)instanceof i?t:new i(function(e){e(t)})).then(a,s)}c((n=n.apply(e,t||[])).next())})};class xi{constructor(){this.setExperienceTriggerManager=()=>Z(this,void 0,void 0,function*(){var e=xi.LogTag+".setExperienceTriggerManager",t=yield this.getWebActionEvents();t=new Bi(t),Je.log(2,e,"Initializing Trigger Manager"),t.onTrigger(this.renderAiExperiences.bind(this)),t.startWatching()}),this.getWebActionEvents=()=>Z(this,void 0,void 0,function*(){var e,t,i=xi.LogTag+".getWebActionEvents";let n;return K(yield $(void 0,void 0,void 0,function*(){return yield et.aiExperiencesStore.getItem(ge.AI_EXPERIENCES.WEB_ACTIONS_LAST_FETCHED_TIME)}),oe.SYNC_TIME_FOR_WEB_ACTION_EVENTS)?(Je.log(2,i,"synchronizing Web Actions Events data for Real Time Recommendations as time limit exceeded"),n=yield this.WebPApis.getWebActions(),t=n,$(void 0,void 0,void 0,function*(){yield et.aiExperiencesStore.setItem(ge.AI_EXPERIENCES.WEB_ACTION_EVENTS,t)}),e=new Date,$(void 0,void 0,void 0,function*(){return yield et.aiExperiencesStore.setItem(ge.AI_EXPERIENCES.WEB_ACTIONS_LAST_FETCHED_TIME,e)})):(n=yield $(void 0,void 0,void 0,function*(){return yield et.aiExperiencesStore.getItem(ge.AI_EXPERIENCES.WEB_ACTION_EVENTS)}),Je.log(2,i,"Using the cached Web Actions Events data for Real Time Recommendations:",n)),n}),this.WebPApis=new Mi}renderAiExperiences(e){return Z(this,void 0,void 0,function*(){let t=xi.LogTag+".renderAiExperiences",i=(yield $(void 0,void 0,void 0,function*(){return yield et.aiExperiencesStore.getItem(ge.AI_EXPERIENCES.AI_EXPERIENCE_CONTEXT)}))||{};var n={experience_context:i,product_id:null==e?void 0:e.toString()};return this.WebPApis.getLiveRecommendations(n).then(e=>(Je.log(2,t,"AI Live Recommendations experiences payload: "+i),Object.keys(e).forEach(t=>{Ri(t,null==(t=e[t])?void 0:t.data)}),!0)).catch(e=>{Je.error(2,t,"AI Live Recommendations experiences failed:",e)})})}}xi.LogTag="AI Experiences";class Ui{static listenToDomChanges(){if(document.getElementById(oe.ANTI_FLICKER_STYLESHEET)){let e=Ni(function(){10<Ui.observerCounter?t.disconnect():(Ui.observerCounter+=1,Ui.removeOverLay())},200),t=new MutationObserver(t=>{let i=!0;t.forEach(e=>{var t;"childList"===e.type&&(null==(t=e.removedNodes[0])?void 0:t.nodeValue)===(null==(t=e.addedNodes[0])?void 0:t.nodeValue)&&(i=!1)}),i&&e()});document&&t.observe(document,{childList:!0,subtree:!0,attributes:!1,characterData:!0})}else Je.log(2,Ui.baseLogTag,"Anti Flicker Script not available")}static removeOverLay(){var e=Ui.baseLogTag+".removeOverLay",t=document.querySelectorAll("."+oe.ANTI_FLICKER_HIDE);0<t.length&&t.forEach(e=>{e.classList.add(oe.ANTI_FLICKER_SHOW),e.classList.remove(oe.ANTI_FLICKER_HIDE)}),document.documentElement.className.includes(oe.ANTI_FLICKER_CLASSNAME)&&document.documentElement.classList.remove(oe.ANTI_FLICKER_CLASSNAME),Je.log(2,e,"Removed WebP Anti-Flicker Styles From:",t)}}Ui.baseLogTag="Webp.AntiFlickerListener",Ui.observerCounter=1;var ee=function(e,t,i,n){return new(i=i||Promise)(function(r,o){function a(e){try{c(n.next(e))}catch(e){o(e)}}function s(e){try{c(n.throw(e))}catch(e){o(e)}}function c(e){var t;e.done?r(e.value):((t=e.value)instanceof i?t:new i(function(e){e(t)})).then(a,s)}c((n=n.apply(e,t||[])).next())})};let Wi=j();class Fi{constructor(){this.statsData={},this.retryExperienceCount=0,this.trackingDelayCounter=1;let e=Fi.baseLogTag+".constructor";var t;new RegExp(["bot","spider","crawler","crawling","Applebot","PetalBot","pingbot","proximic","AdsBot-Google","Googlebot","Cincraw","SnapchatBot","Snapchat-Proxy/1.0","SnapchatAds","Snapchat-Ads/1.0","YandexRenderResourcesBot","bingbot","slurp","MicrosoftPreview","Baiduspider"].join("|"),"i").test(navigator.userAgent)?Je.error(1,e,"Bot detected, Can't initialise the MoEngage WebP SDK"):(Wi.APP_ID&&Wi.HOST?X(Wi.DISABLE_WEBP)&&(window.addEventListener(re.MOE_LIFECYCLE.TOPIC_NAME,e=>{(null==(e=null==e?void 0:e.detail)?void 0:e.name)===re.MOE_LIFECYCLE.EVENT_NAMES.SDK_DISABLED&&window.MoeWebP.disableWebPersonalization()}),this.deviceUuid=G(),this.AiExperiences=new xi,t=(new Date).getTime(),this.isLiveExperience=!1,Je.log(2,e,"WEBP SDK Loaded :",t),this.isSentryEnabled())&&("1"===vi()[oe.CHECK_TEST_WEBP]?(Fi.WebPApis.getTestExperiences().then(e=>{this.DomManipulator(e.payload)}),Ui.removeOverLay(),Je.log(2,e,"Web P Test Campaign Dom Manipulation.")):_i()?(this.getEditorVersion().then(t=>{t===oe.STAGING_ERROR?(this.injectEditorFile(oe.STAGING_EDITOR_FILE),Je.log(2,e,"Web P module initialized in staging editor mode. Version not found, loading default staging editor.")):(this.injectEditorFile(oe.EDITOR_FILE(t)),Je.log(2,e,"Web P module initialized in editor mode."))}),Ui.removeOverLay()):fi()?(this.boundIdentityUpdateHandler=this.identityUpdateHandler.bind(this),this.statsData.webP_initialization_time=t,this.getLiveExperiences(),this.handleLogoutListener(),this.handleSPA(),this.handleIdentityChange()):((t=document.createElement("style")).id=ce.STYLE.STYLE_ID,t.innerHTML=ce.STYLE.STYLE_DATA,document.head.appendChild(t),Ci())):Je.error(2,e,"WebP is not properly integrated"),null!=(t=window.Moengage)&&t.personalize?hi.broadcastToWindow({topic:re.MOE_LIFECYCLE.TOPIC_NAME,name:re.MOE_LIFECYCLE.EVENT_NAMES.WEBP_INIT}):window.addEventListener(re.MOE_LIFECYCLE.TOPIC_NAME,e=>{(null==(e=null==e?void 0:e.detail)?void 0:e.name)===re.MOE_LIFECYCLE.EVENT_NAMES.MOE_INIT&&hi.broadcastToWindow({topic:re.MOE_LIFECYCLE.TOPIC_NAME,name:re.MOE_LIFECYCLE.EVENT_NAMES.WEBP_INIT})}))}getLiveExperiences(){return ee(this,void 0,void 0,function*(){let e=Fi.baseLogTag+".getLiveExperiences";yield et.initialize(),this.syncExperiences().then(t=>ee(this,void 0,void 0,function*(){var i,n;t&&t.experiences&&t.experiences.length&&(i=yield Oi(t.experiences),Fi.appliedExperiences={},Fi.failedOperations=[],i&&0<i.length?(i=Si(i),Fi.allOperations=i.allOp,Fi.experiences=i.experiences,n=i.aiExperienceContext,$(void 0,void 0,void 0,function*(){yield et.aiExperiencesStore.setItem(ge.AI_EXPERIENCES.AI_EXPERIENCE_CONTEXT,n)}),i.aiExperienceContext&&0<Object.keys(i.aiExperienceContext).length&&this.AiExperiences.setExperienceTriggerManager(),Fi.experiences&&Fi.experiences.length&&Fi.experiences[0].id&&H("ids",Fi.experiences.map(e=>e.id)),Je.log(2,e,"Eligible Experiences found: ",Fi.experiences),Fi.experiences.forEach(e=>{this.handleLiveExperience(e,t.user_in_gcg)})):this.noExperienceFoundStats())})).catch(t=>{Je.error(1,e,"Error syncing Experiences: ",t)}).finally(()=>{Ui.listenToDomChanges()})})}handleLiveExperience(e,t){var i=Fi.baseLogTag+".handleLiveExperience";e&&e.gcg_enabled&&t?(H("in_gcg",{experience:e.gcg_enabled,user:t}),Je.log(2,i,"GCG is Enabled for both User and Experience: ",{experience:e,userIsGCG:t}),new Promise(()=>{Fi.WebPApis.sendStats(Object.assign(Object.assign({},e.context),{gcg_event:!0})),Fi.WebPApis.sendStats(this.statsData).then(e=>{null!=e&&e.success&&(this.statsData={})})})):e?(Je.log(2,i,"Going to trigger this experience: ",e),e.payload.length?e&&this.handleDomManipulator(e):(this.isLiveExperience=!0,Fi.appliedExperiences[e.id]=!0,this.handleDomManipulationComplete(e,[],!0))):this.noExperienceFoundStats()}noExperienceFoundStats(){return ee(this,void 0,void 0,function*(){var e=Fi.baseLogTag+".noExperienceFoundStats";return Je.log(2,e,"No eligible experience found"),new Promise(()=>{Fi.WebPApis.sendStats(this.statsData).then(e=>{null!=e&&e.success&&(this.statsData={})})})})}syncExperiences(){return ee(this,void 0,void 0,function*(){let e=Fi.baseLogTag+".syncExperiences";return new Promise((t,i)=>ee(this,void 0,void 0,function*(){try{var n,r,o,a=yield U(void 0,void 0,void 0,function*(){var e;return yield null==(e=et.metaStore)?void 0:e.getItem(ge.META.LAST_FETCHED_TIME)});K(a)||!a?(Je.log(2,e,"synchronizing experiences as time limit exceeded"),Wi.ENABLE_SPLIT_URL&&Fi.WebPApis.isSplitUrlExperince().then(e=>{z(e)}),yield U(void 0,void 0,void 0,function*(){yield et.experiencesStore.clear(),yield et.aiExperiencesStore.clear(),yield et.metaStore.clear(),yield et.splitExperiences.clear(),yield et.tabbedExperiences.clear()}),n=yield Fi.WebPApis.getLiveExperiences(),Pt(n.experiences),n.experiences&&(yield Ti(n.experiences)),t(n),yield Fi.WebPApis.getLiveExperiences(!0).then(e=>ee(this,void 0,void 0,function*(){var t,i;t=e&&e.user_in_gcg,U(void 0,void 0,void 0,function*(){var e;return yield null==(e=et.metaStore)?void 0:e.setItem(ge.META.USER_IN_GCG,t)}),Pt(e.experiences),Ti(e.experiences),i=e.split_experiences,U(void 0,void 0,void 0,function*(){yield Promise.all(i.map(e=>U(void 0,void 0,void 0,function*(){var t=q(e.url);yield et.splitExperiences.setItem(t,e)})))})}))):(Wi.ENABLE_SPLIT_URL&&(yield function(){return U(this,void 0,void 0,function*(){var e,t=q(window.location.href);return e=t,!!((t=yield U(void 0,void 0,void 0,function*(){return yield et.splitExperiences.getItem(e)}))&&F(t.expiry_time+"Z")>new Date)})}())&&Fi.WebPApis.isSplitUrlExperince().then(e=>{z(e)}),r=yield Ii(),o=yield U(void 0,void 0,void 0,function*(){var e;return yield null==(e=et.metaStore)?void 0:e.getItem(ge.META.USER_IN_GCG)}),t({experiences:r,user_in_gcg:o}),Je.log(2,e,"Using the cached experiences for Web Personalisation"))}catch(n){i(n)}}))})}handleDomManipulator(e){var t=Fi.baseLogTag+".DomManipulator",i=(this.isLiveExperience=!0,e&&e.payload),n=(this.domManipulatorStartTime=(new Date).getTime(),e).context;Je.log(2,t,null!=n&&n.cid?`Going to render experience with ID: ${n.cid} and `:" ","Operations: ",i),Je.log(2,t,"Dom Manipulator start Time: ",this.domManipulatorStartTime);let r=[];!e.is_ai&&Fi.allOperations?Object.keys(Fi.allOperations).forEach(t=>{(t=Fi.allOperations[t]).expId===e.id&&r.push(t)}):r=e.payload,r.length&&this.DomManipulator(r,e.id,document,n),Fi.failedOperations.length?this.completeDomManipulationTimer=setTimeout(()=>{this.handleDomManipulationComplete(e,this.retryFailedOperations)},oe.RETRY_INTERVAL):this.handleDomManipulationComplete(e,[],!0),this.isDomMutationObserverAdded||(ki.listenToDomChanges(null,null,null,null,this.retryFailedOperations.bind(this,e)),this.isDomMutationObserverAdded=!0)}DomManipulator(e,t,i=document,n){let r=Fi.baseLogTag+".DomManipulator";X(Wi.DISABLE_WEBP)&&e.forEach(e=>{try{Pi.initiate(e,n,i,this.isLiveExperience).success?(e.dataMoeId?this.saveMoeDataIdOperations(e):["insert","rearrange","insert_js"].includes(e.type)||ki.listenToDomChanges(e,n,i,this.isLiveExperience),Fi.appliedExperiences.hasOwnProperty(t)||(Fi.appliedExperiences[t]=!0),Fi.isAnyOperationSuccessfull||(Fi.isAnyOperationSuccessfull=!0)):Fi.failedOperations=Fi.failedOperations.concat([[e,n,i,this.isLiveExperience]])}catch(e){Je.error(2,r,"Error in Dom Manipulation",e)}})}retryFailedOperations(e){var t=Fi.baseLogTag+".startRetry",i=(Je.log(2,t,"Retrying failed operations: ",Fi.failedOperations),Fi.failedOperations.concat([]));Fi.failedOperations=[],i=this.handleRetry(i,e.id),this.retryExperienceCount++,0===Fi.failedOperations.length&&(Je.log(2,t,"Total number of times retried applying webP changes: ",this.retryExperienceCount-1),clearTimeout(this.completeDomManipulationTimer),this.handleDomManipulationComplete(e,i)),Ui.removeOverLay()}handleRetry(e,t){for(var i=[];0<e.length;){var n=e.pop(),r=Pi.initiate.apply(null,n);r.success?"insert_js"!==n[0].type&&(n[0].dataMoeId?this.saveMoeDataIdOperations(n[0]):["insert","rearrange"].includes(n[0].type)||ki.listenToDomChanges.apply(ki,n),Fi.appliedExperiences.hasOwnProperty(t)||(Fi.appliedExperiences[t]=!0),Fi.isAnyOperationSuccessfull||(Fi.isAnyOperationSuccessfull=!0)):(i.push(r),Fi.failedOperations=Fi.failedOperations.concat([n]))}return i}handleDomManipulationComplete(e,t,i){var n=Fi.baseLogTag+".handleDomManipulationComplete",r=(e=e.context,(new Date).getTime());Je.log(2,n,"Dom end Time: ",r),this.domManipulatorStartTime&&Je.log(1,n,`Total time taken to manipulate the DOM: ${(r-this.domManipulatorStartTime)/1e3}s`),this.isLiveExperience&&(t&&t.length&&H("payload_failer",{reason:"Experiences payload Failed to Execute",campaign_id:null==e?void 0:e.cid,data:t}),this.domManipulatorStartTime&&(H("dom_manipulator_start_time",this.domManipulatorStartTime),H("dom_manipulator_end_time",r)),new Promise(()=>{Fi.WebPApis.sendStats(this.statsData).then(e=>{null!=e&&e.success&&(this.statsData={})})}),Fi.isAnyOperationSuccessfull||i)&&(setTimeout(()=>Object.keys(Fi.appliedExperiences).map(e=>ee(this,void 0,void 0,function*(){Fi.appliedExperiences[e]&&(yield this.track(e))})),this.trackingDelayCounter),this.trackingDelayCounter++)}getEditorVersion(){return ee(this,void 0,void 0,function*(){let e=Fi.baseLogTag+".getEditorVersion";return new Promise((t,i)=>ee(this,void 0,void 0,function*(){var n=Di(window.location.search);if((r=j().HOST)&&r.includes("moestaging"))n.webPStagingVersion&&t(n.webPStagingVersion),t(oe.STAGING_ERROR);else{var r=yield Ze.get(""+oe.VERSION_FILE);if(200===r.status)try{var o=JSON.parse(r.responseText);"1"===n.pre_prod&&t(o[oe.PRE_PROD]),t(o[Wi.CLUSTER]||"")}catch(n){Je.error(2,e,"Error in getting editor version file",n),i(n)}t("")}}))})}injectEditorFile(e){return ee(this,void 0,void 0,function*(){return new Promise((t,i)=>ee(this,void 0,void 0,function*(){var t=document.createElement("script");t.src=e,document.getElementsByTagName("head")[0].appendChild(t)}))})}track(e){return ee(this,void 0,void 0,function*(){Fi.appliedExperiences[e]=!1;let t=yield bi(e);(t=t||Fi.experiences.find(t=>t.id===e))&&(this.eventTracking(oe.EVENTS.IMPRESSION,t.id,t.context),t.tab_list)&&this.renderTabbedExperience(e,t.tab_list)})}isSentryEnabled(){var e=Fi.baseLogTag+".isSentryEnabled";try{var t=JSON.parse(localStorage.getItem("MOE_DATA"));return!(t&&t.WEB_SETTINGS&&t.WEB_SETTINGS.configs)||t.WEB_SETTINGS.configs.isWebPersonalizationModuleEnabled}catch(t){Je.error(1,e,"Error in getting sentry flag for webp: ",t)}}clearLastFetchedTime(e){return ee(this,void 0,void 0,function*(){return Je.log(2,"MoeWebP.clearLastFetchedTime","Clearing cache for Web Personalisation"),e&&(Fi.failedOperations=[]),yield yi()})}isEditorModeEnabled(){return _i()||!fi()}setLogLevel(e){Je.setLogLevel(e,!1),Je.setLogTabStyle("#85586F")}handleInSessionEvent(e){return ee(this,void 0,void 0,function*(){var t,i=Fi.baseLogTag+".handleInSessionEvent";(yield v(void 0,void 0,void 0,function*(){return et&&et.inSessionStore&&(yield et.inSessionStore.getItem(ge.IN_SESSION.IN_SESSION_EVENTS))||[]})).includes(e.name)&&(Je.log(2,i,"Event found in Web personalization experience: ",e.name),t=e,v(void 0,void 0,void 0,function*(){var e=yield kt();e.unshift(t),e.length>oe.MAX_EVENTS_FOR_IN_SESSION&&e.pop(),et.inSessionStore.setItem(ge.IN_SESSION.IN_SESSION_EVENTS_HISTORY,e)}))})}saveMoeDataIdOperations(e){Fi.moeOperationsWithDataID[e.dataMoeId]?Fi.moeOperationsWithDataID[e.dataMoeId].push(e):Fi.moeOperationsWithDataID[e.dataMoeId]=[e]}eventTracking(e,t,i,n){var r=Fi.baseLogTag+".eventTracking";try{return pi()?(Je.log(1,r,e+": Event Tracked"),pi().track_event(e,Object.assign({campaign_id:t},i))):(window.moengage_q=window.moengage_q||[]).push({f:"track_event",a:[e,Object.assign(Object.assign({campaign_id:t},i),n)]}),Promise.resolve()}catch(e){Je.error(2,r,"Failed Tracking expression",e)}}trackClick(e,t,i){return this.eventTracking(oe.EVENTS.CLICK,e,t,i)}previewExperiences(e,t){var i=Fi.baseLogTag+".previewExperiences";return Je.log(2,i,(e?"Adding":"Removing")+" border and label to personalized experiences"),e?([i=document]=[t],e="Web Personalisation.previewExperiences",Li.enable||Je.error(2,e,"Preview mode is not enabled"),i.querySelectorAll(`[${ce.DATA_ATTRIBUTE.LABEL_NAME}]`).forEach(e=>{e.classList.add(ce.ELEMENT_BORDER_CLASS),e.getAttribute("title")&&e.setAttribute(ce.DATA_ATTRIBUTE.BACKUP_TITLE,e.getAttribute("title")),e.setAttribute("title","")}),Li.enable(i),void Je.log(2,e,"Border and label's added to personalized experiences")):([i=document]=[t],e="Web Personalisation.previewExperiences",Li.disable||Je.error(2,e,"Preview mode is not enabled"),i.querySelectorAll(`[${ce.DATA_ATTRIBUTE.LABEL_NAME}]`).forEach(e=>{e.classList.remove(ce.ELEMENT_BORDER_CLASS),e.removeAttribute("title"),e.getAttribute(ce.DATA_ATTRIBUTE.BACKUP_TITLE)&&(e.setAttribute("title",e.getAttribute(ce.DATA_ATTRIBUTE.BACKUP_TITLE)),e.removeAttribute(ce.DATA_ATTRIBUTE.BACKUP_TITLE))}),Li.disable(i),void Je.log(2,e,"Border and label's removed from personalized experiences"))}renderTabbedExperience(e,t){return ee(this,void 0,void 0,function*(){let i=Fi.baseLogTag+".renderTabbedExperience";try{var n,r=yield Ai(e);if(!r)return n=t.map(t=>t.is_ai?Promise.resolve():Fi.WebPApis.getTabData(e,t.tab_id).then(t=>ee(this,void 0,void 0,function*(){var n,r,o;return t&&t[e]?(n=t[e]&&t[e].data,r=e,o=n,U(void 0,void 0,void 0,function*(){let e;return Ai(r).then(t=>U(void 0,void 0,void 0,function*(){t&&(o=o.concat(t)),e=yield et.tabbedExperiences.setItem(r,o)})),e}),Ri(e,n,!0)):(Je.error(2,i,"No payload found for tabbed experience",e),!1)})).catch(t=>{Je.error(2,i,`Failed to get tabbed experience data ${e}:`,t)})),Promise.all(n);yield Ri(e,r,!0)}catch(n){throw Je.error(2,i,`Error in getTabbedData ${e}:`,n),n}})}renderPageTypeExperience(e){return ee(this,void 0,void 0,function*(){var t,i=Fi.baseLogTag+".renderPageTypeExperience";if(e){t=e,window[le.PAGE_CONTEXT]=t;try{var n=yield function(){return U(this,void 0,void 0,function*(){let e="Web Personalisationutils.getPageTypeExperiences";try{var t=(yield Ii())||[];return t.length?(yield Promise.all(t.map(t=>U(this,void 0,void 0,function*(){try{if(t.page_attributes)return(yield T(t))?t:null}catch(i){Je.error(2,e,"Error evaluating page context for experience:",t,i)}return null})))).filter(Boolean):[]}catch(t){throw Je.error(2,e,"Error getting pageType experiences:",t),t}})}();let e=!1;return n&&n.forEach(t=>{t&&!Fi.appliedExperiences.hasOwnProperty(t.id)&&(t.is_ai=!0,this.handleDomManipulator(t),e=!0)}),e}catch(t){return Je.error(2,i,"Error getting pageType experiences:",t),!1}}return Je.error(2,i,"No pageContext provided"),!1})}handleLogoutListener(){window.addEventListener("USER_ACTIONS",e=>{"FORCED_LOGOUT"===e.detail.name&&this.handleWebPLogout(!0)}),window.addEventListener(re.USER_LIFECYCLE.TOPIC_NAME,e=>{e.detail.name===re.USER_LIFECYCLE.EVENT_NAMES.LOGOUT&&this.handleWebPLogout()})}handleWebPLogout(e){et.clear(),e&&this.getLiveExperiences()}handleSPA(){window.addEventListener(re.SPA_LIFECYCLE.TOPIC_NAME,e=>{e.detail.name===re.SPA_LIFECYCLE.EVENT_NAMES.PAGE_CHANGED&&X(Wi.DISABLE_WEBP)&&this.getLiveExperiences()})}disableWebPersonalization(){window.removeEventListener(re.SPA_LIFECYCLE.TOPIC_NAME,this.getLiveExperiences),window.removeEventListener(re.USER_LIFECYCLE.TOPIC_NAME,this.boundIdentityUpdateHandler),Fi.failedOperations=[],ki.disconnectObservers(),this.isDomMutationObserverAdded=!1}handleIdentityChange(){window.removeEventListener(re.USER_LIFECYCLE.TOPIC_NAME,this.boundIdentityUpdateHandler),window.addEventListener(re.USER_LIFECYCLE.TOPIC_NAME,this.boundIdentityUpdateHandler)}identityUpdateHandler(e){return ee(this,void 0,void 0,function*(){e.detail.name===re.USER_LIFECYCLE.EVENT_NAMES.USER_IDENTITY_UPDATE&&(yi(),this.syncExperiences())})}fetchExperiences(e=[],t={}){return ee(this,void 0,void 0,function*(){var i=Fi.baseLogTag+".fetchExperiences";Je.log(2,i,"Fetching experiences from remote");try{var n=yield Fi.WebPApis.fetchExperiences(e,t);return null!=n&&n.experiences?n.experiences:(Je.error(2,i,"No self-handle experiences found"),{})}catch(n){throw Je.error(2,i,"Error fetching self handle experiences: ",n),n}})}}Fi.baseLogTag="Web Personalisation",Fi.WebPApis=new Mi,Fi.failedOperations=[],Fi.isAnyOperationSuccessfull=!1,Fi.appliedExperiences={},Fi.moeOperationsWithDataID={},window.MoeWebP=new Fi}})();